<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

## 2026-01-20: Smart Polling Implementation

**Feature**: Scoreboard only fetches full data when backend data changes (reduces API calls ~90%)

**How It Works**:
- `main.js` polls `?action=version` every 5 seconds (tiny ~50 byte response)
- `api.js` tracks `lastKnownVersion` and compares with server version
- Full data fetch only triggers when version number changes
- Version increments on: webhook, logBag, logPause, logResume, setShiftStart

**Files Modified**:
- `api.js` - Added `checkVersion()` function with version tracking
- `main.js` - Changed `loadData()` polling to `checkForUpdates()` smart polling

**Backend** (workers/src/handlers/production.js):
- New D1 table: `data_version`
- New endpoint: `?action=version`
- `incrementDataVersion()` called on all data-changing actions

**Intervals**:
- Version check: 5 seconds
- Order queue: 30 seconds (separate backend, changes rarely)

**Status**: ✅ Deployed and verified working

---

## 2026-01-13: Timer Freeze Bug Fix

**Issue**: Bag timer counting backwards/incrementing during lunch breaks instead of freezing

**Root Cause**:
- When `debugOnBreak=true`, code in `timer.js:81` was skipping ALL scheduled break subtractions
- This caused elapsed time calculation to include break time that should be excluded
- Result: Timer appeared to increment during breaks

**Fix Applied**:
- Removed condition `if (!State || State.debugOnBreak !== true)` that was skipping break subtraction
- Changed to always subtract scheduled breaks, regardless of debug mode
- Debug break mode now only freezes `endTime` at break start, doesn't skip historical break calculations

**Files Modified**:
- `timer.js:79-100` - Always subtract completed breaks
- `state.js:368-380` - `testBreakMode()` helper function for testing

**Testing**:
```javascript
// Browser console command to test break freeze
testBreakMode(true);  // Freezes timer, turns yellow
testBreakMode(false); // Resumes timer
```

**Verification**:
- Diagnostic test confirms timer freezes correctly (39:50 → 39:50 over 6 seconds)
- Break start timestamp is cached and doesn't change during break
- Timer resumes normally when break ends

**Status**: ✅ Deployed and verified working

</claude-mem-context>