/*
 * Rogue Origin — Scoreboard V2: Obsidian Theater
 * Aesthetic: Topographic cartography × Swiss chronograph × F1 broadcast × luxury dashboard
 * Typography: Playfair Display (hero), JetBrains Mono (data), Manrope (UI)
 * Palette: Deep obsidian black, warm ivory, living gold, organic signal colors
 * Layout: Hero-dominant center stage with flanking instrument rings
 * Written: February 2026 — Complete rewrite
 */

/* ========================================
   DESIGN TOKENS
   ======================================== */
:root {
  /* --- Palette: Obsidian theater with amber warmth --- */
  --lux-black: #060807;
  --lux-bg: #080a09;
  --lux-surface: rgba(255, 255, 255, 0.018);
  --lux-surface-raised: rgba(255, 255, 255, 0.035);
  --lux-surface-glass: rgba(255, 255, 255, 0.025);
  --lux-border: rgba(228, 170, 79, 0.06);
  --lux-border-subtle: rgba(255, 255, 255, 0.04);
  --lux-border-accent: rgba(228, 170, 79, 0.2);

  --lux-gold: #e4aa4f;
  --lux-gold-dim: rgba(228, 170, 79, 0.1);
  --lux-gold-glow: rgba(228, 170, 79, 0.06);
  --lux-cream: #f0ebe0;
  --lux-cream-soft: rgba(240, 235, 224, 0.8);
  --lux-cream-muted: rgba(240, 235, 224, 0.4);
  --lux-cream-whisper: rgba(240, 235, 224, 0.18);

  --lux-green: #7cb888;
  --lux-green-dim: rgba(124, 184, 136, 0.12);
  --lux-green-glow: rgba(124, 184, 136, 0.06);
  --lux-red: #d96b5e;
  --lux-red-dim: rgba(217, 107, 94, 0.12);
  --lux-yellow: #e4c34f;
  --lux-yellow-dim: rgba(228, 195, 79, 0.12);

  /* Status system */
  --status-green: #7cb888;
  --status-yellow: #e4c34f;
  --status-red: #d96b5e;
  --status-gray: #6b7370;

  /* --- Typography — Playfair Display hero, JetBrains Mono data, Manrope UI --- */
  --font-hero: 'Playfair Display', 'Georgia', serif;
  --font-data: 'JetBrains Mono', 'Space Mono', 'Courier New', monospace;
  --font-ui: 'Manrope', 'Inter', system-ui, sans-serif;

  /* --- Spacing --- */
  --sp-1: 4px;
  --sp-2: 8px;
  --sp-3: 12px;
  --sp-4: 16px;
  --sp-5: 24px;
  --sp-6: 32px;
  --sp-7: 48px;
  --sp-8: 64px;
  --sp-9: 96px;

  /* --- Radii --- */
  --r-sm: 6px;
  --r-md: 10px;
  --r-lg: 16px;
  --r-xl: 24px;
  --r-2xl: 32px;

  /* --- Motion --- */
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-cinematic: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --t-fast: 0.15s;
  --t-normal: 0.3s;
  --t-smooth: 0.6s;
  --t-dramatic: 1s;

  /* --- Layout — centered hero, instrument panel right --- */
  --panel-width: 380px;
  --ring-size: 210px;
  --header-height: 64px;
  --hero-size: 320px;
}


/* ========================================
   TEXTURE & DEPTH — Triple-layer background
   Layer 1: SVG noise grain (::before)
   Layer 2: Topographic contour lines (inline SVG, fixed)
   Layer 3: Radial vignette (::after)
   ======================================== */

/* Layer 1: Film grain overlay */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 9999;
  mix-blend-mode: overlay;
  opacity: 0.025;
}

/* Layer 2: Topographic contour lines — organic cartographic texture */
.topo-bg,
body .topo-contours {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -2;
  animation: topoFloat 30s ease-in-out infinite;
}

/* Fallback topo via CSS gradients if no SVG element present */
body {
  background-image:
    /* Concentric ellipses — topographic contour feel */
    radial-gradient(ellipse 90% 80% at 30% 55%, transparent 40%, rgba(228, 170, 79, 0.012) 40.5%, transparent 41%),
    radial-gradient(ellipse 75% 65% at 30% 55%, transparent 40%, rgba(228, 170, 79, 0.010) 40.5%, transparent 41%),
    radial-gradient(ellipse 60% 52% at 30% 55%, transparent 40%, rgba(228, 170, 79, 0.008) 40.5%, transparent 41%),
    radial-gradient(ellipse 45% 38% at 30% 55%, transparent 40%, rgba(228, 170, 79, 0.015) 40.5%, transparent 41%),
    radial-gradient(ellipse 85% 70% at 72% 40%, transparent 40%, rgba(228, 170, 79, 0.010) 40.5%, transparent 41%),
    radial-gradient(ellipse 65% 55% at 72% 40%, transparent 40%, rgba(228, 170, 79, 0.012) 40.5%, transparent 41%),
    radial-gradient(ellipse 50% 42% at 72% 40%, transparent 40%, rgba(228, 170, 79, 0.008) 40.5%, transparent 41%);
  background-size: 100% 100%;
  background-attachment: fixed;
}

/* Layer 3: Radial depth vignette */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: radial-gradient(ellipse 80% 70% at 35% 50%, transparent 0%, rgba(0, 0, 0, 0.45) 100%);
  pointer-events: none;
  z-index: -1;
}


/* ========================================
   KEYFRAME ANIMATIONS
   ======================================== */

/* Status badge breathing */
@keyframes statusPulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.03); opacity: 0.92; }
}

/* Timer ring glow oscillation */
@keyframes glowCycle {
  0%, 100% { filter: drop-shadow(0 0 6px currentColor) drop-shadow(0 0 12px currentColor); opacity: 1; }
  50% { filter: drop-shadow(0 0 10px currentColor) drop-shadow(0 0 20px currentColor); opacity: 0.85; }
}

/* Topographic background float */
@keyframes topoFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

/* Break glow */
@keyframes breakGlow {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.88; }
}

@keyframes blueBreakGlow {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

/* Urgent pulse — red state */
@keyframes urgentPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.9; }
}

@keyframes redBackgroundPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.92; }
}

/* Subtle green pulse for start-day button */
@keyframes subtlePulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(124, 184, 136, 0); }
  50% { box-shadow: 0 0 0 8px rgba(124, 184, 136, 0.12); }
}

/* Progress bar glow */
@keyframes progressGlow {
  0%, 100% { box-shadow: 0 0 12px rgba(228, 170, 79, 0.5), 0 0 24px rgba(228, 170, 79, 0.2); }
  50% { box-shadow: 0 0 16px rgba(228, 170, 79, 0.7), 0 0 32px rgba(228, 170, 79, 0.3); }
}

/* Ring pulse — red timer state */
@keyframes ringPulse {
  0%, 100% { filter: drop-shadow(0 0 6px rgba(217, 107, 94, 0.3)); }
  50% { filter: drop-shadow(0 0 14px rgba(217, 107, 94, 0.6)); }
}

/* Panel pulse — red timer panel border */
@keyframes panelPulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.6; }
}

/* Status dot pulse */
@keyframes dotPulse {
  0%, 100% { box-shadow: 0 0 8px rgba(124, 184, 136, 0.6); }
  50% { box-shadow: 0 0 12px rgba(124, 184, 136, 0.9); }
}

/* Reveal down — expand animations */
@keyframes revealDown {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Confetti fall */
@keyframes confettiFall {
  0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* Celebration text entrance */
@keyframes celebrateText {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
  15% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
  30% { transform: translate(-50%, -50%) scale(1); }
  60% { opacity: 1; }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(1.05); }
}


/* ========================================
   RESET & BASE
   ======================================== */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  height: 100%;
  overflow: hidden;
  background-color: var(--lux-bg);
  color: var(--lux-cream);
  font-family: var(--font-ui);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  display: grid;
  grid-template-columns: 1fr var(--panel-width);
  grid-template-rows: var(--header-height) 1fr;
  transition: background var(--t-dramatic) var(--ease-cinematic);
}


/* ========================================
   DYNAMIC STATUS BACKGROUNDS
   Ambient aurora — dramatic, atmospheric
   ======================================== */
body.ahead {
  background-color: var(--lux-bg);
  background-image:
    radial-gradient(ellipse 60% 50% at 20% 60%, rgba(124, 184, 136, 0.08) 0%, transparent 70%),
    radial-gradient(ellipse 40% 40% at 70% 30%, rgba(124, 184, 136, 0.03) 0%, transparent 60%);
}

body.on-target {
  background-color: var(--lux-bg);
  background-image:
    radial-gradient(ellipse 60% 50% at 20% 60%, rgba(228, 195, 79, 0.06) 0%, transparent 70%),
    radial-gradient(ellipse 40% 40% at 70% 30%, rgba(228, 195, 79, 0.02) 0%, transparent 60%);
}

body.behind {
  background-color: var(--lux-bg);
  background-image:
    radial-gradient(ellipse 60% 50% at 20% 60%, rgba(217, 107, 94, 0.07) 0%, transparent 70%),
    radial-gradient(ellipse 40% 40% at 70% 30%, rgba(217, 107, 94, 0.03) 0%, transparent 60%);
}

body.idle {
  background-color: var(--lux-bg);
  background-image: none;
}

/* Timer-derived backgrounds */
body.timer-green {
  background-color: var(--lux-bg);
  background-image:
    radial-gradient(ellipse 50% 60% at 85% 50%, rgba(124, 184, 136, 0.06) 0%, transparent 70%);
}

body.timer-yellow {
  background-color: var(--lux-bg);
  background-image:
    radial-gradient(ellipse 50% 60% at 85% 50%, rgba(59, 130, 246, 0.07) 0%, transparent 70%);
  animation: breakGlow 4s ease-in-out infinite;
}

body.timer-red {
  background-color: var(--lux-bg);
  background-image:
    radial-gradient(ellipse 50% 60% at 85% 50%, rgba(217, 107, 94, 0.1) 0%, transparent 70%);
  animation: urgentPulse 1.8s ease-in-out infinite;
}

body.timer-neutral {
  background-color: var(--lux-bg);
  background-image: none;
}


/* ========================================
   SKIP LINK (Accessibility)
   ======================================== */
.skip-link {
  position: absolute;
  top: -100%;
  left: 16px;
  padding: 12px 24px;
  background: var(--lux-gold);
  color: var(--lux-black);
  font-weight: 700;
  border-radius: var(--r-md);
  z-index: 10000;
  text-decoration: none;
}

.skip-link:focus {
  top: 16px;
  outline: 3px solid var(--lux-gold);
}


/* ========================================
   MORNING REPORT (full-screen overlay)
   ======================================== */
#morningReportContainer {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--lux-bg);
  z-index: 6000;
  overflow-y: auto;
  padding: var(--sp-6);
}

#morningReportContainer.active {
  display: block;
}

.mr-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--sp-7);
  padding: var(--sp-5) var(--sp-6);
  border-bottom: 1px solid var(--lux-border);
}

.mr-title {
  font-family: var(--font-hero);
  font-size: 32px;
  font-weight: 700;
  color: var(--lux-cream);
  letter-spacing: -0.02em;
}

.mr-subtitle {
  font-family: var(--font-data);
  font-size: 13px;
  color: var(--lux-gold);
  margin-top: 4px;
  letter-spacing: 0.04em;
}

.mr-back-btn {
  background: transparent;
  border: 1px solid var(--lux-border-accent);
  border-radius: var(--r-md);
  color: var(--lux-gold);
  padding: 10px 24px;
  font-family: var(--font-ui);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  transition: all var(--t-fast) var(--ease-out);
  letter-spacing: 0.02em;
}

.mr-back-btn:hover {
  background: var(--lux-gold-dim);
}


/* ========================================
   HISTORICAL DATE BANNER
   ======================================== */
.historical-date-banner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 500;
  background: rgba(228, 170, 79, 0.08);
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
  border-bottom: 1px solid var(--lux-border-accent);
  padding: 10px var(--sp-6);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.historical-banner-content {
  display: flex;
  align-items: center;
  gap: var(--sp-3);
  font-family: var(--font-ui);
  font-size: 14px;
  color: var(--lux-cream-soft);
}

.historical-banner-content i {
  color: var(--lux-gold);
  font-size: 18px;
}

.historical-banner-label {
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-size: 11px;
  font-weight: 700;
  color: var(--lux-cream-muted);
}

.historical-banner-date {
  font-family: var(--font-data);
  color: var(--lux-gold);
  font-weight: 700;
}

.historical-banner-close {
  background: transparent;
  border: 1px solid var(--lux-border-accent);
  border-radius: var(--r-sm);
  color: var(--lux-gold);
  padding: 6px 16px;
  font-family: var(--font-ui);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background var(--t-fast);
}

.historical-banner-close:hover {
  background: var(--lux-gold-dim);
}


/* ========================================
   HUD HEADER — Cinematic top bar
   Spans full width, three-column layout
   ======================================== */
.hud-header {
  grid-column: 1 / -1;
  grid-row: 1;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 var(--sp-7);
  position: relative;
  z-index: 100;
  border-bottom: 1px solid var(--lux-border-subtle);
}

/* Subtle scanline accent on header bottom */
.hud-header::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 10%;
  right: 10%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--lux-gold-dim), var(--lux-gold), var(--lux-gold-dim), transparent);
  opacity: 0.4;
}

.strain-display {
  position: relative;
  z-index: 100;
}

.strain-label {
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 400;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--lux-cream-whisper);
  margin-bottom: 2px;
}

.strain-name {
  font-family: var(--font-hero);
  font-size: 24px;
  font-weight: 700;
  color: var(--lux-cream);
  letter-spacing: -0.02em;
  line-height: 1.1;
  max-width: 400px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.strain-rate-indicator {
  font-family: var(--font-data);
  font-size: 10px;
  color: var(--lux-cream-muted);
  margin-top: 1px;
}

/* Center marker — status badge sits here */
.hud-center-marker {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}

/* Clock — right side of header */
.time-display {
  text-align: right;
  z-index: 100;
  position: relative;
}

.time-display .time {
  font-family: var(--font-data);
  font-size: 34px;
  font-weight: 700;
  color: var(--lux-cream);
  letter-spacing: -0.03em;
  line-height: 1;
  font-variant-numeric: tabular-nums;
}

.time-display .date {
  font-family: var(--font-ui);
  font-size: 11px;
  color: var(--lux-cream-muted);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-top: 2px;
}

/* Time controls — below header */
.time-controls {
  position: fixed;
  top: calc(var(--header-height) + var(--sp-3));
  right: calc(var(--panel-width) + var(--sp-7));
  z-index: 100;
  display: flex;
  align-items: center;
  gap: var(--sp-3);
}

.start-day-btn {
  background: transparent;
  border: 1px solid var(--lux-green);
  color: var(--lux-green);
  padding: 8px 20px;
  border-radius: var(--r-md);
  font-family: var(--font-ui);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all var(--t-fast) var(--ease-out);
}

.start-day-btn:hover {
  background: var(--lux-green-dim);
}

.start-day-btn.pulse-green {
  animation: subtlePulse 2s ease-in-out infinite;
}

.started-badge {
  font-family: var(--font-data);
  font-size: 12px;
  color: var(--lux-cream-muted);
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  padding: 6px 12px;
  border-radius: var(--r-sm);
  transition: background var(--t-fast);
}

.started-badge:hover {
  background: rgba(255, 255, 255, 0.04);
}

.started-badge i {
  color: var(--lux-gold);
  font-size: 14px;
}

/* Hidden inputs & buttons (moved off-screen) */
.date-picker-hidden {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

#morningReportBtn,
.historical-view-btn,
.order-queue-toggle-btn {
  display: none !important;
}

/* Lang / TV toggle — top right corner */
.lang-toggle {
  position: fixed;
  top: var(--sp-2);
  right: var(--sp-2);
  z-index: 300;
  display: flex;
  gap: 2px;
}

.lang-btn {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid transparent;
  color: var(--lux-cream-muted);
  padding: 6px 10px;
  border-radius: var(--r-sm);
  font-family: var(--font-data);
  font-size: 11px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--t-fast);
  text-decoration: none;
  min-width: 36px;
  min-height: 36px;
}

.lang-btn:hover {
  background: rgba(255, 255, 255, 0.06);
  color: var(--lux-cream);
}

.lang-btn.active {
  color: var(--lux-gold);
  border-color: var(--lux-border-accent);
}

.lang-btn i {
  font-size: 16px;
}

.complaints-btn {
  color: var(--lux-red);
}

/* Help button */
.help-btn {
  display: none !important;
}


/* ========================================
   MAIN PANEL — Left column
   Hero-dominant center stage with dramatic sizing
   ======================================== */
#main-panel,
.main-panel {
  grid-column: 1;
  grid-row: 2;
  height: calc(100vh - var(--header-height));
  overflow-y: auto;
  overflow-x: hidden;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: var(--sp-5) var(--sp-7) var(--sp-8);
  scrollbar-width: none;
}

.main-panel::-webkit-scrollbar {
  display: none;
}

.scoreboard {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--sp-5);
  max-width: 900px;
  width: 100%;
}


/* ========================================
   STATUS BADGE — Floating indicator
   Now with breathing animation
   ======================================== */
.status-badge {
  display: inline-flex;
  align-items: center;
  gap: var(--sp-2);
  padding: 6px 24px;
  border-radius: 100px;
  font-family: var(--font-data);
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  background: rgba(228, 170, 79, 0.06);
  color: var(--lux-gold);
  border: 1px solid rgba(228, 170, 79, 0.12);
  transition: all var(--t-normal) var(--ease-out);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  animation: statusPulse 3s ease-in-out infinite;
}

.status-icon {
  font-size: 14px;
  display: flex;
  align-items: center;
}

/* Status states */
.status-badge.ahead,
body.ahead .status-badge {
  background: rgba(124, 184, 136, 0.08);
  color: var(--lux-green);
  border-color: rgba(124, 184, 136, 0.15);
  box-shadow: 0 0 20px rgba(124, 184, 136, 0.06);
}

.status-badge.behind,
body.behind .status-badge {
  background: rgba(217, 107, 94, 0.08);
  color: var(--lux-red);
  border-color: rgba(217, 107, 94, 0.15);
  box-shadow: 0 0 20px rgba(217, 107, 94, 0.06);
}

.status-badge.on-target,
body.on-target .status-badge {
  background: rgba(228, 195, 79, 0.08);
  color: var(--lux-yellow);
  border-color: rgba(228, 195, 79, 0.15);
  box-shadow: 0 0 20px rgba(228, 195, 79, 0.06);
}


/* ========================================
   HERO DAILY — The showstopper number
   300px+ DOMINATES — visible from across the room
   Multi-layer text glow, tight line-height
   ======================================== */
.hero-daily {
  width: 100%;
  text-align: center;
  position: relative;
}

.daily-progress {
  width: 100%;
  padding: var(--sp-5) var(--sp-6) var(--sp-5);
  text-align: center;
  position: relative;
  border-radius: var(--r-2xl);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.012) 0%, transparent 100%);
  border: 1px solid var(--lux-border-subtle);
  overflow: hidden;
  transition: all var(--t-smooth) var(--ease-out);
}

.daily-progress:hover {
  border-color: var(--lux-border-accent);
}

/* Ambient glow behind the hero section — wider, more dramatic */
.daily-progress::before {
  content: '';
  position: absolute;
  top: -50%;
  left: 10%;
  right: 10%;
  height: 100%;
  background: radial-gradient(ellipse, rgba(228, 170, 79, 0.035) 0%, transparent 70%);
  pointer-events: none;
}

.daily-header {
  font-family: var(--font-data);
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.25em;
  color: var(--lux-gold);
  margin-bottom: var(--sp-2);
  position: relative;
}

.daily-numbers {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: var(--sp-3);
  flex-wrap: wrap;
  position: relative;
}

/* === THE HERO NUMBER === */
.daily-actual {
  font-family: var(--font-hero);
  font-size: var(--hero-size);
  font-weight: 900;
  color: var(--lux-cream);
  line-height: 0.85;
  letter-spacing: -0.06em;
  font-variant-numeric: tabular-nums;
  text-shadow:
    0 0 80px rgba(240, 235, 224, 0.08),
    0 0 160px rgba(228, 170, 79, 0.04);
  position: relative;
}

.daily-sep {
  font-family: var(--font-hero);
  font-size: 48px;
  color: var(--lux-cream-whisper);
  font-weight: 300;
}

.daily-target {
  font-family: var(--font-hero);
  font-size: 48px;
  color: var(--lux-cream-muted);
  font-weight: 400;
  letter-spacing: -0.02em;
}

.daily-unit {
  font-family: var(--font-data);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--lux-cream-whisper);
  align-self: flex-end;
  margin-bottom: 10px;
}

.daily-delta {
  font-family: var(--font-data);
  font-size: 18px;
  font-weight: 700;
  margin-left: var(--sp-2);
  padding: 5px 14px;
  border-radius: 100px;
}

.daily-delta.positive {
  color: var(--lux-green);
  background: var(--lux-green-dim);
}

.daily-delta.negative {
  color: var(--lux-red);
  background: var(--lux-red-dim);
}

.daily-delta.neutral {
  color: var(--lux-cream-muted);
  background: rgba(255, 255, 255, 0.03);
}

/* Progress bar — refined racing stripe */
.progress-bar-container {
  display: flex;
  align-items: center;
  gap: var(--sp-3);
  margin-top: var(--sp-5);
  padding: 0 var(--sp-5);
}

.progress-bar {
  flex: 1;
  height: 3px;
  background: rgba(255, 255, 255, 0.04);
  border-radius: 2px;
  overflow: hidden;
  position: relative;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--lux-gold), var(--lux-green));
  border-radius: 2px;
  transition: width var(--t-smooth) var(--ease-out);
  position: relative;
}

/* Glowing head on progress bar */
.progress-fill::after {
  content: '';
  position: absolute;
  right: -2px;
  top: -4px;
  bottom: -4px;
  width: 12px;
  background: var(--lux-gold);
  border-radius: 6px;
  box-shadow: 0 0 12px rgba(228, 170, 79, 0.5), 0 0 24px rgba(228, 170, 79, 0.2);
  animation: progressGlow 2s ease-in-out infinite;
}

.progress-hours {
  font-family: var(--font-data);
  font-size: 10px;
  color: var(--lux-cream-muted);
  white-space: nowrap;
  flex-shrink: 0;
  letter-spacing: 0.05em;
}

/* Projection row */
.daily-projection {
  margin-top: var(--sp-4);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--sp-2);
  font-family: var(--font-data);
  font-size: 13px;
}

.projection-label {
  color: var(--lux-cream-whisper);
  font-family: var(--font-data);
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.15em;
}

.projection-value {
  color: var(--lux-cream);
  font-weight: 700;
  font-size: 16px;
}

.projection-goal {
  color: var(--lux-cream-muted);
  font-size: 12px;
}

.projection-delta {
  font-weight: 700;
  font-size: 14px;
}

.projection-delta.positive { color: var(--lux-green); }
.projection-delta.negative { color: var(--lux-red); }


/* ========================================
   HOUR CARDS — Dramatic scale contrast
   Last hour is the big one, current hour is compact
   ======================================== */
.hour-cards {
  display: flex;
  gap: var(--sp-4);
  width: 100%;
  justify-content: center;
  align-items: stretch;
}

.hour-card {
  background: var(--lux-surface);
  border: 1px solid var(--lux-border-subtle);
  border-radius: var(--r-xl);
  padding: var(--sp-5) var(--sp-6);
  flex: 1;
  max-width: 420px;
  text-align: center;
  transition: all var(--t-normal) var(--ease-out);
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

/* Top accent line — thinner, elegant */
.hour-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 15%;
  right: 15%;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(228, 170, 79, 0.15), transparent);
}

.hour-card:hover {
  border-color: var(--lux-border-accent);
  transform: translateY(-3px);
  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
}

.hour-card-header {
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--lux-cream-whisper);
  margin-bottom: var(--sp-1);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.hour-card-header i {
  font-size: 12px;
  color: var(--lux-gold);
}

.hour-card-timeslot {
  font-family: var(--font-data);
  font-size: 10px;
  color: var(--lux-cream-muted);
  margin-bottom: var(--sp-4);
  letter-spacing: 0.08em;
}

.lbs-row {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: var(--sp-2);
}

.actual-lbs {
  font-family: var(--font-hero);
  font-size: 64px;
  font-weight: 900;
  color: var(--lux-cream);
  line-height: 1;
  letter-spacing: -0.03em;
  font-variant-numeric: tabular-nums;
}

.separator {
  font-family: var(--font-hero);
  font-size: 32px;
  color: var(--lux-cream-whisper);
  font-weight: 300;
}

.target-lbs {
  font-family: var(--font-hero);
  font-size: 32px;
  color: var(--lux-cream-muted);
  font-weight: 400;
  letter-spacing: -0.02em;
}

.lbs-unit {
  font-family: var(--font-data);
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.25em;
  color: var(--lux-cream-whisper);
  margin-top: var(--sp-1);
}

.percentage-display {
  margin-top: var(--sp-3);
}

.percentage-value {
  font-family: var(--font-data);
  font-size: 22px;
  font-weight: 700;
  color: var(--lux-cream);
}

.percentage-value.positive,
.percentage-value.green { color: var(--lux-green); }
.percentage-value.negative,
.percentage-value.red { color: var(--lux-red); }

.percentage-label {
  font-family: var(--font-data);
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--lux-cream-whisper);
  margin-top: 2px;
}

/* Current hour card — active energy */
.hour-card.current-hour {
  border-color: rgba(228, 170, 79, 0.1);
}

.hour-card.current-hour::before {
  background: linear-gradient(90deg, transparent, var(--lux-gold), transparent);
  opacity: 0.3;
}


/* ========================================
   ORDER QUEUE
   ======================================== */
.order-queue-section {
  display: flex;
  flex-direction: column;
  gap: var(--sp-3);
  width: 100%;
  max-width: 760px;
}

.order-pill {
  background: var(--lux-surface);
  border: 1px solid var(--lux-border-accent);
  border-radius: var(--r-lg);
  padding: var(--sp-4) var(--sp-5);
  cursor: pointer;
  transition: all var(--t-normal) var(--ease-spring);
  overflow: hidden;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.order-pill:hover {
  background: var(--lux-surface-raised);
  border-color: var(--lux-gold);
}

.order-pill.next {
  border-color: var(--lux-border-subtle);
  opacity: 0.65;
}

.order-pill.next:hover {
  opacity: 1;
}

.order-pill-header {
  display: flex;
  align-items: center;
  gap: var(--sp-3);
}

.order-icon { font-size: 16px; }
.order-label {
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--lux-gold);
}

.order-summary {
  font-family: var(--font-data);
  font-size: 13px;
  color: var(--lux-cream-soft);
  margin-left: auto;
}

.expand-icon {
  font-size: 10px;
  color: var(--lux-cream-whisper);
  transition: transform var(--t-fast);
}

.order-pill.expanded .expand-icon { transform: rotate(180deg); }

.order-progress-bar-container {
  margin-top: var(--sp-3);
  display: flex;
  align-items: center;
  gap: var(--sp-3);
}

.order-progress-bar {
  flex: 1;
  height: 3px;
  background: rgba(255, 255, 255, 0.04);
  border-radius: 2px;
  overflow: hidden;
}

.order-progress-fill {
  height: 100%;
  background: var(--lux-gold);
  border-radius: 2px;
  transition: width var(--t-smooth) var(--ease-out);
}

.order-progress-text {
  font-family: var(--font-data);
  font-size: 11px;
  color: var(--lux-cream-muted);
  white-space: nowrap;
}

.order-detail {
  margin-top: var(--sp-4);
  padding-top: var(--sp-4);
  border-top: 1px solid var(--lux-border);
  display: none;
  animation: revealDown var(--t-normal) var(--ease-out);
  font-family: var(--font-ui);
  font-size: 13px;
  line-height: 1.6;
  color: var(--lux-cream-soft);
}

.order-pill.expanded .order-detail { display: block; }


/* ========================================
   COMPARISONS — Floating data chips
   ======================================== */
.comparisons {
  display: flex;
  gap: var(--sp-3);
  flex-wrap: wrap;
  justify-content: center;
}

.comparison-pill {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
  padding: 6px 16px;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid var(--lux-border-subtle);
  border-radius: 100px;
  font-family: var(--font-data);
  font-size: 12px;
  transition: all var(--t-fast);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

.comparison-pill:hover {
  border-color: var(--lux-border-accent);
  transform: translateY(-1px);
}

.comparison-label {
  color: var(--lux-cream-whisper);
  font-family: var(--font-data);
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.comparison-value {
  font-weight: 700;
  color: var(--lux-cream);
}

.comparison-value.positive { color: var(--lux-green); }
.comparison-value.negative { color: var(--lux-red); }
.comparison-value.neutral { color: var(--lux-cream-muted); }

/* Streak pill */
.streak-pill { border-color: rgba(228, 170, 79, 0.12); }
.streak-icon { color: var(--lux-gold); font-size: 14px; display: flex; }
.streak-value {
  font-family: var(--font-data);
  font-weight: 700;
  color: var(--lux-gold);
  font-size: 14px;
}


/* ========================================
   INFO BAR — Trimmer stats strip
   ======================================== */
.info-bar {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--sp-4);
  padding: var(--sp-3) var(--sp-5);
  background: rgba(255, 255, 255, 0.015);
  border: 1px solid var(--lux-border-subtle);
  border-radius: 100px;
  width: fit-content;
  max-width: 760px;
  flex-wrap: wrap;
}

.info-section {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
  font-family: var(--font-data);
  font-size: 12px;
  color: var(--lux-cream-soft);
}

.info-icon {
  color: var(--lux-cream-whisper);
  font-size: 14px;
  display: flex;
}

.info-divider {
  width: 1px;
  height: 14px;
  background: var(--lux-border-subtle);
}

.avg-best-container {
  display: flex;
  align-items: center;
  gap: var(--sp-4);
}

.avg-best-container.hidden { display: none; }

.stat-group {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
}

.stat-group .label {
  font-family: var(--font-data);
  font-size: 9px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--lux-cream-whisper);
}

.stat-group .value {
  font-family: var(--font-data);
  font-size: 13px;
  font-weight: 700;
  color: var(--lux-cream);
}

.avg-best-toggle {
  background: transparent;
  border: none;
  color: var(--lux-cream-whisper);
  cursor: pointer;
  padding: 4px;
  font-size: 14px;
  display: flex;
  align-items: center;
  transition: color var(--t-fast);
}

.avg-best-toggle:hover { color: var(--lux-gold); }


/* ========================================
   HOURLY CHART — Full-width cinematic
   ======================================== */
.chart-container {
  width: 100%;
  max-width: 760px;
  background: var(--lux-surface);
  border: 1px solid var(--lux-border-subtle);
  border-radius: var(--r-xl);
  padding: var(--sp-5);
  transition: all var(--t-normal) var(--ease-out);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.chart-container:hover { border-color: var(--lux-border-accent); }

.chart-header {
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--lux-cream-whisper);
  margin-bottom: var(--sp-4);
}

.chart-wrapper {
  position: relative;
  height: 200px;
}

.chart-wrapper canvas {
  width: 100% !important;
  height: 100% !important;
}


/* ========================================
   INSTRUMENT PANEL — Right Side
   Cockpit: precision instruments, alive, integrated
   ======================================== */
.timer-panel {
  grid-column: 2;
  grid-row: 1 / -1;
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--sp-4);
  padding: var(--sp-7) var(--sp-5);
  position: relative;
  scrollbar-width: none;
  transition: background var(--t-smooth) var(--ease-out), border-color var(--t-smooth);
  /* Integrated feel — no hard border, gradient fade */
  background: linear-gradient(90deg, rgba(255, 255, 255, 0.01) 0%, rgba(255, 255, 255, 0.025) 100%);
  border-left: 1px solid var(--lux-border-subtle);
}

/* Vertical accent line */
.timer-panel::before {
  content: '';
  position: absolute;
  top: 10%;
  bottom: 10%;
  left: 0;
  width: 1px;
  background: linear-gradient(180deg, transparent, var(--lux-gold-dim), var(--lux-gold), var(--lux-gold-dim), transparent);
  opacity: 0.3;
}

.timer-panel::-webkit-scrollbar { display: none; }

/* Timer panel state accents */
.timer-panel.green {
  border-left-color: rgba(124, 184, 136, 0.12);
}
.timer-panel.green::before {
  background: linear-gradient(180deg, transparent, rgba(124, 184, 136, 0.15), rgba(124, 184, 136, 0.3), rgba(124, 184, 136, 0.15), transparent);
}

.timer-panel.yellow {
  border-left-color: rgba(59, 130, 246, 0.12);
}
.timer-panel.yellow::before {
  background: linear-gradient(180deg, transparent, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.3), rgba(59, 130, 246, 0.15), transparent);
}

.timer-panel.red {
  border-left-color: rgba(217, 107, 94, 0.15);
}
.timer-panel.red::before {
  background: linear-gradient(180deg, transparent, rgba(217, 107, 94, 0.15), rgba(217, 107, 94, 0.3), rgba(217, 107, 94, 0.15), transparent);
  animation: panelPulse 1.8s ease-in-out infinite;
}

.timer-panel.neutral {
  border-left-color: var(--lux-border-subtle);
}

/* Drag handle (mobile) */
.drag-handle {
  display: none;
  width: 40px;
  height: 4px;
  background: var(--lux-cream-whisper);
  border-radius: 2px;
  margin-bottom: var(--sp-2);
}

.expand-hint { display: none; }

.fullscreen-toggle {
  position: absolute;
  top: var(--sp-3);
  right: var(--sp-3);
  background: transparent;
  border: none;
  color: var(--lux-cream-whisper);
  font-size: 16px;
  cursor: pointer;
  padding: 8px;
  border-radius: var(--r-sm);
  transition: all var(--t-fast);
  display: flex;
  z-index: 10;
}

.fullscreen-toggle:hover {
  color: var(--lux-gold);
  background: var(--lux-gold-dim);
}


/* ========================================
   SCALE RING & TIMER RING — Precision chronograph
   Enhanced tick marks, metallic gradients, outer ring effects
   ======================================== */
.scale-section {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.scale-header,
.timer-header {
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.25em;
  color: var(--lux-cream-whisper);
  margin-bottom: var(--sp-3);
}

.scale-display,
.timer-display {
  position: relative;
  width: var(--ring-size);
  height: var(--ring-size);
  /* Outer ring effect via box-shadow */
  border-radius: 50%;
  box-shadow:
    0 0 0 1px rgba(255, 255, 255, 0.03),
    0 0 0 3px rgba(228, 170, 79, 0.04),
    0 0 30px rgba(0, 0, 0, 0.3);
}

/* SVG ring styling — precision instrument */
.scale-ring,
.timer-ring {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}

/* Tick marks on rings — enhanced visibility */
.ring-ticks line {
  transition: stroke var(--t-normal);
  stroke-opacity: 0.15;
}

/* Major ticks (every 90deg) — bolder */
.ring-ticks line.major,
.ring-ticks line:nth-child(4n+1) {
  stroke-opacity: 0.3;
  stroke-width: 2;
}

/* Minor ticks — subtle gradations */
.ring-ticks line.minor {
  stroke-opacity: 0.08;
  stroke-width: 0.5;
}

/* Ring backgrounds — subtle metallic gradient effect */
.scale-ring-bg,
.timer-ring-bg {
  fill: none;
  stroke: rgba(255, 255, 255, 0.035);
  stroke-width: 2;
}

/* Secondary outer ring track for depth */
.scale-ring-outer,
.timer-ring-outer {
  fill: none;
  stroke: rgba(255, 255, 255, 0.015);
  stroke-width: 1;
}

.scale-ring-progress {
  fill: none;
  stroke: var(--lux-gold);
  stroke-width: 3;
  stroke-linecap: round;
  transition: stroke-dashoffset 0.8s var(--ease-out);
}

.timer-ring-progress {
  fill: none;
  stroke-width: 3;
  stroke-linecap: round;
  transition: stroke-dashoffset 1s linear;
}

.timer-ring-progress.green {
  stroke: var(--lux-green);
}

.timer-ring-progress.yellow {
  stroke: #3b82f6;
}

.timer-ring-progress.red {
  stroke: var(--lux-red);
  animation: ringPulse 1.5s ease-in-out infinite;
}

.timer-ring-progress.neutral {
  stroke: var(--lux-cream-whisper);
  filter: none;
}

/* Center readout */
.scale-center,
.timer-center {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.scale-value,
.timer-value {
  font-family: var(--font-hero);
  font-size: 46px;
  font-weight: 900;
  color: var(--lux-cream);
  line-height: 1;
  letter-spacing: -0.03em;
}

.timer-value.green { color: var(--lux-green); }
.timer-value.yellow { color: #3b82f6; }
.timer-value.red { color: var(--lux-red); }
.timer-value.neutral { color: var(--lux-cream-muted); }

.scale-label,
.timer-label {
  font-family: var(--font-data);
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--lux-cream-muted);
  margin-top: 4px;
}

.scale-status-dot {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--status-gray);
  transition: all var(--t-fast);
}

.scale-status-dot.connected {
  background: var(--lux-green);
  box-shadow: 0 0 8px rgba(124, 184, 136, 0.6);
  animation: dotPulse 3s ease-in-out infinite;
}

.scale-status-dot.stale {
  background: var(--lux-red);
}

/* Scale states */
.scale-display.filling .scale-ring-progress { stroke: var(--lux-gold); }
.scale-display.near-target .scale-ring-progress { stroke: var(--lux-yellow); }
.scale-display.at-target .scale-ring-progress {
  stroke: var(--lux-green);
}

/* Timer target info */
.timer-target {
  font-family: var(--font-data);
  font-size: 10px;
  color: var(--lux-cream-muted);
  text-align: center;
  letter-spacing: 0.05em;
}


/* ========================================
   BUTTON ROW — Bag Complete + Pause
   ======================================== */
.timer-btn-row {
  display: flex;
  gap: var(--sp-3);
  width: 100%;
  max-width: 320px;
}

.manual-btn {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--sp-2);
  padding: 14px var(--sp-5);
  background: transparent;
  border: 1.5px solid var(--lux-gold);
  border-radius: var(--r-md);
  color: var(--lux-gold);
  font-family: var(--font-ui);
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all var(--t-fast) var(--ease-out);
  letter-spacing: 0.02em;
}

.manual-btn .icon {
  font-size: 18px;
  display: flex;
}

.manual-btn:hover {
  background: var(--lux-gold-dim);
  transform: translateY(-1px);
  box-shadow: 0 4px 20px rgba(228, 170, 79, 0.15);
}

.manual-btn:active { transform: translateY(0); }

/* Button color states */
.manual-btn.btn-green {
  border-color: var(--lux-green);
  color: var(--lux-green);
}
.manual-btn.btn-green:hover { background: var(--lux-green-dim); }

.manual-btn.btn-yellow {
  border-color: #3b82f6;
  color: #3b82f6;
}

.manual-btn.btn-red {
  border-color: var(--lux-red);
  color: var(--lux-red);
}
.manual-btn.btn-red:hover { background: var(--lux-red-dim); }

.manual-btn.btn-neutral {
  border-color: var(--lux-cream-whisper);
  color: var(--lux-cream-muted);
}

/* Loading / success / error states */
.manual-btn.loading { opacity: 0.6; pointer-events: none; }
.manual-btn.success { border-color: var(--lux-green); color: var(--lux-green); background: var(--lux-green-dim); }
.manual-btn.error { border-color: var(--lux-red); color: var(--lux-red); background: var(--lux-red-dim); }

.pause-btn {
  width: 48px;
  height: 48px;
  border-radius: var(--r-md);
  border: 1px solid var(--lux-border-subtle);
  background: transparent;
  color: var(--lux-cream-muted);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--t-fast);
  flex-shrink: 0;
}

.pause-btn:hover {
  border-color: var(--lux-border-accent);
  color: var(--lux-gold);
}

.pause-btn.paused {
  border-color: #f97316;
  color: #f97316;
  background: rgba(249, 115, 22, 0.1);
}


/* ========================================
   TIMER STATS — Compact data row
   ======================================== */
.timer-stats {
  display: flex;
  gap: var(--sp-2);
  width: 100%;
  max-width: 320px;
}

.timer-stat {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--sp-3) var(--sp-2);
  background: rgba(255, 255, 255, 0.015);
  border: 1px solid var(--lux-border-subtle);
  border-radius: var(--r-sm);
  transition: all var(--t-fast);
}

.timer-stat:hover {
  border-color: var(--lux-border-accent);
  background: rgba(255, 255, 255, 0.025);
}

.timer-stat-label {
  font-family: var(--font-data);
  font-size: 9px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--lux-cream-whisper);
  margin-bottom: 4px;
}

.timer-stat-value {
  font-family: var(--font-data);
  font-size: 16px;
  font-weight: 700;
  color: var(--lux-cream);
  font-variant-numeric: tabular-nums;
}

.timer-stat-value.positive { color: var(--lux-green); }
.timer-stat-value.negative { color: var(--lux-red); }


/* ========================================
   CYCLE HISTORY — All 5 modes
   Stats bar, donut, sparkline, chips, cards, list
   ======================================== */
.cycle-history {
  width: 100%;
  max-width: 320px;
}

.cycle-history-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--sp-3);
}

.cycle-history-title {
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--lux-cream-whisper);
}

.cycle-history-nav {
  display: flex;
  align-items: center;
  gap: var(--sp-1);
}

.cycle-nav-btn {
  background: transparent;
  border: 1px solid var(--lux-border-subtle);
  color: var(--lux-cream-muted);
  width: 28px;
  height: 28px;
  border-radius: var(--r-sm);
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--t-fast);
}

.cycle-nav-btn:hover {
  border-color: var(--lux-border-accent);
  color: var(--lux-gold);
}

.cycle-mode-label {
  font-family: var(--font-data);
  font-size: 10px;
  color: var(--lux-cream-muted);
  min-width: 48px;
  text-align: center;
}

.cycle-history-toggle,
#cycleToggle {
  background: transparent;
  border: none;
  color: var(--lux-cream-whisper);
  font-family: var(--font-data);
  font-size: 10px;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: var(--r-sm);
  transition: color var(--t-fast);
}

.cycle-history-toggle:hover { color: var(--lux-gold); }

.cycle-content {
  transition: all var(--t-normal) var(--ease-out);
}

.cycle-history.collapsed .cycle-content { display: none; }


/* --- Cycle Stats Bar (summary row above modes) --- */
.cycle-stats-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--sp-2);
  padding: var(--sp-2) 0;
  margin-bottom: var(--sp-3);
  border-bottom: 1px solid var(--lux-border-subtle);
}

.cycle-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  gap: 2px;
}

.cycle-stat-value {
  font-family: var(--font-data);
  font-size: 16px;
  font-weight: 700;
  color: var(--lux-cream);
  font-variant-numeric: tabular-nums;
  line-height: 1;
}

.cycle-stat-label {
  font-family: var(--font-data);
  font-size: 8px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--lux-cream-whisper);
}


/* --- Cycle Donut Mode --- */
.cycle-donut {
  display: flex;
  align-items: center;
  gap: var(--sp-4);
}

.cycle-donut-ring {
  position: relative;
  width: 80px;
  height: 80px;
  flex-shrink: 0;
}

.cycle-donut-ring canvas {
  width: 100%;
  height: 100%;
}

.cycle-donut-center {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.cycle-donut-count {
  font-family: var(--font-hero);
  font-size: 24px;
  font-weight: 900;
  color: var(--lux-cream);
  line-height: 1;
}

.cycle-donut-label {
  font-family: var(--font-data);
  font-size: 8px;
  color: var(--lux-cream-whisper);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.cycle-donut-stats {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.cycle-donut-stat {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.cycle-donut-stat-label {
  display: flex;
  align-items: center;
  gap: 5px;
  font-family: var(--font-ui);
  font-size: 11px;
  color: var(--lux-cream-muted);
}

.cycle-donut-stat-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.cycle-donut-stat-value {
  font-family: var(--font-data);
  font-size: 14px;
  font-weight: 700;
}

.cycle-donut-latest {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid var(--lux-border-subtle);
}

.cycle-donut-latest-label {
  font-family: var(--font-data);
  font-size: 9px;
  color: var(--lux-cream-whisper);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 5px;
}

.cycle-donut-latest-items {
  display: flex;
  gap: 5px;
}

.cycle-donut-latest-item {
  flex: 1;
  padding: 5px;
  border-radius: var(--r-sm);
  text-align: center;
  background: rgba(255, 255, 255, 0.015);
  border: 1px solid var(--lux-border-subtle);
}

.cycle-donut-latest-time {
  font-family: var(--font-data);
  font-size: 14px;
  font-weight: 700;
}

.cycle-donut-latest-num {
  font-family: var(--font-data);
  font-size: 10px;
  color: var(--lux-cream-whisper);
}


/* --- Cycle Sparkline Mode --- */
.cycle-sparkline {
  display: flex;
  flex-direction: column;
}

.cycle-sparkline-bars {
  position: relative;
  height: 70px;
  display: flex;
  align-items: flex-end;
  gap: 2px;
  padding-bottom: 2px;
}

.cycle-sparkline-bar {
  flex: 1;
  min-width: 5px;
  max-width: 18px;
  border-radius: 2px 2px 0 0;
  transition: opacity var(--t-fast);
  cursor: default;
  position: relative;
}

.cycle-sparkline-bar:hover { opacity: 0.75; }

.cycle-sparkline-bar.early { background: var(--lux-green); }
.cycle-sparkline-bar.on-time { background: var(--lux-yellow); }
.cycle-sparkline-bar.overtime { background: var(--lux-red); }

.cycle-sparkline-target {
  position: absolute;
  left: 0;
  right: 0;
  border-top: 1px dashed var(--lux-cream-whisper);
  pointer-events: none;
}

.cycle-sparkline-tooltip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.92);
  padding: 4px 8px;
  border-radius: var(--r-sm);
  font-family: var(--font-data);
  font-size: 11px;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity var(--t-fast);
  z-index: 10;
  color: var(--lux-cream);
  border: 1px solid var(--lux-border-subtle);
}

.cycle-sparkline-bar:hover .cycle-sparkline-tooltip { opacity: 1; }

.cycle-sparkline-labels {
  display: flex;
  justify-content: space-between;
  font-family: var(--font-data);
  font-size: 9px;
  color: var(--lux-cream-whisper);
  margin-top: 4px;
}


/* --- Cycle Chips Mode --- */
.cycle-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

.cycle-chip {
  width: 32px;
  height: 32px;
  border-radius: var(--r-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  cursor: default;
  transition: transform var(--t-fast);
  position: relative;
}

.cycle-chip:hover { transform: scale(1.15); }

.cycle-chip.early {
  background: rgba(124, 184, 136, 0.2);
  color: var(--lux-green);
  border: 1px solid rgba(124, 184, 136, 0.25);
}

.cycle-chip.on-time {
  background: rgba(228, 195, 79, 0.15);
  color: var(--lux-yellow);
  border: 1px solid rgba(228, 195, 79, 0.25);
}

.cycle-chip.overtime {
  background: rgba(217, 107, 94, 0.15);
  color: var(--lux-red);
  border: 1px solid rgba(217, 107, 94, 0.25);
}

.cycle-chip-tooltip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.92);
  padding: 4px 8px;
  border-radius: var(--r-sm);
  font-family: var(--font-data);
  font-size: 11px;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity var(--t-fast);
  color: var(--lux-cream);
  margin-bottom: 4px;
  z-index: 10;
  border: 1px solid var(--lux-border-subtle);
}

.cycle-chip:hover .cycle-chip-tooltip { opacity: 1; }

.cycle-chips-legend {
  display: flex;
  gap: var(--sp-3);
  margin-top: var(--sp-3);
  font-size: 10px;
}

.cycle-chips-legend-item {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--lux-cream-muted);
  font-family: var(--font-data);
}

.cycle-chips-legend-dot {
  width: 8px;
  height: 8px;
  border-radius: 2px;
}


/* --- Cycle Cards Mode --- */
.cycle-cards {
  display: flex;
  gap: 6px;
  overflow-x: auto;
  padding-bottom: 4px;
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.06) transparent;
}

.cycle-cards::-webkit-scrollbar { height: 3px; }
.cycle-cards::-webkit-scrollbar-track { background: transparent; }
.cycle-cards::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.06); border-radius: 2px; }
.cycle-cards::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.12); }

.cycle-card {
  min-width: 68px;
  padding: 8px 10px;
  background: rgba(255, 255, 255, 0.015);
  border: 1px solid var(--lux-border-subtle);
  border-radius: var(--r-sm);
  text-align: center;
  flex-shrink: 0;
  transition: all var(--t-fast);
  position: relative;
  overflow: hidden;
}

.cycle-card:hover { border-color: var(--lux-border-accent); }

.cycle-card.early {
  border-color: rgba(124, 184, 136, 0.12);
}

.cycle-card.early::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--lux-green);
  opacity: 0.4;
}

.cycle-card.overtime {
  border-color: rgba(217, 107, 94, 0.12);
}

.cycle-card.overtime::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--lux-red);
  opacity: 0.4;
}

.cycle-card .cycle-card-num,
.cycle-card-num {
  font-family: var(--font-data);
  font-size: 10px;
  color: var(--lux-cream-whisper);
}

.cycle-card .cycle-card-time,
.cycle-card-time {
  font-family: var(--font-data);
  font-size: 15px;
  font-weight: 700;
  margin-top: 2px;
}

.cycle-card.early .cycle-card-time { color: var(--lux-green); }
.cycle-card.on-time .cycle-card-time { color: var(--lux-yellow); }
.cycle-card.overtime .cycle-card-time { color: var(--lux-red); }

.cycle-card-delta {
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  margin-top: 2px;
}

.cycle-card-delta.positive { color: var(--lux-green); }
.cycle-card-delta.negative { color: var(--lux-red); }

.cycle-card-meta {
  font-family: var(--font-data);
  font-size: 9px;
  color: var(--lux-cream-whisper);
  margin-top: 4px;
  display: flex;
  flex-direction: column;
  gap: 1px;
}

.cycle-card-trimmers {
  font-family: var(--font-data);
  font-size: 9px;
  color: var(--lux-cream-muted);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 3px;
}

.carryover-badge {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  padding: 2px 6px;
  border-radius: var(--r-sm);
  background: rgba(228, 170, 79, 0.08);
  border: 1px solid rgba(228, 170, 79, 0.12);
  font-family: var(--font-data);
  font-size: 9px;
  color: var(--lux-gold);
  font-weight: 700;
  letter-spacing: 0.05em;
}

.cycle-card-progress {
  margin-top: 4px;
  height: 2px;
  background: rgba(255, 255, 255, 0.04);
  border-radius: 1px;
  overflow: hidden;
}

.cycle-card-progress-bar {
  height: 100%;
  border-radius: 1px;
  background: var(--lux-gold);
  transition: width var(--t-normal) var(--ease-out);
}

.cycle-card.early .cycle-card-progress-bar { background: var(--lux-green); }
.cycle-card.overtime .cycle-card-progress-bar { background: var(--lux-red); }


/* --- Cycle List Mode --- */
.cycle-list {
  display: flex;
  flex-direction: column;
  gap: 3px;
  max-height: 200px;
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.06) transparent;
}

.cycle-list::-webkit-scrollbar { width: 3px; }
.cycle-list::-webkit-scrollbar-track { background: transparent; }
.cycle-list::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.06); border-radius: 2px; }
.cycle-list::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.12); }

.cycle-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 10px;
  border-radius: var(--r-sm);
  background: rgba(255, 255, 255, 0.015);
  border: 1px solid transparent;
  font-family: var(--font-data);
  font-size: 12px;
  color: var(--lux-cream-soft);
  transition: all var(--t-fast);
}

.cycle-item:hover { border-color: var(--lux-border-subtle); }

.cycle-item.early {
  border-left: 2px solid rgba(124, 184, 136, 0.3);
}

.cycle-item.overtime {
  border-left: 2px solid rgba(217, 107, 94, 0.3);
}

.cycle-item-num,
.cycle-item .cycle-num {
  color: var(--lux-cream-whisper);
  font-size: 10px;
  min-width: 24px;
  font-family: var(--font-data);
}

.cycle-item-time,
.cycle-item .cycle-time {
  font-weight: 700;
  font-family: var(--font-data);
}

.cycle-item.early .cycle-time,
.cycle-item.early .cycle-item-time { color: var(--lux-green); }
.cycle-item.on-time .cycle-time,
.cycle-item.on-time .cycle-item-time { color: var(--lux-yellow); }
.cycle-item.overtime .cycle-time,
.cycle-item.overtime .cycle-item-time { color: var(--lux-red); }

.cycle-item-delta,
.cycle-item .cycle-delta {
  font-size: 11px;
  font-family: var(--font-data);
}

.cycle-item-delta.positive,
.cycle-item .cycle-delta.positive { color: var(--lux-green); }
.cycle-item-delta.negative,
.cycle-item .cycle-delta.negative { color: var(--lux-red); }

.cycle-item-completed {
  font-family: var(--font-data);
  font-size: 9px;
  color: var(--lux-cream-whisper);
  letter-spacing: 0.05em;
}

.cycle-item.carryover-badge { border-color: rgba(228, 170, 79, 0.08); }


/* ========================================
   CELEBRATION
   ======================================== */
.celebration {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 3000;
}

.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  opacity: 0;
}

.celebration-text {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-family: var(--font-hero);
  font-size: 72px;
  font-weight: 900;
  color: var(--lux-green);
  text-shadow:
    0 0 60px rgba(124, 184, 136, 0.6),
    0 0 120px rgba(124, 184, 136, 0.3);
  opacity: 0;
  animation: celebrateText 3s var(--ease-out) forwards;
  z-index: 3001;
  pointer-events: none;
  text-align: center;
  letter-spacing: -0.03em;
}


/* ========================================
   PAUSE MODAL & BANNER
   ======================================== */
.pause-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.88);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 5000;
  opacity: 0;
  visibility: hidden;
  transition: opacity var(--t-normal) var(--ease-out), visibility var(--t-normal);
}

.pause-modal-overlay.visible {
  opacity: 1;
  visibility: visible;
}

.pause-modal {
  background: rgba(20, 24, 22, 0.95);
  border-radius: var(--r-2xl);
  padding: var(--sp-7);
  max-width: 420px;
  width: 90%;
  border: 1px solid var(--lux-border-accent);
  box-shadow:
    0 32px 64px rgba(0, 0, 0, 0.6),
    0 0 80px rgba(228, 170, 79, 0.04);
  transform: scale(0.92);
  transition: transform var(--t-normal) var(--ease-spring);
}

.pause-modal-overlay.visible .pause-modal {
  transform: scale(1);
}

.pause-modal-title {
  font-family: var(--font-hero);
  font-size: 28px;
  font-weight: 700;
  color: var(--lux-gold);
  display: flex;
  align-items: center;
  gap: var(--sp-3);
  margin-bottom: var(--sp-2);
}

.pause-modal-subtitle {
  font-family: var(--font-ui);
  font-size: 14px;
  color: var(--lux-cream-muted);
  margin-bottom: var(--sp-5);
  line-height: 1.5;
}

.pause-modal-reasons {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: var(--sp-5);
}

.pause-reason-btn {
  padding: 12px 16px;
  background: var(--lux-surface);
  border: 1px solid var(--lux-border-subtle);
  color: var(--lux-cream-soft);
  border-radius: var(--r-md);
  font-family: var(--font-ui);
  font-size: 14px;
  cursor: pointer;
  transition: all var(--t-fast) var(--ease-out);
  text-align: left;
}

.pause-reason-btn:hover {
  background: var(--lux-gold-dim);
  border-color: var(--lux-border-accent);
}

.pause-reason-btn.selected {
  background: var(--lux-gold-dim);
  border-color: var(--lux-gold);
  color: var(--lux-gold);
}

.pause-custom-input {
  width: 100%;
  padding: 12px 16px;
  background: var(--lux-black);
  border: 1px solid var(--lux-border-subtle);
  border-radius: var(--r-md);
  color: var(--lux-cream);
  font-family: var(--font-ui);
  font-size: 14px;
  margin-bottom: var(--sp-5);
  transition: border-color var(--t-fast);
}

.pause-custom-input:focus {
  outline: none;
  border-color: var(--lux-gold);
}

.pause-custom-input::placeholder {
  color: var(--lux-cream-whisper);
}

.pause-modal-buttons {
  display: flex;
  gap: var(--sp-3);
}

.pause-modal-btn {
  flex: 1;
  padding: 12px 20px;
  border-radius: var(--r-md);
  font-family: var(--font-ui);
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--t-fast) var(--ease-out);
  border: none;
}

.pause-modal-btn.cancel {
  background: var(--lux-surface);
  color: var(--lux-cream-muted);
  border: 1px solid var(--lux-border-subtle);
}

.pause-modal-btn.cancel:hover {
  background: var(--lux-surface-raised);
  color: var(--lux-cream);
}

.pause-modal-btn.confirm {
  background: var(--lux-gold);
  color: var(--lux-black);
}

.pause-modal-btn.confirm:hover {
  filter: brightness(1.1);
}

.pause-modal-btn.confirm:disabled {
  opacity: 0.35;
  cursor: not-allowed;
}

/* --- Pause Banner --- */
.pause-banner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 4000;
  background: linear-gradient(135deg, #f97316, #ea580c);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--sp-4);
  padding: 12px var(--sp-6);
  font-family: var(--font-ui);
  font-size: 14px;
  font-weight: 600;
  transform: translateY(-100%);
  transition: transform var(--t-normal) var(--ease-out);
  box-shadow: 0 4px 24px rgba(249, 115, 22, 0.3);
}

.pause-banner.visible {
  transform: translateY(0);
}

.pause-banner-time {
  font-family: var(--font-data);
  font-size: 22px;
  font-weight: 700;
}

.pause-banner-reason {
  opacity: 0.85;
  font-size: 13px;
}

.pause-banner-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: #fff;
  padding: 8px 20px;
  border-radius: var(--r-md);
  font-family: var(--font-ui);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--t-fast);
}

.pause-banner-btn:hover {
  background: rgba(255, 255, 255, 0.3);
}


/* ========================================
   START DAY MODAL
   ======================================== */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 5000;
}

.modal-content {
  background: rgba(20, 24, 22, 0.95);
  border-radius: var(--r-2xl);
  padding: var(--sp-7);
  max-width: 480px;
  width: 90%;
  border: 1px solid var(--lux-border-accent);
  box-shadow:
    0 32px 64px rgba(0, 0, 0, 0.6),
    0 0 80px rgba(228, 170, 79, 0.04);
}

.modal-title {
  font-family: var(--font-hero);
  font-size: 28px;
  font-weight: 700;
  color: var(--lux-cream);
  display: flex;
  align-items: center;
  gap: var(--sp-3);
  margin-bottom: var(--sp-2);
}

.modal-title i {
  color: var(--lux-gold);
}

.modal-subtitle {
  font-family: var(--font-ui);
  font-size: 14px;
  color: var(--lux-cream-muted);
  margin-bottom: var(--sp-6);
  line-height: 1.5;
}

.time-input-wrapper {
  margin-bottom: var(--sp-5);
}

.time-input-wrapper label {
  display: block;
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--lux-cream-whisper);
  margin-bottom: var(--sp-2);
}

.time-input {
  width: 100%;
  padding: 12px 16px;
  background: var(--lux-black);
  border: 1px solid var(--lux-border-subtle);
  border-radius: var(--r-md);
  color: var(--lux-cream);
  font-family: var(--font-data);
  font-size: 18px;
  font-weight: 700;
  transition: border-color var(--t-fast);
}

.time-input:focus {
  outline: none;
  border-color: var(--lux-gold);
}

.impact-preview {
  background: var(--lux-gold-glow);
  border: 1px solid var(--lux-border-accent);
  border-radius: var(--r-md);
  padding: var(--sp-4) var(--sp-5);
  margin-bottom: var(--sp-6);
  display: flex;
  align-items: center;
  gap: var(--sp-3);
  font-family: var(--font-data);
  font-size: 13px;
  color: var(--lux-cream-soft);
}

.impact-preview i {
  color: var(--lux-gold);
  font-size: 18px;
}

.modal-actions {
  display: flex;
  gap: var(--sp-3);
}

.btn-primary {
  flex: 1;
  padding: 12px 24px;
  background: var(--lux-gold);
  color: var(--lux-black);
  border: none;
  border-radius: var(--r-md);
  font-family: var(--font-ui);
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all var(--t-fast) var(--ease-out);
}

.btn-primary:hover {
  filter: brightness(1.1);
  transform: translateY(-1px);
}

.btn-secondary {
  flex: 1;
  padding: 12px 24px;
  background: var(--lux-surface);
  color: var(--lux-cream-muted);
  border: 1px solid var(--lux-border-subtle);
  border-radius: var(--r-md);
  font-family: var(--font-ui);
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--t-fast) var(--ease-out);
}

.btn-secondary:hover {
  background: var(--lux-surface-raised);
  color: var(--lux-cream);
}


/* ========================================
   HELP MODAL
   ======================================== */
.help-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 5000;
  opacity: 0;
  visibility: hidden;
  transition: opacity var(--t-normal) var(--ease-out), visibility var(--t-normal);
}

.help-modal.visible {
  opacity: 1;
  visibility: visible;
}

.help-content {
  background: rgba(20, 24, 22, 0.95);
  border-radius: var(--r-2xl);
  padding: var(--sp-7);
  max-width: 640px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  border: 1px solid var(--lux-border-accent);
  box-shadow:
    0 32px 64px rgba(0, 0, 0, 0.6),
    0 0 80px rgba(228, 170, 79, 0.04);
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.06) transparent;
}

.help-content::-webkit-scrollbar { width: 4px; }
.help-content::-webkit-scrollbar-track { background: transparent; }
.help-content::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.06); border-radius: 2px; }

.help-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--sp-6);
}

.help-title {
  font-family: var(--font-hero);
  font-size: 28px;
  font-weight: 700;
  color: var(--lux-cream);
}

.help-close {
  background: transparent;
  border: 1px solid var(--lux-border-subtle);
  color: var(--lux-cream-muted);
  width: 36px;
  height: 36px;
  border-radius: var(--r-sm);
  cursor: pointer;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--t-fast);
}

.help-close:hover {
  border-color: var(--lux-border-accent);
  color: var(--lux-gold);
}

.help-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--sp-4);
  margin-bottom: var(--sp-6);
}

.help-item {
  background: var(--lux-surface);
  border: 1px solid var(--lux-border-subtle);
  border-radius: var(--r-md);
  padding: var(--sp-4);
}

.help-item-title {
  font-family: var(--font-data);
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--lux-gold);
  margin-bottom: var(--sp-2);
}

.help-item-desc {
  font-family: var(--font-ui);
  font-size: 13px;
  color: var(--lux-cream-soft);
  line-height: 1.5;
}

.help-colors {
  display: flex;
  flex-direction: column;
  gap: var(--sp-3);
  padding-top: var(--sp-4);
  border-top: 1px solid var(--lux-border-subtle);
}

.help-color {
  display: flex;
  align-items: center;
  gap: var(--sp-3);
  font-family: var(--font-ui);
  font-size: 13px;
  color: var(--lux-cream-soft);
}

.help-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  flex-shrink: 0;
}

.help-dot.green { background: var(--lux-green); }
.help-dot.yellow { background: var(--lux-yellow); }
.help-dot.red { background: var(--lux-red); }


/* ========================================
   DEBUG PANEL
   ======================================== */
.debug-panel {
  position: fixed;
  bottom: var(--sp-5);
  left: 50%;
  transform: translateX(-50%);
  background: rgba(20, 24, 22, 0.95);
  border: 1px solid var(--lux-gold);
  border-radius: var(--r-lg);
  padding: var(--sp-5);
  z-index: 2000;
  min-width: 340px;
  max-width: 480px;
  display: none;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5);
}

.debug-panel.active {
  display: block;
}

.debug-indicator {
  position: fixed;
  top: var(--sp-2);
  left: 50%;
  transform: translateX(-50%);
  background: var(--lux-red);
  color: #fff;
  padding: 4px 12px;
  border-radius: 100px;
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  z-index: 2001;
  display: none;
}

body.debug-active .debug-indicator {
  display: block;
}

.debug-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--sp-4);
}

.debug-header h3 {
  font-family: var(--font-data);
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--lux-gold);
}

.debug-close {
  background: transparent;
  border: 1px solid var(--lux-border-subtle);
  color: var(--lux-cream-muted);
  width: 28px;
  height: 28px;
  border-radius: var(--r-sm);
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--t-fast);
}

.debug-close:hover {
  border-color: var(--lux-border-accent);
  color: var(--lux-gold);
}

.debug-controls {
  display: flex;
  flex-direction: column;
  gap: var(--sp-3);
}

.debug-label {
  font-family: var(--font-data);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--lux-cream-whisper);
  margin-bottom: var(--sp-1);
}

.debug-buttons {
  display: flex;
  gap: var(--sp-2);
  flex-wrap: wrap;
}

.debug-buttons button {
  padding: 6px 12px;
  background: var(--lux-surface);
  border: 1px solid var(--lux-border-subtle);
  color: var(--lux-cream-soft);
  border-radius: var(--r-sm);
  font-family: var(--font-data);
  font-size: 11px;
  cursor: pointer;
  transition: all var(--t-fast);
}

.debug-buttons button:hover {
  background: var(--lux-gold-dim);
  border-color: var(--lux-border-accent);
  color: var(--lux-gold);
}

.debug-divider {
  height: 1px;
  background: var(--lux-border-subtle);
  margin: var(--sp-2) 0;
}

.debug-reset {
  width: 100%;
  padding: 8px;
  background: rgba(217, 107, 94, 0.08);
  border: 1px solid rgba(217, 107, 94, 0.2);
  color: var(--lux-red);
  border-radius: var(--r-sm);
  font-family: var(--font-data);
  font-size: 11px;
  font-weight: 700;
  cursor: pointer;
  transition: all var(--t-fast);
}

.debug-reset:hover {
  background: rgba(217, 107, 94, 0.15);
}

.debug-hint {
  font-family: var(--font-ui);
  font-size: 11px;
  color: var(--lux-cream-whisper);
  margin-top: var(--sp-3);
  text-align: center;
}

.debug-hint kbd {
  display: inline-block;
  padding: 2px 6px;
  background: var(--lux-surface);
  border: 1px solid var(--lux-border-subtle);
  border-radius: 3px;
  font-family: var(--font-data);
  font-size: 10px;
  color: var(--lux-cream-muted);
}


/* ========================================
   FAB MENU
   ======================================== */
.fab-container {
  position: fixed;
  bottom: var(--sp-6);
  right: var(--sp-6);
  z-index: 200;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: var(--sp-3);
}

.fab-button {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  border: 1px solid var(--lux-border-accent);
  background: rgba(20, 24, 22, 0.9);
  color: var(--lux-gold);
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--t-fast) var(--ease-out);
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.4),
    0 0 20px rgba(228, 170, 79, 0.06);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

.fab-button:hover {
  background: var(--lux-gold-dim);
  transform: scale(1.08);
  box-shadow:
    0 6px 28px rgba(0, 0, 0, 0.5),
    0 0 30px rgba(228, 170, 79, 0.1);
}

.fab-button[aria-expanded="true"] {
  background: var(--lux-gold);
  color: var(--lux-black);
  transform: rotate(45deg);
}

.fab-button.idle {
  animation: statusPulse 3s ease-in-out infinite;
}

.fab-button.tv-fade {
  opacity: 0.3;
  transition: opacity var(--t-smooth);
}

.fab-button.tv-fade:hover {
  opacity: 1;
}

.fab-menu {
  display: flex;
  flex-direction: column;
  background: rgba(20, 24, 22, 0.95);
  border: 1px solid var(--lux-border-accent);
  border-radius: var(--r-lg);
  overflow: hidden;
  box-shadow:
    0 16px 48px rgba(0, 0, 0, 0.5),
    0 0 40px rgba(228, 170, 79, 0.04);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  opacity: 0;
  visibility: hidden;
  transform: translateY(8px) scale(0.95);
  transition: all var(--t-fast) var(--ease-out);
  min-width: 200px;
}

.fab-menu.visible {
  opacity: 1;
  visibility: visible;
  transform: translateY(0) scale(1);
}

.fab-menu-item {
  display: flex;
  align-items: center;
  gap: var(--sp-3);
  padding: 12px var(--sp-5);
  background: transparent;
  border: none;
  color: var(--lux-cream-muted);
  font-family: var(--font-ui);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--t-fast);
  text-align: left;
  white-space: nowrap;
}

.fab-menu-item:hover {
  background: var(--lux-gold-dim);
  color: var(--lux-cream);
}

.fab-menu-item i {
  width: 18px;
  text-align: center;
  font-size: 14px;
  color: var(--lux-gold);
}

.fab-indicator {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--lux-cream-whisper);
  margin-left: auto;
  transition: background var(--t-fast);
}

.fab-indicator.on {
  background: var(--lux-green);
  box-shadow: 0 0 6px rgba(124, 184, 136, 0.5);
}

.fab-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.3);
  z-index: 199;
  opacity: 0;
  visibility: hidden;
  transition: opacity var(--t-fast), visibility var(--t-fast);
}

.fab-backdrop.visible {
  opacity: 1;
  visibility: visible;
}


/* ========================================
   STREAK BADGE
   ======================================== */
#streakBadge {
  display: none;
}


/* ========================================
   TV MODE
   ======================================== */
html.tv-mode {
  zoom: 0.65;
}

html.tv-mode .timer-panel {
  --ring-size: 250px;
}

html.tv-mode .timer-value,
html.tv-mode .scale-value {
  font-size: 56px;
}

html.tv-mode .timer-label,
html.tv-mode .scale-label {
  font-size: 11px;
}

html.tv-mode .scale-header,
html.tv-mode .timer-header {
  font-size: 12px;
}

html.tv-mode .timer-btn-row {
  max-width: 360px;
}

html.tv-mode .manual-btn {
  font-size: 16px;
  padding: 16px var(--sp-6);
}

html.tv-mode .pause-btn {
  width: 52px;
  height: 52px;
  font-size: 20px;
}

html.tv-mode .timer-stats {
  max-width: 360px;
}

html.tv-mode .timer-stat {
  padding: var(--sp-4) var(--sp-3);
}

html.tv-mode .timer-stat-label {
  font-size: 10px;
}

html.tv-mode .timer-stat-value {
  font-size: 18px;
}

html.tv-mode .cycle-history {
  max-width: 360px;
}

html.tv-mode .expand-hint {
  display: none;
}

html.tv-mode .daily-actual {
  font-size: clamp(160px, 22vw, 400px);
}

html.tv-mode .actual-lbs {
  font-size: 80px;
}

html.tv-mode .strain-name {
  font-size: 30px;
}

html.tv-mode .time-display .time {
  font-size: 44px;
}


/* ========================================
   TOUCH TARGETS (1024px and below)
   Minimum 44px for all interactive elements
   ======================================== */
@media (max-width: 1024px) {
  button,
  .pause-btn,
  .manual-btn,
  .start-day-btn,
  .lang-btn,
  .fab-button,
  .fab-menu-item,
  .cycle-nav-btn,
  .pause-reason-btn,
  .order-pill {
    min-height: 44px;
    min-width: 44px;
  }

  .cycle-nav-btn {
    width: 44px;
    height: 44px;
  }

  .lang-btn {
    min-width: 44px;
    min-height: 44px;
    padding: 8px 12px;
  }
}


/* ========================================
   HOVER STATES — Disable on touch devices
   ======================================== */
@media (hover: none) {
  .hour-card:hover {
    transform: none;
    box-shadow: none;
  }

  .comparison-pill:hover {
    transform: none;
  }

  .manual-btn:hover {
    transform: none;
    box-shadow: none;
  }

  .fab-button:hover {
    transform: none;
  }

  .btn-primary:hover {
    transform: none;
  }
}


/* ========================================
   FOCUS STATES — Accessibility
   ======================================== */
button:focus-visible,
input:focus-visible,
a:focus-visible,
select:focus-visible,
[tabindex]:focus-visible {
  outline: 2px solid var(--lux-gold);
  outline-offset: 2px;
}

/* Remove default outline when using mouse */
button:focus:not(:focus-visible),
input:focus:not(:focus-visible),
a:focus:not(:focus-visible) {
  outline: none;
}


/* ========================================
   LOADING STATES
   ======================================== */
@keyframes breathe {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.loading {
  pointer-events: none;
  animation: breathe 1.5s ease-in-out infinite;
}


/* ========================================
   UTILITY CLASSES
   ======================================== */
.hidden {
  display: none !important;
}

.visible {
  display: block !important;
}

.fade-in {
  animation: fadeIn var(--t-normal) var(--ease-out) forwards;
}

.fade-out {
  animation: fadeOut var(--t-normal) var(--ease-out) forwards;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-12px); }
  to { opacity: 1; transform: translateY(0); }
}


/* ========================================
   RESPONSIVE BREAKPOINTS
   ======================================== */

/* --- 1400px: Slightly tighter panel --- */
@media (max-width: 1400px) {
  :root {
    --panel-width: 370px;
    --ring-size: 190px;
  }

  .strain-name { font-size: 22px; }
  .time-display .time { font-size: 30px; }
  .daily-actual { font-size: clamp(120px, 18vw, 280px); }
  .actual-lbs { font-size: 56px; }
}

/* --- 1200px: Compact instruments --- */
@media (max-width: 1200px) {
  :root {
    --ring-size: 170px;
    --panel-width: 340px;
  }

  .scale-value,
  .timer-value { font-size: 38px; }

  .strain-name { font-size: 20px; }
  .time-display .time { font-size: 26px; }
  .daily-actual { font-size: clamp(100px, 16vw, 240px); }
  .actual-lbs { font-size: 48px; }

  .hud-header { padding: 0 var(--sp-5); }
}

/* --- 1024px: Tablet — stacked layout --- */
@media (max-width: 1024px) {
  body {
    display: flex;
    flex-direction: column;
    grid-template-columns: unset;
    grid-template-rows: unset;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .hud-header {
    grid-column: unset;
    flex-shrink: 0;
  }

  #main-panel,
  .main-panel {
    grid-column: unset;
    grid-row: unset;
    height: auto;
    overflow: visible;
    padding: var(--sp-5) var(--sp-5) var(--sp-6);
  }

  .timer-panel {
    grid-column: unset;
    grid-row: unset;
    height: auto;
    width: 100%;
    border-left: none;
    border-top: 1px solid var(--lux-border-subtle);
    padding: var(--sp-6) var(--sp-5);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.01) 0%, rgba(255, 255, 255, 0.025) 100%);
  }

  .timer-panel::before {
    display: none;
  }

  .drag-handle {
    display: block;
  }

  .time-controls {
    position: relative;
    top: auto;
    right: auto;
    justify-content: center;
    margin-bottom: var(--sp-3);
  }

  :root {
    --ring-size: 180px;
    --hero-size: clamp(120px, 20vw, 260px);
  }

  .daily-actual { font-size: var(--hero-size); }
  .actual-lbs { font-size: 48px; }
  .daily-target { font-size: 36px; }
  .daily-sep { font-size: 36px; }

  .hour-cards { flex-wrap: wrap; }
  .hour-card { max-width: 100%; min-width: 200px; }

  .timer-btn-row { max-width: 100%; }
  .timer-stats { max-width: 100%; }
  .cycle-history { max-width: 100%; }
}

/* --- 768px: Mobile --- */
@media (max-width: 768px) {
  :root {
    --ring-size: 150px;
    --header-height: 56px;
  }

  .hud-header {
    padding: 0 var(--sp-4);
  }

  .strain-name { font-size: 18px; max-width: 160px; }
  .strain-label { font-size: 9px; }

  .time-display .time { font-size: 22px; }
  .time-display .date { font-size: 10px; }

  .status-badge { font-size: 10px; padding: 5px 16px; }

  .daily-actual { font-size: clamp(80px, 18vw, 180px); }
  .daily-target { font-size: 28px; }
  .daily-sep { font-size: 28px; }
  .daily-unit { font-size: 9px; }
  .daily-header { font-size: 10px; }
  .actual-lbs { font-size: 40px; }
  .target-lbs { font-size: 24px; }
  .separator { font-size: 24px; }

  .scale-header,
  .timer-header { display: none; }

  .scale-value,
  .timer-value { font-size: 32px; }

  .scale-label,
  .timer-label { font-size: 8px; }

  .manual-btn { font-size: 13px; padding: 12px var(--sp-4); }
  .pause-btn { width: 44px; height: 44px; }

  .timer-stat-value { font-size: 14px; }
  .timer-stat-label { font-size: 8px; }

  .hour-card { padding: var(--sp-4); }
  .hour-card-header { font-size: 9px; }
  .lbs-unit { font-size: 9px; }

  .info-bar { padding: var(--sp-2) var(--sp-4); gap: var(--sp-3); }
  .info-section { font-size: 11px; }

  .comparisons { gap: var(--sp-2); }
  .comparison-pill { font-size: 11px; padding: 5px 12px; }

  .chart-wrapper { height: 160px; }

  #main-panel,
  .main-panel { padding: var(--sp-4) var(--sp-4) var(--sp-5); }

  .fab-container { bottom: var(--sp-4); right: var(--sp-4); }
  .fab-button { width: 48px; height: 48px; font-size: 18px; }

  .help-grid { grid-template-columns: 1fr; }
  .pause-modal { padding: var(--sp-5); }
  .modal-content { padding: var(--sp-5); }
}

/* --- 480px: Small mobile --- */
@media (max-width: 480px) {
  :root {
    --ring-size: 130px;
  }

  .daily-actual { font-size: clamp(64px, 16vw, 140px); }
  .daily-target { font-size: 22px; }
  .daily-sep { font-size: 22px; }
  .actual-lbs { font-size: 32px; }
  .target-lbs { font-size: 20px; }

  .scale-value,
  .timer-value { font-size: 28px; }

  .hour-cards { flex-direction: column; }
  .hour-card { max-width: 100%; }

  .strain-name { font-size: 16px; max-width: 120px; }

  .hud-center-marker { display: none; }

  .modal-actions { flex-direction: column; }
  .pause-modal-buttons { flex-direction: column; }
}

/* --- 400px: Tiny mobile --- */
@media (max-width: 400px) {
  :root {
    --ring-size: 110px;
  }

  .daily-actual { font-size: clamp(52px, 14vw, 120px); }
  .scale-value,
  .timer-value { font-size: 24px; }

  .hud-header { padding: 0 var(--sp-3); }
  .strain-name { font-size: 14px; }
  .time-display .time { font-size: 18px; }
}


/* ========================================
   IFRAME-EMBED MODE
   Compact layout for embedding in iframes
   ======================================== */
body.iframe-embed {
  display: flex;
  flex-direction: row;
  overflow: hidden;
}

body.iframe-embed .hud-header {
  display: none;
}

body.iframe-embed #main-panel,
body.iframe-embed .main-panel {
  flex: 1;
  height: 100vh;
  padding: var(--sp-4);
}

body.iframe-embed .timer-panel {
  width: 280px;
  --ring-size: 160px;
  padding: var(--sp-4) var(--sp-3);
  gap: var(--sp-3);
}

body.iframe-embed .daily-actual {
  font-size: clamp(80px, 12vw, 200px);
}

body.iframe-embed .actual-lbs { font-size: 42px; }
body.iframe-embed .target-lbs { font-size: 22px; }
body.iframe-embed .separator { font-size: 22px; }
body.iframe-embed .daily-target { font-size: 28px; }
body.iframe-embed .daily-sep { font-size: 28px; }

body.iframe-embed .scale-value,
body.iframe-embed .timer-value { font-size: 32px; }

body.iframe-embed .scale-label,
body.iframe-embed .timer-label { font-size: 8px; }

body.iframe-embed .manual-btn { font-size: 12px; padding: 10px var(--sp-3); }
body.iframe-embed .pause-btn { width: 40px; height: 40px; font-size: 16px; }

body.iframe-embed .timer-stat-value { font-size: 13px; }
body.iframe-embed .timer-stat-label { font-size: 8px; }

body.iframe-embed .fab-container { display: none; }
body.iframe-embed .time-controls { display: none; }
body.iframe-embed .lang-toggle { display: none; }

body.iframe-embed .hour-card { padding: var(--sp-3); }
body.iframe-embed .hour-card-header { font-size: 9px; }
body.iframe-embed .chart-wrapper { height: 120px; }

body.iframe-embed .scoreboard { gap: var(--sp-3); }

/* Iframe responsive: stacked below 900px */
@media (max-width: 900px) {
  body.iframe-embed {
    flex-direction: column;
  }

  body.iframe-embed .timer-panel {
    width: 100%;
    height: auto;
    border-left: none;
    border-top: 1px solid var(--lux-border-subtle);
    --ring-size: 140px;
  }

  body.iframe-embed #main-panel,
  body.iframe-embed .main-panel {
    height: auto;
    overflow: visible;
  }
}

/* Iframe responsive: compact below 700px */
@media (max-width: 700px) {
  body.iframe-embed .timer-panel {
    --ring-size: 120px;
  }

  body.iframe-embed .daily-actual {
    font-size: clamp(60px, 14vw, 140px);
  }

  body.iframe-embed .scale-value,
  body.iframe-embed .timer-value { font-size: 26px; }
}

/* Iframe responsive: wider panels on large screens */
@media (min-width: 1600px) {
  body.iframe-embed .timer-panel {
    width: 340px;
    --ring-size: 190px;
  }

  body.iframe-embed .scale-value,
  body.iframe-embed .timer-value { font-size: 40px; }
}


/* ========================================
   TV MODE — Extra Large Displays (2400px+)
   4K and large format TVs
   ======================================== */
@media (min-width: 2400px) {
  html.tv-mode {
    zoom: 0.8;
  }

  html.tv-mode .timer-panel {
    --ring-size: 300px;
  }

  html.tv-mode .timer-value,
  html.tv-mode .scale-value {
    font-size: 72px;
  }

  html.tv-mode .timer-label,
  html.tv-mode .scale-label {
    font-size: 14px;
  }

  html.tv-mode .scale-header,
  html.tv-mode .timer-header {
    font-size: 14px;
  }

  html.tv-mode .daily-actual {
    font-size: clamp(200px, 25vw, 500px);
  }

  html.tv-mode .actual-lbs {
    font-size: 100px;
  }

  html.tv-mode .strain-name {
    font-size: 38px;
  }

  html.tv-mode .time-display .time {
    font-size: 56px;
  }

  html.tv-mode .manual-btn {
    font-size: 20px;
    padding: 20px var(--sp-7);
  }

  html.tv-mode .pause-btn {
    width: 64px;
    height: 64px;
    font-size: 24px;
  }

  html.tv-mode .timer-stat-value {
    font-size: 22px;
  }

  html.tv-mode .timer-stat-label {
    font-size: 12px;
  }
}


/* ========================================
   PASS 4: AMBIENT COLOR SYSTEM
   Full-body mood shift driven by timer state.
   JS toggles body.timer-green / .timer-yellow / .timer-red
   ======================================== */

/* --- Ambient CSS Custom Properties per state --- */
body.timer-green {
  --ambient-color: 124, 184, 136;
  --ambient-intensity: 0.06;
  --ambient-pulse-speed: 6s;
  --ambient-glow: rgba(124, 184, 136, 0.04);
}

body.timer-yellow {
  --ambient-color: 228, 195, 79;
  --ambient-intensity: 0.09;
  --ambient-pulse-speed: 3.5s;
  --ambient-glow: rgba(228, 195, 79, 0.05);
}

body.timer-red {
  --ambient-color: 217, 107, 94;
  --ambient-intensity: 0.14;
  --ambient-pulse-speed: 1.2s;
  --ambient-glow: rgba(217, 107, 94, 0.07);
}

body.timer-neutral {
  --ambient-color: 240, 235, 224;
  --ambient-intensity: 0.02;
  --ambient-pulse-speed: 8s;
  --ambient-glow: transparent;
}

/* Ambient background gradient — radiates from center-right (timer panel side) */
body.timer-green,
body.timer-yellow,
body.timer-red {
  background-image:
    radial-gradient(ellipse 70% 80% at 80% 50%, rgba(var(--ambient-color), var(--ambient-intensity)) 0%, transparent 70%),
    radial-gradient(ellipse 40% 50% at 20% 70%, rgba(var(--ambient-color), calc(var(--ambient-intensity) * 0.4)) 0%, transparent 60%),
    radial-gradient(ellipse 90% 60% at 50% 100%, rgba(var(--ambient-color), calc(var(--ambient-intensity) * 0.25)) 0%, transparent 50%);
}

/* Ambient breathing animation — whole body breathes with the timer state */
@keyframes ambientBreathe {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.88; }
}

@keyframes ambientBreatheUrgent {
  0%, 100% { opacity: 1; }
  30% { opacity: 0.82; }
  60% { opacity: 0.95; }
}

body.timer-green {
  animation: ambientBreathe 6s ease-in-out infinite;
}

body.timer-yellow {
  animation: ambientBreathe 3.5s ease-in-out infinite;
}

body.timer-red {
  animation: ambientBreatheUrgent 1.2s ease-in-out infinite;
}

/* --- Status badge picks up ambient color --- */
body.timer-green .status-badge {
  background: rgba(124, 184, 136, 0.08);
  color: var(--lux-green);
  border-color: rgba(124, 184, 136, 0.18);
  box-shadow: 0 0 24px rgba(124, 184, 136, 0.06);
}

body.timer-yellow .status-badge {
  background: rgba(228, 195, 79, 0.08);
  color: var(--lux-yellow);
  border-color: rgba(228, 195, 79, 0.18);
  box-shadow: 0 0 24px rgba(228, 195, 79, 0.06);
}

body.timer-red .status-badge {
  background: rgba(217, 107, 94, 0.1);
  color: var(--lux-red);
  border-color: rgba(217, 107, 94, 0.2);
  box-shadow: 0 0 30px rgba(217, 107, 94, 0.08);
  animation: statusPulse 1.2s ease-in-out infinite;
}

/* --- Header accent line picks up ambient color --- */
body.timer-green .hud-header::after {
  background: linear-gradient(90deg, transparent, rgba(124, 184, 136, 0.1), rgba(124, 184, 136, 0.3), rgba(124, 184, 136, 0.1), transparent);
}

body.timer-yellow .hud-header::after {
  background: linear-gradient(90deg, transparent, rgba(228, 195, 79, 0.1), rgba(228, 195, 79, 0.35), rgba(228, 195, 79, 0.1), transparent);
}

body.timer-red .hud-header::after {
  background: linear-gradient(90deg, transparent, rgba(217, 107, 94, 0.15), rgba(217, 107, 94, 0.5), rgba(217, 107, 94, 0.15), transparent);
  opacity: 0.8;
}

/* --- Edge glows pick up ambient color --- */
body.timer-green .edge-glow {
  background: rgba(124, 184, 136, 0.03);
  box-shadow: inset 0 0 60px rgba(124, 184, 136, 0.04);
}

body.timer-yellow .edge-glow {
  background: rgba(228, 195, 79, 0.03);
  box-shadow: inset 0 0 60px rgba(228, 195, 79, 0.05);
}

body.timer-red .edge-glow {
  background: rgba(217, 107, 94, 0.04);
  box-shadow: inset 0 0 80px rgba(217, 107, 94, 0.06);
}

/* --- Daily progress card border picks up ambient color --- */
body.timer-green .daily-progress {
  border-color: rgba(124, 184, 136, 0.08);
}

body.timer-yellow .daily-progress {
  border-color: rgba(228, 195, 79, 0.08);
}

body.timer-red .daily-progress {
  border-color: rgba(217, 107, 94, 0.12);
  box-shadow: 0 0 40px rgba(217, 107, 94, 0.04);
}


/* ========================================
   PASS 4: TIMER RING ANIMATIONS
   State-driven glow/pulse on the timer ring.
   Green = calm, Yellow = tension, Red = URGENT
   ======================================== */

/* --- Green: calm, smooth, zen breathing --- */
@keyframes timerGlowGreen {
  0%, 100% {
    filter: drop-shadow(0 0 4px rgba(124, 184, 136, 0.3)) drop-shadow(0 0 8px rgba(124, 184, 136, 0.15));
  }
  50% {
    filter: drop-shadow(0 0 8px rgba(124, 184, 136, 0.45)) drop-shadow(0 0 16px rgba(124, 184, 136, 0.2));
  }
}

.timer-ring-progress.green {
  filter: drop-shadow(0 0 4px rgba(124, 184, 136, 0.3));
  animation: timerGlowGreen 4s ease-in-out infinite;
}

.timer-ring-glow {
  transition: opacity var(--t-smooth), stroke var(--t-smooth);
}

body.timer-green .timer-ring-glow {
  opacity: 0.25;
}

body.timer-green .timer-display {
  box-shadow:
    0 0 0 1px rgba(124, 184, 136, 0.04),
    0 0 0 3px rgba(124, 184, 136, 0.03),
    0 0 40px rgba(124, 184, 136, 0.06);
}

/* --- Yellow: pulsing, tension building, warning --- */
@keyframes timerGlowYellow {
  0%, 100% {
    filter: drop-shadow(0 0 6px rgba(228, 195, 79, 0.35)) drop-shadow(0 0 14px rgba(228, 195, 79, 0.15));
  }
  40% {
    filter: drop-shadow(0 0 12px rgba(228, 195, 79, 0.55)) drop-shadow(0 0 28px rgba(228, 195, 79, 0.25));
  }
  70% {
    filter: drop-shadow(0 0 8px rgba(228, 195, 79, 0.4)) drop-shadow(0 0 18px rgba(228, 195, 79, 0.18));
  }
}

.timer-ring-progress.yellow {
  animation: timerGlowYellow 2.5s ease-in-out infinite;
}

body.timer-yellow .timer-ring-glow {
  opacity: 0.35;
}

body.timer-yellow .timer-display {
  box-shadow:
    0 0 0 1px rgba(228, 195, 79, 0.06),
    0 0 0 3px rgba(228, 195, 79, 0.04),
    0 0 50px rgba(228, 195, 79, 0.08);
}

/* --- Red: URGENT, thick hammering pulse, impossible to ignore --- */
@keyframes timerGlowRed {
  0% {
    filter: drop-shadow(0 0 8px rgba(217, 107, 94, 0.5)) drop-shadow(0 0 20px rgba(217, 107, 94, 0.25));
    stroke-width: 3;
  }
  25% {
    filter: drop-shadow(0 0 18px rgba(217, 107, 94, 0.8)) drop-shadow(0 0 40px rgba(217, 107, 94, 0.4)) drop-shadow(0 0 60px rgba(217, 107, 94, 0.15));
    stroke-width: 5;
  }
  50% {
    filter: drop-shadow(0 0 10px rgba(217, 107, 94, 0.55)) drop-shadow(0 0 24px rgba(217, 107, 94, 0.3));
    stroke-width: 3.5;
  }
  75% {
    filter: drop-shadow(0 0 16px rgba(217, 107, 94, 0.7)) drop-shadow(0 0 36px rgba(217, 107, 94, 0.35));
    stroke-width: 4.5;
  }
  100% {
    filter: drop-shadow(0 0 8px rgba(217, 107, 94, 0.5)) drop-shadow(0 0 20px rgba(217, 107, 94, 0.25));
    stroke-width: 3;
  }
}

.timer-ring-progress.red {
  animation: timerGlowRed 1.2s ease-in-out infinite;
}

body.timer-red .timer-ring-glow {
  opacity: 0.5;
}

body.timer-red .timer-display {
  box-shadow:
    0 0 0 1px rgba(217, 107, 94, 0.08),
    0 0 0 3px rgba(217, 107, 94, 0.06),
    0 0 60px rgba(217, 107, 94, 0.12),
    0 0 100px rgba(217, 107, 94, 0.05);
}

/* Red state: timer value itself throbs */
@keyframes timerValueThrob {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

body.timer-red .timer-value {
  animation: timerValueThrob 1.2s ease-in-out infinite;
}

/* Red state: the tick marks on the ring light up */
body.timer-red .timer-display .ring-ticks line.major {
  stroke: rgba(217, 107, 94, 0.4) !important;
  stroke-opacity: 0.6;
}

body.timer-red .timer-display .ring-ticks line {
  stroke-opacity: 0.25;
}

/* Yellow state: tick marks warm up */
body.timer-yellow .timer-display .ring-ticks line.major {
  stroke: rgba(228, 195, 79, 0.3) !important;
  stroke-opacity: 0.4;
}

/* Green state: tick marks stay calm */
body.timer-green .timer-display .ring-ticks line.major {
  stroke: rgba(124, 184, 136, 0.2) !important;
  stroke-opacity: 0.3;
}


/* ========================================
   PASS 4: SCALE RING — Precision Instrument
   Enhanced tick marks for chronograph feel.
   Outer bezel glow, crisp major ticks, subtle dial texture.
   ======================================== */

/* Tick marks enhanced visibility on hover */
.scale-display:hover .ring-ticks line.major {
  stroke-opacity: 0.5;
  stroke: rgba(228, 170, 79, 0.4);
}

.scale-display:hover .ring-ticks line {
  stroke-opacity: 0.2;
}

/* Outer bezel — very faint concentric rings for instrument depth */
.scale-display::before {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: 50%;
  background: conic-gradient(
    from 0deg,
    rgba(228, 170, 79, 0.02) 0deg,
    transparent 10deg,
    rgba(228, 170, 79, 0.015) 30deg,
    transparent 40deg,
    rgba(228, 170, 79, 0.02) 90deg,
    transparent 100deg,
    rgba(228, 170, 79, 0.015) 120deg,
    transparent 130deg,
    rgba(228, 170, 79, 0.02) 180deg,
    transparent 190deg,
    rgba(228, 170, 79, 0.015) 210deg,
    transparent 220deg,
    rgba(228, 170, 79, 0.02) 270deg,
    transparent 280deg,
    rgba(228, 170, 79, 0.015) 300deg,
    transparent 310deg,
    rgba(228, 170, 79, 0.02) 360deg
  );
  pointer-events: none;
  z-index: -1;
}

/* Timer display also gets the bezel treatment */
.timer-display::before {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: 50%;
  background: conic-gradient(
    from 0deg,
    rgba(228, 170, 79, 0.02) 0deg,
    transparent 10deg,
    rgba(228, 170, 79, 0.015) 30deg,
    transparent 40deg,
    rgba(228, 170, 79, 0.02) 90deg,
    transparent 100deg,
    rgba(228, 170, 79, 0.015) 120deg,
    transparent 130deg,
    rgba(228, 170, 79, 0.02) 180deg,
    transparent 190deg,
    rgba(228, 170, 79, 0.015) 210deg,
    transparent 220deg,
    rgba(228, 170, 79, 0.02) 270deg,
    transparent 280deg,
    rgba(228, 170, 79, 0.015) 300deg,
    transparent 310deg,
    rgba(228, 170, 79, 0.02) 360deg
  );
  pointer-events: none;
  z-index: -1;
}

/* Scale ring at-target state: ticks glow gold */
.scale-display.at-target .ring-ticks line.major {
  stroke: rgba(124, 184, 136, 0.35);
  stroke-opacity: 0.5;
}

/* Scale ring near-target state: ticks warm up */
.scale-display.near-target .ring-ticks line.major {
  stroke: rgba(228, 195, 79, 0.3);
  stroke-opacity: 0.4;
}


/* ========================================
   PASS 4: TV MODE BOOST
   For body.tv-mode on 4K TVs at 15+ feet.
   Everything bigger, bolder, higher contrast.
   Remove clutter, maximize signal.
   ======================================== */

/* Hero number: push it even harder */
html.tv-mode .daily-actual {
  text-shadow:
    0 0 100px rgba(240, 235, 224, 0.12),
    0 0 200px rgba(228, 170, 79, 0.06);
}

/* Timer value: extra large with glow for distance */
html.tv-mode .timer-value {
  text-shadow: 0 0 30px currentColor;
}

/* Scale value: same treatment */
html.tv-mode .scale-value {
  text-shadow: 0 0 20px rgba(240, 235, 224, 0.15);
}

/* Bigger delta pill */
html.tv-mode .daily-delta {
  font-size: 24px;
  padding: 8px 20px;
}

/* Percentage values bigger */
html.tv-mode .percentage-value {
  font-size: 30px;
}

/* Last hour actual — bigger */
html.tv-mode .actual-lbs {
  text-shadow: 0 0 20px rgba(240, 235, 224, 0.08);
}

/* Target/separator bigger */
html.tv-mode .daily-target,
html.tv-mode .daily-sep {
  font-size: 64px;
}

/* Progress bar thicker for TV */
html.tv-mode .progress-bar {
  height: 5px;
}

html.tv-mode .progress-fill::after {
  width: 16px;
  top: -6px;
  bottom: -6px;
}

/* Projection row bigger */
html.tv-mode .projection-value {
  font-size: 22px;
}

html.tv-mode .projection-delta {
  font-size: 18px;
}

/* Info bar bigger */
html.tv-mode .info-section {
  font-size: 15px;
}

html.tv-mode .info-icon {
  font-size: 18px;
}

/* Comparison pills bigger */
html.tv-mode .comparison-pill {
  font-size: 14px;
  padding: 8px 20px;
}

html.tv-mode .comparison-value {
  font-size: 16px;
}

/* Streak value bigger */
html.tv-mode .streak-value {
  font-size: 18px;
}

/* Hour card header bigger */
html.tv-mode .hour-card-header {
  font-size: 12px;
}

/* Daily header bigger */
html.tv-mode .daily-header {
  font-size: 13px;
}

/* Status badge bigger for TV */
html.tv-mode .status-badge {
  font-size: 13px;
  padding: 8px 28px;
  letter-spacing: 0.2em;
}

/* Strain label/name boosted */
html.tv-mode .strain-label {
  font-size: 12px;
}

/* Date display bigger */
html.tv-mode .time-display .date {
  font-size: 13px;
}

/* Remove clutter that doesn't read at distance */
html.tv-mode .lbs-unit {
  font-size: 12px;
}

html.tv-mode .daily-unit {
  font-size: 13px;
}

/* Timer ring glow extra intense for TV distance */
html.tv-mode .timer-ring-progress.green {
  stroke-width: 4;
}

html.tv-mode .timer-ring-progress.yellow {
  stroke-width: 4;
}

html.tv-mode .timer-ring-progress.red {
  stroke-width: 5;
}

/* Ambient effects more dramatic on TV */
html.tv-mode body.timer-red .timer-display {
  box-shadow:
    0 0 0 2px rgba(217, 107, 94, 0.1),
    0 0 0 4px rgba(217, 107, 94, 0.06),
    0 0 80px rgba(217, 107, 94, 0.15),
    0 0 140px rgba(217, 107, 94, 0.06);
}

/* Timer panel accent line thicker */
html.tv-mode .timer-panel::before {
  width: 2px;
}

/* Hour cards bigger padding */
html.tv-mode .hour-card {
  padding: var(--sp-6) var(--sp-7);
}

/* Timer target text bigger */
html.tv-mode .timer-target {
  font-size: 13px;
}


/* ========================================
   PASS 4: BACKGROUND DEPTH
   Subtle noise/grain overlay + centered radial gradient.
   Adds dimensionality without distracting.
   ======================================== */

/* Enhanced film grain — slightly stronger for cinematic depth */
body::before {
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  opacity: 0.035;
}

/* Center stage spotlight — very gentle radial light from the hero area */
body::after {
  background:
    radial-gradient(ellipse 60% 50% at 35% 45%, rgba(240, 235, 224, 0.012) 0%, transparent 60%),
    radial-gradient(ellipse 80% 70% at 35% 50%, transparent 0%, rgba(0, 0, 0, 0.45) 100%);
}

/* Ambient layer — inherits timer color for cinematic wash */
.ambient-layer {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -1;
  opacity: 0;
  transition: opacity var(--t-dramatic) var(--ease-cinematic);
}

body.timer-green .ambient-layer {
  opacity: 1;
  background: radial-gradient(ellipse 100% 80% at 75% 50%, rgba(124, 184, 136, 0.025) 0%, transparent 70%);
}

body.timer-yellow .ambient-layer {
  opacity: 1;
  background: radial-gradient(ellipse 100% 80% at 75% 50%, rgba(228, 195, 79, 0.03) 0%, transparent 70%);
}

body.timer-red .ambient-layer {
  opacity: 1;
  background:
    radial-gradient(ellipse 100% 80% at 75% 50%, rgba(217, 107, 94, 0.04) 0%, transparent 70%),
    radial-gradient(ellipse 50% 40% at 50% 50%, rgba(217, 107, 94, 0.02) 0%, transparent 60%);
}

/* Ambient particles canvas — positioned behind everything */
.ambient-particles {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -1;
  opacity: 0.3;
}


/* ========================================
   TRANSITION REFINEMENTS
   Shared transitions for interactive elements
   ======================================== */
.hour-card,
.daily-progress,
.comparison-pill,
.info-bar,
.chart-container,
.order-pill,
.cycle-card,
.cycle-item,
.timer-stat {
  transition:
    background var(--t-fast) var(--ease-out),
    border-color var(--t-fast) var(--ease-out),
    transform var(--t-fast) var(--ease-out),
    box-shadow var(--t-fast) var(--ease-out);
}


/* ========================================
   REDUCED MOTION
   Respect user preference for less animation
   ======================================== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  .celebration-text,
  .confetti,
  .status-badge,
  .progress-fill::after,
  .fab-button.idle,
  .scale-status-dot.connected,
  .timer-ring-progress,
  .timer-value {
    animation: none !important;
  }

  .topo-bg,
  body .topo-contours {
    animation: none !important;
  }

  body.timer-red,
  body.timer-yellow,
  body.timer-green {
    animation: none !important;
  }
}


/* ========================================
   HIGH CONTRAST
   Boost readability for high-contrast preference
   ======================================== */
@media (prefers-contrast: high) {
  :root {
    --lux-cream: #ffffff;
    --lux-cream-soft: rgba(255, 255, 255, 0.9);
    --lux-cream-muted: rgba(255, 255, 255, 0.6);
    --lux-cream-whisper: rgba(255, 255, 255, 0.4);
    --lux-border-subtle: rgba(255, 255, 255, 0.12);
    --lux-border-accent: rgba(228, 170, 79, 0.4);
  }

  .status-badge {
    border-width: 2px;
  }

  .hour-card,
  .chart-container,
  .timer-stat,
  .order-pill {
    border-width: 2px;
  }
}


/* ========================================
   PRINT STYLES
   Clean output for printing
   ======================================== */
@media print {
  body {
    background: #fff !important;
    color: #000 !important;
    display: block !important;
    overflow: visible !important;
  }

  body::before,
  body::after,
  .topo-bg,
  body .topo-contours {
    display: none !important;
  }

  .timer-panel,
  .fab-container,
  .fab-backdrop,
  .lang-toggle,
  .time-controls,
  .pause-banner,
  .pause-modal-overlay,
  .help-modal,
  .debug-panel,
  .debug-indicator,
  .celebration,
  .celebration-text,
  .skip-link {
    display: none !important;
  }

  .hud-header {
    border-bottom: 2px solid #000;
  }

  .hud-header::after {
    display: none;
  }

  .strain-name,
  .daily-actual,
  .actual-lbs,
  .time-display .time {
    color: #000 !important;
    text-shadow: none !important;
  }

  .daily-progress,
  .hour-card,
  .chart-container,
  .info-bar,
  .order-pill {
    background: transparent !important;
    border-color: #ccc !important;
    backdrop-filter: none !important;
    box-shadow: none !important;
  }

  .status-badge {
    border: 2px solid currentColor !important;
    background: transparent !important;
    backdrop-filter: none !important;
  }

  .progress-fill::after {
    display: none;
  }

  #main-panel,
  .main-panel {
    height: auto !important;
    overflow: visible !important;
  }

  * {
    animation: none !important;
    transition: none !important;
  }
}
