<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rogue Origin - Operations Hub</title>

  <!-- Fonts: DM Serif Display, JetBrains Mono, Outfit (Organic Industrial) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Muuri.js for drag-and-drop -->
  <script src="https://cdn.jsdelivr.net/npm/muuri@0.9.5/dist/muuri.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web-animations-js@2.3.2/web-animations.min.js"></script>

  <style>
    /* ========================================
       RESET & BASE
       ======================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* ========================================
       CSS VARIABLES - ORGANIC INDUSTRIAL THEME
       ======================================== */
    :root {
      /* Brand Colors - BOLD Usage */
      --ro-green: #668971;
      --ro-green-dark: #3d5243;
      --ro-green-glow: rgba(102, 137, 113, 0.4);
      --gold: #e4aa4f;
      --gold-glow: #f0cb60;
      --gold-dim: rgba(228, 170, 79, 0.2);

      /* Organic Earth Tones */
      --soil: #2d2419;
      --clay: #4a3f35;
      --hemp-fiber: #b8a88a;
      --leaf-green: #8ba896;
      --sage: #9ca89a;
      --mist: rgba(102, 137, 113, 0.08);

      /* Backgrounds */
      --bg-dark: #0f110e;
      --bg-card: rgba(45, 58, 46, 0.3);
      --glass: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);

      /* Text */
      --text-primary: #f5f2ed;
      --text-secondary: #b8a88a;
      --text-muted: #7a7366;

      /* DRAMATIC Shadows (4-layer stacking) */
      --shadow-dramatic:
        0 2px 4px rgba(0, 0, 0, 0.1),
        0 8px 16px rgba(0, 0, 0, 0.15),
        0 16px 32px rgba(0, 0, 0, 0.2),
        0 32px 64px rgba(0, 0, 0, 0.25);

      --shadow-dramatic-hover:
        0 4px 8px rgba(0, 0, 0, 0.1),
        0 16px 32px rgba(0, 0, 0, 0.2),
        0 32px 64px rgba(0, 0, 0, 0.25),
        0 48px 96px rgba(0, 0, 0, 0.3),
        0 0 40px rgba(102, 137, 113, 0.3);

      /* Typography */
      --font-display: 'DM Serif Display', serif;
      --font-mono: 'JetBrains Mono', monospace;
      --font-ui: 'Outfit', sans-serif;

      /* Spacing */
      --space-xs: 8px;
      --space-sm: 16px;
      --space-md: 24px;
      --space-lg: 40px;
      --space-xl: 64px;

      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 16px;
      --radius-lg: 24px;
      --radius-full: 9999px;

      /* Transitions - SPRING EASING */
      --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
      --transition-normal: 0.5s var(--spring);
      --transition-slow: 0.6s var(--spring);
    }

    /* ========================================
       BASE STYLES
       ======================================== */
    body {
      font-family: var(--font-ui);
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Hemp Leaf Pattern Background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5C25 10 20 15 20 25C20 30 25 35 30 40C35 35 40 30 40 25C40 15 35 10 30 5Z' fill='%23668971' opacity='0.06'/%3E%3C/svg%3E");
      background-size: 120px;
      pointer-events: none;
      z-index: 0;
      animation: driftPattern 60s linear infinite;
    }

    @keyframes driftPattern {
      0% { background-position: 0 0; }
      100% { background-position: 120px 120px; }
    }

    /* Grain Texture Overlay */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.02;
      pointer-events: none;
      z-index: 1;
    }

    /* ========================================
       LOADING SCREEN
       ======================================== */
    .logo-loader {
      position: fixed;
      inset: 0;
      background: var(--bg-dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      gap: 20px;
      transition: opacity 0.4s ease;
    }

    .logo-loader.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .logo-loader img {
      width: 320px;
      height: auto;
      animation: logoPulse 1.6s ease-in-out infinite;
    }

    @keyframes logoPulse {
      0%, 100% {
        opacity: 0.35;
        filter: drop-shadow(0 0 0 transparent);
        transform: scale(0.98);
      }
      50% {
        opacity: 1;
        filter: drop-shadow(0 0 25px rgba(201, 166, 90, 0.5)) drop-shadow(0 0 50px rgba(201, 166, 90, 0.25));
        transform: scale(1);
      }
    }

    .logo-loader-bar {
      width: 80px;
      height: 2px;
      background: var(--gold);
      border-radius: 2px;
      opacity: 0.3;
      animation: barPulse 1.6s ease-in-out infinite;
    }

    @keyframes barPulse {
      0%, 100% { width: 80px; opacity: 0.3; }
      50% { width: 130px; opacity: 0.7; }
    }

    /* ========================================
       CONTAINER & LAYOUT
       ======================================== */
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: var(--space-md);
      position: relative;
      z-index: 2;
    }

    /* ========================================
       HEADER
       ======================================== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) 0;
      margin-bottom: var(--space-lg);
      animation: fadeInDown 0.6s ease-out;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .logo {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--ro-green), var(--gold));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: var(--shadow-dramatic);
    }

    .brand {
      font-family: var(--font-display);
      font-size: 28px;
      font-weight: 400;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--ro-green), var(--gold-glow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-controls {
      display: flex;
      gap: var(--space-sm);
      align-items: center;
    }

    .header-btn {
      padding: 10px 20px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-full);
      color: var(--text-primary);
      font-family: var(--font-ui);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-normal);
      backdrop-filter: blur(10px);
    }

    .header-btn:hover {
      background: var(--ro-green);
      border-color: var(--ro-green);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(102, 137, 113, 0.4);
    }

    .refresh-btn {
      background: linear-gradient(135deg, var(--ro-green), var(--leaf-green));
      border: none;
      color: white;
      padding: 10px 24px;
    }

    /* ========================================
       KPI ROW (Quick Metrics at Top)
       ======================================== */
    .kpi-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: var(--space-lg);
      animation: fadeInUp 0.6s ease-out;
      animation-delay: 0.2s;
      animation-fill-mode: both;
    }

    .kpi-card {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-md);
      padding: 14px;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-dramatic);
      transition: all var(--transition-normal);
    }

    .kpi-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-dramatic-hover);
      border-color: var(--ro-green);
    }

    .kpi-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--ro-green);
    }

    .kpi-card.gold::before { background: var(--gold); }

    .kpi-label {
      font-family: var(--font-ui);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 8px;
      font-weight: 600;
    }

    .kpi-value {
      font-family: var(--font-mono);
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
    }

    .kpi-unit {
      font-size: 12px;
      color: var(--text-secondary);
      margin-left: 4px;
    }

    .kpi-sub {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* ========================================
       DASHBOARD GRID (MUURI)
       ======================================== */
    .dashboard-grid {
      position: relative;
      min-height: 400px;
    }

    .widget-item {
      position: absolute;
      width: calc(33.333% - 16px);
      margin: var(--space-sm);
      z-index: 1;
      animation: popIn 0.4s var(--spring) backwards;
    }

    @keyframes popIn {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .widget-item.muuri-item-dragging {
      z-index: 1000;
      box-shadow: var(--shadow-dramatic-hover);
      transform: scale(1.05);
    }

    .widget-item.muuri-item-releasing {
      transition: transform 0.4s var(--spring);
    }

    .widget-item.muuri-item-hidden {
      z-index: 0;
    }

    /* Widget sizes */
    .widget-item.full-width {
      width: calc(100% - 24px);
    }

    .widget-item.half-width {
      width: calc(50% - 18px);
    }

    /* Widget card base */
    .widget-card {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-dramatic);
      transition: all var(--transition-normal);
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    .widget-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--ro-green);
    }

    .widget-card.gold::before { background: var(--gold); }

    .widget-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-dramatic-hover);
      border-color: var(--ro-green);
    }

    /* Widget header */
    .widget-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }

    .widget-title {
      font-family: var(--font-display);
      font-size: 18px;
      color: var(--text-primary);
    }

    .widget-actions {
      display: flex;
      gap: 8px;
    }

    .widget-drag-handle {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: grab;
      font-size: 18px;
      padding: 4px;
      transition: all 0.2s;
    }

    .widget-drag-handle:hover {
      color: var(--ro-green);
      transform: scale(1.2);
    }

    .widget-drag-handle:active {
      cursor: grabbing;
    }

    .widget-hide {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 20px;
      padding: 4px;
      transition: all 0.2s;
    }

    .widget-hide:hover {
      color: #c45c4a;
      transform: scale(1.2);
    }

    /* ========================================
       HERO SECTION WITH GRADIENT MESHES
       ======================================== */
    .hero-card {
      position: relative;
    }

    .hero-card::after {
      content: '';
      position: absolute;
      width: 600px;
      height: 600px;
      top: -150px;
      right: -120px;
      background: radial-gradient(circle,
        rgba(228, 170, 79, 0.12) 0%,
        rgba(102, 137, 113, 0.06) 50%,
        transparent 100%);
      border-radius: 50%;
      animation: gradient-shift 5s ease-in-out infinite reverse;
      z-index: -1;
      pointer-events: none;
    }

    @keyframes gradient-shift {
      0%, 100% { transform: translate(0, 0) scale(1); opacity: 1; }
      50% { transform: translate(30px, -20px) scale(1.1); opacity: 0.8; }
    }

    .hero-value {
      font-family: var(--font-mono);
      font-size: 72px;
      font-weight: 700;
      line-height: 1;
      margin: var(--space-sm) 0;
      background: linear-gradient(135deg, var(--text-primary), var(--hemp-fiber));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-unit {
      font-family: var(--font-ui);
      font-size: 20px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .hero-subtitle {
      font-family: var(--font-ui);
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: var(--space-md);
    }

    /* ========================================
       FLOWING SVG TIMELINE
       ======================================== */
    .timeline-svg {
      width: 100%;
      height: 200px;
      overflow: visible;
      margin-top: var(--space-md);
    }

    .timeline-path {
      stroke-dasharray: 1100;
      stroke-dashoffset: 1100;
      animation: draw-timeline 1.5s var(--spring) forwards;
      animation-delay: 400ms;
    }

    @keyframes draw-timeline {
      to { stroke-dashoffset: 0; }
    }

    .timeline-dot {
      cursor: pointer;
      transition: all 0.3s var(--spring);
    }

    .timeline-dot:hover {
      transform: scale(1.3);
    }

    .timeline-dot.current {
      animation: pulse-dot 2s ease-in-out infinite;
    }

    @keyframes pulse-dot {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }

    /* ========================================
       CHART CONTAINERS
       ======================================== */
    .chart-container {
      position: relative;
      height: 220px;
      margin-top: var(--space-md);
    }

    /* ========================================
       INTEGRATION CARDS
       ======================================== */
    .integration-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      background: var(--gold-dim);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: var(--space-sm);
    }

    .integration-title {
      font-family: var(--font-ui);
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .integration-subtitle {
      font-family: var(--font-ui);
      font-size: 12px;
      color: var(--text-muted);
    }

    /* ========================================
       SETTINGS FAB & PANEL
       ======================================== */
    .settings-fab {
      position: fixed;
      bottom: 90px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: var(--ro-green);
      border: none;
      border-radius: 50%;
      box-shadow: var(--shadow-dramatic);
      color: white;
      font-size: 24px;
      cursor: pointer;
      z-index: 999;
      transition: all var(--transition-normal);
      animation: bounceFAB 1.2s ease-out 1.5s;
    }

    @keyframes bounceFAB {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .settings-fab:hover {
      background: var(--leaf-green);
      transform: scale(1.1) rotate(90deg);
      box-shadow: var(--shadow-dramatic-hover);
    }

    .settings-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      box-shadow: -4px 0 24px rgba(0,0,0,0.3);
      z-index: 1001;
      transition: right 0.4s var(--spring);
      overflow-y: auto;
      padding: var(--space-xl);
      border-left: 1px solid var(--glass-border);
    }

    .settings-panel.open {
      right: 0;
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-xl);
    }

    .settings-title {
      font-family: var(--font-display);
      font-size: 24px;
      color: var(--text-primary);
    }

    .settings-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 32px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .settings-close:hover {
      color: var(--text-primary);
      transform: scale(1.2);
    }

    .settings-section {
      margin-bottom: var(--space-xl);
    }

    .settings-section h4 {
      font-family: var(--font-ui);
      font-size: 12px;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: var(--space-md);
    }

    .settings-checkbox {
      display: flex;
      align-items: center;
      padding: var(--space-sm);
      margin-bottom: 4px;
      border-radius: var(--radius-sm);
      transition: all 0.2s;
    }

    .settings-checkbox:hover {
      background: var(--glass);
    }

    .settings-checkbox input {
      margin-right: var(--space-sm);
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .settings-checkbox label {
      font-size: 14px;
      color: var(--text-secondary);
      cursor: pointer;
      flex: 1;
    }

    /* ========================================
       AI CHAT WIDGET
       ======================================== */
    .ai-chat-fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--gold), var(--gold-glow));
      border: none;
      border-radius: 50%;
      box-shadow: var(--shadow-dramatic);
      color: white;
      font-size: 28px;
      cursor: pointer;
      z-index: 999;
      transition: all var(--transition-normal);
      animation: bounceFAB 1.2s ease-out 1.8s;
    }

    .ai-chat-fab:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-dramatic-hover);
    }

    .ai-chat-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      box-shadow: -4px 0 24px rgba(0,0,0,0.3);
      z-index: 1002;
      transition: right 0.4s var(--spring);
      display: flex;
      flex-direction: column;
      border-left: 1px solid var(--glass-border);
    }

    .ai-chat-panel.open {
      right: 0;
    }

    .ai-chat-header {
      padding: var(--space-md);
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .ai-chat-header-icon {
      width: 40px;
      height: 40px;
      background: var(--gold-dim);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .ai-chat-header-text h3 {
      font-family: var(--font-display);
      font-size: 18px;
      color: var(--text-primary);
      margin-bottom: 2px;
    }

    .ai-chat-header-text span {
      font-size: 11px;
      color: var(--text-muted);
    }

    .ai-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-md);
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .ai-message {
      max-width: 80%;
      padding: var(--space-sm);
      border-radius: var(--radius-md);
      font-size: 14px;
      line-height: 1.5;
    }

    .ai-message.user {
      background: var(--ro-green);
      color: white;
      align-self: flex-end;
      margin-left: auto;
    }

    .ai-message.assistant {
      background: var(--glass);
      color: var(--text-primary);
      border: 1px solid var(--glass-border);
      align-self: flex-start;
    }

    .ai-typing {
      display: flex;
      gap: 4px;
      padding: var(--space-sm);
    }

    .ai-typing span {
      width: 8px;
      height: 8px;
      background: var(--text-muted);
      border-radius: 50%;
      animation: aiBounce 1.4s infinite ease-in-out;
    }

    .ai-typing span:nth-child(1) { animation-delay: -0.32s; }
    .ai-typing span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes aiBounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    .ai-chat-input-area {
      padding: var(--space-md);
      border-top: 1px solid var(--glass-border);
      display: flex;
      gap: var(--space-sm);
    }

    .ai-chat-input {
      flex: 1;
      padding: var(--space-sm);
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: var(--font-ui);
      font-size: 14px;
    }

    .ai-chat-input:focus {
      outline: none;
      border-color: var(--gold);
    }

    .ai-chat-send {
      width: 40px;
      height: 40px;
      background: var(--gold);
      border: none;
      border-radius: var(--radius-md);
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ai-chat-send:hover {
      background: var(--gold-glow);
      transform: scale(1.05);
    }

    .ai-chat-send:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
    }

    /* ========================================
       KEYFRAME ANIMATIONS
       ======================================== */
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ========================================
       RESPONSIVE DESIGN
       ======================================== */
    @media (max-width: 1200px) {
      .widget-item {
        width: calc(50% - 18px);
      }

      .widget-item.full-width {
        width: calc(100% - 24px);
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: var(--space-sm);
      }

      .widget-item,
      .widget-item.half-width {
        width: calc(100% - 24px);
      }

      .settings-panel,
      .ai-chat-panel {
        width: 100%;
        right: -100%;
      }

      .widget-drag-handle {
        display: none;
      }

      .kpi-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .hero-value {
        font-size: 48px;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="logo-loader" id="loadingOverlay">
    <img src="https://i.imgur.com/UYEbNiI.png" alt="Rogue Origin">
    <span class="logo-loader-bar"></span>
  </div>

  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo-section">
        <div class="logo">üåø</div>
        <h1 class="brand">Rogue Origin</h1>
      </div>
      <div class="header-controls">
        <button class="header-btn refresh-btn" onclick="refreshData()">
          <span>‚Üª Refresh</span>
        </button>
      </div>
    </header>

    <!-- KPI Row (Quick Metrics) -->
    <div class="kpi-row" id="kpiRow">
      <!-- KPI cards will be rendered here by JavaScript -->
    </div>

    <!-- Dashboard Grid (Muuri) -->
    <div class="dashboard-grid" id="dashboardGrid">

      <!-- Widget 1: Hero Production Card (Full Width) -->
      <div class="widget-item full-width" data-widget-id="hero-production" style="animation-delay: 0.1s;">
        <div class="widget-card hero-card gold">
          <div class="widget-header">
            <h2 class="widget-title">Today's Production</h2>
            <div class="widget-actions">
              <button class="widget-drag-handle" title="Drag to rearrange">‚ãÆ‚ãÆ</button>
              <button class="widget-hide" onclick="hideWidget('hero-production')" title="Hide">√ó</button>
            </div>
          </div>
          <div class="hero-value" id="heroValue">0.0</div>
          <div class="hero-unit">lbs total production</div>
          <div class="hero-subtitle" id="heroSubtitle">Loading...</div>
        </div>
      </div>

      <!-- Widget 2: Flowing Timeline (Full Width) -->
      <div class="widget-item full-width" data-widget-id="timeline" style="animation-delay: 0.25s;">
        <div class="widget-card">
          <div class="widget-header">
            <h2 class="widget-title">Today's Production Flow</h2>
            <div class="widget-actions">
              <button class="widget-drag-handle" title="Drag to rearrange">‚ãÆ‚ãÆ</button>
              <button class="widget-hide" onclick="hideWidget('timeline')" title="Hide">√ó</button>
            </div>
          </div>
          <svg id="timelineSvg" class="timeline-svg" viewBox="0 0 1200 200" preserveAspectRatio="xMidYMid meet">
            <defs>
              <linearGradient id="timeline-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#668971"/>
                <stop offset="100%" stop-color="#e4aa4f"/>
              </linearGradient>
            </defs>
            <path d="M50,100 Q200,80 350,100 T650,100 T950,100 L1150,100"
                  stroke="url(#timeline-gradient)"
                  stroke-width="3"
                  fill="none"
                  class="timeline-path"/>
            <g id="timelineDots"></g>
          </svg>
        </div>
      </div>

      <!-- Widget 3: Hourly Chart -->
      <div class="widget-item half-width" data-widget-id="hourly-chart" style="animation-delay: 0.4s;">
        <div class="widget-card">
          <div class="widget-header">
            <h3 class="widget-title">Hourly Production</h3>
            <div class="widget-actions">
              <button class="widget-drag-handle" title="Drag to rearrange">‚ãÆ‚ãÆ</button>
              <button class="widget-hide" onclick="hideWidget('hourly-chart')" title="Hide">√ó</button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="hourlyChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Widget 4: Daily Trend Chart -->
      <div class="widget-item half-width" data-widget-id="daily-chart" style="animation-delay: 0.55s;">
        <div class="widget-card">
          <div class="widget-header">
            <h3 class="widget-title">Daily Trend</h3>
            <div class="widget-actions">
              <button class="widget-drag-handle" title="Drag to rearrange">‚ãÆ‚ãÆ</button>
              <button class="widget-hide" onclick="hideWidget('daily-chart')" title="Hide">√ó</button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="dailyChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Widget 5: Efficiency Chart -->
      <div class="widget-item half-width" data-widget-id="efficiency-chart" style="animation-delay: 0.7s;">
        <div class="widget-card">
          <div class="widget-header">
            <h3 class="widget-title">Efficiency Curve</h3>
            <div class="widget-actions">
              <button class="widget-drag-handle" title="Drag to rearrange">‚ãÆ‚ãÆ</button>
              <button class="widget-hide" onclick="hideWidget('efficiency-chart')" title="Hide">√ó</button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="efficiencyChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Widget 6: Integration - Kanban -->
      <div class="widget-item" data-widget-id="kanban" style="animation-delay: 0.85s;">
        <div class="widget-card" onclick="window.open('kanban.html', '_blank')" style="cursor: pointer;">
          <div class="integration-icon">üìã</div>
          <div class="integration-title">Supply Kanban</div>
          <div class="integration-subtitle">Inventory tracking</div>
        </div>
      </div>

      <!-- Widget 7: Integration - Scoreboard -->
      <div class="widget-item" data-widget-id="scoreboard" style="animation-delay: 1s;">
        <div class="widget-card" onclick="window.open('scoreboard.html', '_blank')" style="cursor: pointer;">
          <div class="integration-icon">üìä</div>
          <div class="integration-title">Live Scoreboard</div>
          <div class="integration-subtitle">Floor display</div>
        </div>
      </div>

      <!-- Widget 8: Integration - Bag Timer -->
      <div class="widget-item" data-widget-id="bags" style="animation-delay: 1.15s;">
        <div class="widget-card" onclick="window.open('barcode.html', '_blank')" style="cursor: pointer;">
          <div class="integration-icon">üì¶</div>
          <div class="integration-title">Bag Timer</div>
          <div class="integration-subtitle">Packaging tracker</div>
        </div>
      </div>

      <!-- Widget 9: Integration - SOP -->
      <div class="widget-item" data-widget-id="sop" style="animation-delay: 1.3s;">
        <div class="widget-card" onclick="window.open('sop-manager.html', '_blank')" style="cursor: pointer;">
          <div class="integration-icon">üìö</div>
          <div class="integration-title">SOP Manager</div>
          <div class="integration-subtitle">Procedures</div>
        </div>
      </div>

    </div>
  </div>

  <!-- Settings FAB -->
  <button class="settings-fab" onclick="toggleSettings()">‚öôÔ∏è</button>

  <!-- Settings Panel -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h2 class="settings-title">Customize Dashboard</h2>
      <button class="settings-close" onclick="toggleSettings()">√ó</button>
    </div>

    <div class="settings-section">
      <h4>Widget Visibility</h4>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-hero-production" checked onchange="toggleWidgetVisibility('hero-production', this.checked)">
        <label for="check-hero-production">Hero Production</label>
      </div>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-timeline" checked onchange="toggleWidgetVisibility('timeline', this.checked)">
        <label for="check-timeline">Production Timeline</label>
      </div>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-hourly-chart" checked onchange="toggleWidgetVisibility('hourly-chart', this.checked)">
        <label for="check-hourly-chart">Hourly Chart</label>
      </div>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-daily-chart" checked onchange="toggleWidgetVisibility('daily-chart', this.checked)">
        <label for="check-daily-chart">Daily Trend</label>
      </div>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-efficiency-chart" checked onchange="toggleWidgetVisibility('efficiency-chart', this.checked)">
        <label for="check-efficiency-chart">Efficiency Curve</label>
      </div>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-kanban" checked onchange="toggleWidgetVisibility('kanban', this.checked)">
        <label for="check-kanban">Kanban</label>
      </div>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-scoreboard" checked onchange="toggleWidgetVisibility('scoreboard', this.checked)">
        <label for="check-scoreboard">Scoreboard</label>
      </div>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-bags" checked onchange="toggleWidgetVisibility('bags', this.checked)">
        <label for="check-bags">Bag Timer</label>
      </div>
      <div class="settings-checkbox">
        <input type="checkbox" id="check-sop" checked onchange="toggleWidgetVisibility('sop', this.checked)">
        <label for="check-sop">SOP Manager</label>
      </div>
    </div>

    <div class="settings-section">
      <h4>Actions</h4>
      <button class="header-btn" onclick="resetLayout()" style="width: 100%; justify-content: center;">Reset to Default</button>
    </div>
  </div>

  <!-- AI Chat FAB -->
  <button class="ai-chat-fab" onclick="toggleAIChat()">üåø</button>

  <!-- AI Chat Panel -->
  <div class="ai-chat-panel" id="aiChatPanel">
    <div class="ai-chat-header">
      <div class="ai-chat-header-icon">üåø</div>
      <div class="ai-chat-header-text">
        <h3>Rogue Origin Assistant</h3>
        <span>Ask me about production</span>
      </div>
    </div>
    <div class="ai-chat-messages" id="aiMessages">
      <div class="ai-message assistant">
        Hi! I'm your Rogue Origin assistant. Ask me about today's production, crew performance, or any metrics you'd like to know.
      </div>
    </div>
    <div class="ai-chat-input-area">
      <input type="text" class="ai-chat-input" id="aiInput" placeholder="Ask about production..." onkeypress="if(event.key==='Enter') sendAIMessage()">
      <button class="ai-chat-send" onclick="sendAIMessage()" id="aiSendBtn">
        <span>‚Üí</span>
      </button>
    </div>
  </div>

  <script>
    // ========================================
    // CONFIGURATION
    // ========================================
    const API_URL = 'https://script.google.com/macros/s/AKfycbxDAHSFl9cedGS49L3Lf5ztqy-SSToYigyA30ZtsdpmWNAR9H61X_Mm48JOOTGqqr-Z/exec';
    const isAppsScript = typeof google !== 'undefined' && google.script && google.script.run;

    let data = null;
    let muuriGrid = null;
    let charts = {};

    // KPI Definitions
    const kpiDefinitions = [
      { id: 'totalTops', label: 'Total Tops', color: 'gold', format: 'lbs' },
      { id: 'totalSmalls', label: 'Total Smalls', color: 'green', format: 'lbs' },
      { id: 'avgRate', label: 'Avg Rate', color: 'green', format: 'rate' },
      { id: 'crew', label: 'Crew Size', color: 'green', format: 'num' },
      { id: 'operatorHours', label: 'Op Hours', color: 'gold', format: 'hrs' },
      { id: 'costPerLb', label: 'Cost/Lb', color: 'gold', format: 'dollar' }
    ];

    // ========================================
    // LOADING SCREEN
    // ========================================
    function hideLoadingScreen() {
      const loader = document.getElementById('loadingOverlay');
      setTimeout(() => {
        loader.classList.add('hidden');
      }, 800);
    }

    // ========================================
    // SETTINGS PANEL
    // ========================================
    function toggleSettings() {
      const panel = document.getElementById('settingsPanel');
      const aiPanel = document.getElementById('aiChatPanel');

      // Close AI chat if open
      if (aiPanel.classList.contains('open')) {
        aiPanel.classList.remove('open');
      }

      panel.classList.toggle('open');
    }

    // ========================================
    // AI CHAT
    // ========================================
    function toggleAIChat() {
      const panel = document.getElementById('aiChatPanel');
      const settingsPanel = document.getElementById('settingsPanel');

      // Close settings if open
      if (settingsPanel.classList.contains('open')) {
        settingsPanel.classList.remove('open');
      }

      panel.classList.toggle('open');

      if (panel.classList.contains('open')) {
        document.getElementById('aiInput').focus();
      }
    }

    async function sendAIMessage() {
      const input = document.getElementById('aiInput');
      const message = input.value.trim();

      if (!message) return;

      const messagesContainer = document.getElementById('aiMessages');

      // Add user message
      const userMsg = document.createElement('div');
      userMsg.className = 'ai-message user';
      userMsg.textContent = message;
      messagesContainer.appendChild(userMsg);

      input.value = '';

      // Add typing indicator
      const typingDiv = document.createElement('div');
      typingDiv.className = 'ai-typing';
      typingDiv.innerHTML = '<span></span><span></span><span></span>';
      messagesContainer.appendChild(typingDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;

      try {
        let response;

        if (isAppsScript) {
          response = await new Promise((resolve, reject) => {
            google.script.run
              .withSuccessHandler(resolve)
              .withFailureHandler(reject)
              .handleChatRequest(message);
          });
        } else {
          const res = await fetch(`${API_URL}?action=chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify({ message, context: data })
          });
          response = await res.json();
        }

        // Remove typing indicator
        typingDiv.remove();

        // Add AI response
        const aiMsg = document.createElement('div');
        aiMsg.className = 'ai-message assistant';
        aiMsg.textContent = response.message || response.reply || 'Sorry, I couldn\'t process that.';
        messagesContainer.appendChild(aiMsg);

      } catch (error) {
        console.error('AI Error:', error);
        typingDiv.remove();

        const errorMsg = document.createElement('div');
        errorMsg.className = 'ai-message assistant';
        errorMsg.textContent = 'Sorry, I\'m having trouble connecting right now.';
        messagesContainer.appendChild(errorMsg);
      }

      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // ========================================
    // WIDGET MANAGEMENT
    // ========================================
    function hideWidget(widgetId) {
      const checkbox = document.getElementById(`check-${widgetId}`);
      if (checkbox) {
        checkbox.checked = false;
        toggleWidgetVisibility(widgetId, false);
      }
    }

    function toggleWidgetVisibility(widgetId, visible) {
      if (!muuriGrid) return;

      const item = muuriGrid.getItems().find(i =>
        i.getElement().dataset.widgetId === widgetId
      );

      if (item) {
        if (visible) {
          muuriGrid.show([item], {instant: false});
        } else {
          muuriGrid.hide([item], {instant: false});
        }
        saveLayout();
      }
    }

    function resetLayout() {
      if (confirm('Reset dashboard to default layout?')) {
        localStorage.removeItem('dashboardLayout');
        location.reload();
      }
    }

    // ========================================
    // LAYOUT PERSISTENCE
    // ========================================
    function saveLayout() {
      if (!muuriGrid) return;

      const layout = {
        widgets: []
      };

      muuriGrid.getItems().forEach((item, index) => {
        layout.widgets.push({
          id: item.getElement().dataset.widgetId,
          visible: !item.isHidden(),
          position: index
        });
      });

      localStorage.setItem('dashboardLayout', JSON.stringify(layout));
    }

    function loadLayout() {
      const saved = localStorage.getItem('dashboardLayout');
      if (!saved) return;

      try {
        const layout = JSON.parse(saved);

        layout.widgets.forEach(w => {
          const checkbox = document.getElementById(`check-${w.id}`);
          if (checkbox) {
            checkbox.checked = w.visible;
          }
          if (!w.visible && muuriGrid) {
            const item = muuriGrid.getItems().find(i =>
              i.getElement().dataset.widgetId === w.id
            );
            if (item) {
              muuriGrid.hide([item], {instant: true});
            }
          }
        });

        if (muuriGrid) {
          const sortedItems = layout.widgets
            .sort((a, b) => a.position - b.position)
            .map(w => muuriGrid.getItems().find(i =>
              i.getElement().dataset.widgetId === w.id
            ))
            .filter(item => item);

          muuriGrid.sort(sortedItems);
        }
      } catch (e) {
        console.error('Failed to load layout:', e);
      }
    }

    // ========================================
    // MUURI GRID INITIALIZATION
    // ========================================
    function initMuuriGrid() {
      muuriGrid = new Muuri('#dashboardGrid', {
        dragEnabled: true,
        dragHandle: '.widget-drag-handle',
        dragSortPredicate: {
          threshold: 50,
          action: 'move'
        },
        layout: {
          fillGaps: true,
          horizontal: false,
          alignRight: false,
          alignBottom: false,
          rounding: true
        },
        layoutDuration: 400,
        layoutEasing: 'cubic-bezier(0.34, 1.56, 0.64, 1)',
        dragStartPredicate: {
          distance: 10,
          delay: 0
        }
      });

      muuriGrid.on('dragEnd', () => {
        saveLayout();
      });

      loadLayout();
    }

    // ========================================
    // KPI CARDS RENDERING
    // ========================================
    function renderKPICards() {
      if (!data || !data.today) return;

      const container = document.getElementById('kpiRow');
      const t = data.today;

      container.innerHTML = kpiDefinitions.map(kpi => {
        let value, unit, subtitle;

        switch(kpi.id) {
          case 'totalTops':
            value = (t.totalTops || 0).toFixed(1);
            unit = 'lbs';
            subtitle = 'Tops produced';
            break;
          case 'totalSmalls':
            value = (t.totalSmalls || 0).toFixed(1);
            unit = 'lbs';
            subtitle = 'Smalls produced';
            break;
          case 'avgRate':
            value = (t.avgRate || 0).toFixed(2);
            unit = 'lbs/hr';
            subtitle = 'Per trimmer';
            break;
          case 'crew':
            value = (t.trimmers || 0) + (t.buckers || 0);
            unit = 'people';
            subtitle = `${t.trimmers || 0} trimmers, ${t.buckers || 0} buckers`;
            break;
          case 'operatorHours':
            value = (t.hoursWorked || 0).toFixed(1);
            unit = 'hrs';
            subtitle = 'Total hours';
            break;
          case 'costPerLb':
            value = (t.costPerLb || 0).toFixed(2);
            unit = '$';
            subtitle = 'Per pound';
            break;
          default:
            value = '0';
            unit = '';
            subtitle = '';
        }

        return `
          <div class="kpi-card ${kpi.color}">
            <div class="kpi-label">${kpi.label}</div>
            <div class="kpi-value">${value}<span class="kpi-unit">${unit}</span></div>
            <div class="kpi-sub">${subtitle}</div>
          </div>
        `;
      }).join('');
    }

    // ========================================
    // NUMBER ANIMATION
    // ========================================
    function animateNumber(element, target, duration = 1000, decimals = 1) {
      const start = parseFloat(element.textContent) || 0;
      const increment = (target - start) / (duration / 16);
      let current = start;

      const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
          element.textContent = target.toFixed(decimals);
          clearInterval(timer);
        } else {
          element.textContent = current.toFixed(decimals);
        }
      }, 16);
    }

    // ========================================
    // TIMELINE RENDERING
    // ========================================
    function initProductionTimeline() {
      if (!data || !data.hourly || data.hourly.length === 0) return;

      const dotsContainer = document.getElementById('timelineDots');
      dotsContainer.innerHTML = '';

      const now = new Date();
      const currentHour = now.getHours() + now.getMinutes() / 60;

      const pathPoints = [
        {x: 50, y: 100}, {x: 150, y: 88}, {x: 250, y: 92},
        {x: 350, y: 100}, {x: 450, y: 92}, {x: 550, y: 96},
        {x: 650, y: 100}, {x: 750, y: 92}, {x: 850, y: 96},
        {x: 950, y: 100}, {x: 1050, y: 96}, {x: 1150, y: 100}
      ];

      data.hourly.forEach((hour, index) => {
        if (index >= pathPoints.length) return;

        const point = pathPoints[index];
        const total = (hour.tops || 0) + (hour.smalls || 0);
        const radius = Math.max(4, Math.min(12, 4 + (total / 10)));

        const hourNum = 7 + index;
        const isCurrent = currentHour >= hourNum && currentHour < (hourNum + 1);
        const isPast = currentHour >= (hourNum + 1);

        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute('cx', point.x);
        circle.setAttribute('cy', point.y);
        circle.setAttribute('r', radius);
        circle.setAttribute('class', `timeline-dot ${isCurrent ? 'current' : ''}`);

        if (isPast) {
          circle.setAttribute('fill', '#668971');
          circle.setAttribute('opacity', '0.9');
        } else if (isCurrent) {
          circle.setAttribute('fill', '#e4aa4f');
          circle.setAttribute('opacity', '1');
        } else {
          circle.setAttribute('fill', 'none');
          circle.setAttribute('stroke', '#668971');
          circle.setAttribute('stroke-width', '2');
          circle.setAttribute('opacity', '0.5');
        }

        dotsContainer.appendChild(circle);
      });
    }

    // ========================================
    // DATA LOADING
    // ========================================
    async function loadData() {
      try {
        let result;

        if (isAppsScript) {
          result = await new Promise((resolve, reject) => {
            google.script.run
              .withSuccessHandler(resolve)
              .withFailureHandler(reject)
              .getProductionDashboardData();
          });
        } else {
          const response = await fetch(`${API_URL}?action=dashboard`);
          result = await response.json();
        }

        if (result.success && result.data) {
          data = result.data;
          renderDashboard();
        } else {
          console.error('API Error:', result.error || 'Unknown error');
        }
      } catch (error) {
        console.error('Load Error:', error);
      }
    }

    function refreshData() {
      const btn = event.target.closest('button');
      const originalText = btn.innerHTML;
      btn.innerHTML = '‚Üª Loading...';
      btn.disabled = true;

      loadData().then(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
      });
    }

    // ========================================
    // RENDERING
    // ========================================
    function renderDashboard() {
      if (!data || !data.today) return;

      const t = data.today;

      // Hero section
      animateNumber(document.getElementById('heroValue'), t.totalLbs || 0, 1200, 1);
      document.getElementById('heroSubtitle').textContent =
        `${t.totalTops?.toFixed(1) || 0} lbs tops, ${t.totalSmalls?.toFixed(1) || 0} lbs smalls`;

      // KPI cards
      renderKPICards();

      // Timeline
      initProductionTimeline();

      // Charts
      renderCharts();
    }

    function renderCharts() {
      // Hourly Chart
      if (data.hourly && data.hourly.length > 0) {
        const ctx = document.getElementById('hourlyChart');
        if (charts.hourly) charts.hourly.destroy();

        charts.hourly = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.hourly.map(h => h.label || ''),
            datasets: [
              {
                label: 'Tops',
                data: data.hourly.map(h => h.tops || 0),
                backgroundColor: 'rgba(102, 137, 113, 0.8)',
                borderRadius: 8
              },
              {
                label: 'Smalls',
                data: data.hourly.map(h => h.smalls || 0),
                backgroundColor: 'rgba(228, 170, 79, 0.6)',
                borderRadius: 8
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
              duration: 1200,
              easing: 'easeOutBounce'
            },
            plugins: {
              legend: {
                display: true,
                labels: { color: '#b8a88a', font: { family: 'Outfit' } }
              }
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: '#b8a88a', font: { family: 'Outfit' } }
              },
              y: {
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: { color: '#b8a88a', font: { family: 'JetBrains Mono' } }
              }
            }
          }
        });
      }

      // Daily Trend Chart
      if (data.daily && data.daily.length > 0) {
        const ctx = document.getElementById('dailyChart');
        if (charts.daily) charts.daily.destroy();

        charts.daily = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.daily.map(d => d.label || ''),
            datasets: [{
              label: 'Total Production',
              data: data.daily.map(d => (d.totalTops || 0) + (d.totalSmalls || 0)),
              backgroundColor: 'rgba(102, 137, 113, 0.8)',
              borderRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
              duration: 1200,
              easing: 'easeOutBounce'
            },
            plugins: {
              legend: { display: false }
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: '#b8a88a' }
              },
              y: {
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: { color: '#b8a88a' }
              }
            }
          }
        });
      }

      // Efficiency Chart
      if (data.hourly && data.hourly.length > 0) {
        const ctx = document.getElementById('efficiencyChart');
        if (charts.efficiency) charts.efficiency.destroy();

        charts.efficiency = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.hourly.map(h => h.label || ''),
            datasets: [{
              label: 'Efficiency Rate',
              data: data.hourly.map(h => h.rate || 0),
              borderColor: '#e4aa4f',
              backgroundColor: 'rgba(228, 170, 79, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.5,
              pointRadius: 4,
              pointBackgroundColor: '#e4aa4f'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
              duration: 1500,
              easing: 'easeInOutQuart'
            },
            plugins: {
              legend: { display: false }
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: '#b8a88a' }
              },
              y: {
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: { color: '#b8a88a' }
              }
            }
          }
        });
      }
    }

    // ========================================
    // INITIALIZATION
    // ========================================
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize Muuri grid
      initMuuriGrid();

      // Load data
      loadData();

      // Hide loading screen
      hideLoadingScreen();

      // Auto-refresh every 60 seconds
      setInterval(loadData, 60000);
    });
  </script>
</body>
</html>
