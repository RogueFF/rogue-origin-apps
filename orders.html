<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Management - Rogue Origin</title>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    :root {
      --gold: #e4aa4f;
      --gold-light: #f0cb60;
      --gold-dim: rgba(228,170,79,0.15);
      --green: #668971;
      --green-dark: #4a6b54;
      --green-dim: rgba(102,137,113,0.15);
      --bg: #faf8f5;
      --bg-card: #ffffff;
      --border: #e8e4de;
      --text: #2d3a2e;
      --text-muted: #8a9a8e;
      --danger: #c45c4a;
      --success: #5a9a6e;
      --warning: #d4a03c;
    }

    body.dark-mode {
      --bg: #1a1a1a;
      --bg-card: #2d2d2d;
      --border: #444444;
      --text: #e0e0e0;
      --text-muted: #888888;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

    /* Header */
    .header { background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 16px 24px; }
    .header-inner { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
    .brand { display: flex; align-items: center; gap: 12px; }
    .logo { width: 44px; height: 44px; border-radius: 50%; object-fit: cover; }
    .brand h1 { font-size: 20px; font-weight: 600; }
    .brand p { color: var(--green); font-size: 12px; }
    .header-actions { display: flex; gap: 10px; align-items: center; }

    /* Buttons */
    .btn { padding: 10px 18px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: 500; transition: all 0.15s; display: inline-flex; align-items: center; gap: 6px; }
    .btn-primary { background: var(--green); color: #fff; }
    .btn-primary:hover { background: var(--green-dark); }
    .btn-secondary { background: var(--bg); border: 1px solid var(--border); color: var(--text); }
    .btn-secondary:hover { border-color: var(--green); }
    .btn-gold { background: var(--gold); color: #fff; }
    .btn-gold:hover { background: #d99a3f; }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }

    /* Main Layout */
    .main { max-width: 1400px; margin: 0 auto; padding: 24px; }

    /* Stats Bar */
    .stats-bar { display: flex; gap: 20px; margin-bottom: 24px; flex-wrap: wrap; }
    .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 16px 20px; min-width: 160px; }
    .stat-card .label { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }
    .stat-card .value { font-size: 28px; font-weight: 700; color: var(--green); }
    .stat-card .sub { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

    /* Orders Table */
    .orders-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .section-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
    .section-header h2 { font-size: 16px; font-weight: 600; }
    .filters { display: flex; gap: 10px; flex-wrap: wrap; }
    .filter-input { padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; background: var(--bg); color: var(--text); }
    .filter-input:focus { outline: none; border-color: var(--green); }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 14px 16px; text-align: left; border-bottom: 1px solid var(--border); }
    th { background: var(--bg); font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    tr:hover { background: var(--green-dim); }
    tr:last-child td { border-bottom: none; }

    /* Status Badges */
    .status { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
    .status-pending { background: var(--gold-dim); color: var(--gold); }
    .status-processing { background: rgba(100, 149, 237, 0.15); color: #6495ED; }
    .status-ready { background: var(--green-dim); color: var(--green); }
    .status-shipped { background: rgba(138, 154, 142, 0.15); color: var(--text-muted); }
    .status-completed { background: rgba(90, 154, 110, 0.2); color: var(--success); }

    /* Progress Bar */
    .progress-bar { width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--green); border-radius: 4px; transition: width 0.3s; }

    /* Modal */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal-overlay.open { display: flex; }
    .modal { background: var(--bg-card); border-radius: 16px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; }
    .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .modal-header h3 { font-size: 18px; font-weight: 600; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-muted); }
    .modal-body { padding: 24px; }
    .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; }

    /* Form */
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: var(--text); }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; background: var(--bg); color: var(--text); }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--green); box-shadow: 0 0 0 3px var(--green-dim); }
    .form-group textarea { min-height: 80px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-hint { font-size: 11px; color: var(--text-muted); margin-top: 4px; }

    /* Customer Select with Add New */
    .customer-select-container { position: relative; }
    .customer-select-container .form-row { margin-bottom: 0; }
    .add-customer-link { font-size: 12px; color: var(--green); cursor: pointer; text-decoration: underline; margin-top: 6px; display: inline-block; }
    .add-customer-link:hover { color: var(--green-dark); }

    /* Pallets Section */
    .pallets-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
    .pallets-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .pallets-header h4 { font-size: 14px; font-weight: 600; }
    .pallet-card { background: var(--bg); border: 2px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    .pallet-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .pallet-card-header h5 { font-size: 13px; font-weight: 600; color: var(--green); }
    .pallet-remove { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 18px; padding: 4px; }
    .pallet-remove:hover { opacity: 0.7; }

    /* Strain Row in Pallet */
    .strain-row { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px; align-items: start; }
    .strain-row select, .strain-row input { padding: 8px 10px; font-size: 13px; }
    .strain-remove { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 16px; padding: 8px; }
    .strain-remove:hover { opacity: 0.7; }
    .add-strain-btn { margin-top: 8px; }

    /* Pallet Total */
    .pallet-total { background: var(--green-dim); border-radius: 8px; padding: 10px 12px; margin-top: 12px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; font-weight: 600; }
    .pallet-total-label { color: var(--text-muted); }
    .pallet-total-value { color: var(--green); font-size: 16px; }

    /* Order Total Summary */
    .order-totals { background: var(--gold-dim); border: 2px solid var(--gold); border-radius: 12px; padding: 16px; margin-top: 20px; }
    .order-totals h4 { font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--gold); }
    .totals-grid { display: grid; gap: 8px; }
    .totals-row { display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
    .totals-row.final { border-top: 2px solid var(--gold); padding-top: 8px; margin-top: 8px; font-size: 16px; font-weight: 700; }
    .totals-label { color: var(--text-muted); }
    .totals-value { font-weight: 600; color: var(--text); }
    .totals-value.currency { color: var(--gold); }

    /* Order Detail View */
    .order-detail { padding: 24px; }
    .order-detail-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
    .order-title { font-size: 24px; font-weight: 700; }
    .order-meta { display: flex; gap: 20px; margin-top: 8px; flex-wrap: wrap; }
    .order-meta span { font-size: 13px; color: var(--text-muted); }
    .order-progress { margin: 24px 0; padding: 20px; background: var(--bg); border-radius: 12px; }
    .order-progress-bar { height: 12px; background: var(--border); border-radius: 6px; overflow: hidden; margin: 12px 0; }
    .order-progress-fill { height: 100%; background: linear-gradient(90deg, var(--green), var(--gold)); border-radius: 6px; }
    .order-progress-stats { display: flex; justify-content: space-between; font-size: 13px; color: var(--text-muted); }

    /* Responsive */
    @media (max-width: 768px) {
      .stat-card { min-width: 140px; }
      .form-row { grid-template-columns: 1fr; }
      .strain-row { grid-template-columns: 1fr; }
      th, td { padding: 10px 12px; font-size: 13px; }
      .hide-mobile { display: none; }
    }

    /* Loading */
    .loading { text-align: center; padding: 60px; color: var(--text-muted); }
    .spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--green); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Empty State */
    .empty-state { text-align: center; padding: 60px 20px; }
    .empty-state i { font-size: 64px; color: var(--text-muted); margin-bottom: 16px; }
    .empty-state h3 { font-size: 18px; margin-bottom: 8px; }
    .empty-state p { color: var(--text-muted); margin-bottom: 20px; }

    /* Customer Link */
    .customer-link { display: flex; align-items: center; gap: 8px; padding: 12px 16px; background: var(--green-dim); border-radius: 8px; margin-top: 20px; }
    .customer-link input { flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; font-family: monospace; }
    .customer-link button { padding: 8px 12px; }

    /* Toast notifications */
    .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 10000; display: flex; flex-direction: column; gap: 8px; }
    .toast { padding: 12px 20px; border-radius: 8px; color: #fff; font-weight: 500; font-size: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); animation: toastSlideIn 0.3s ease; max-width: 360px; }
    .toast.error { background: var(--danger); }
    .toast.success { background: var(--success); }
    .toast.warning { background: var(--warning); color: #1a1a1a; }
    .toast.info { background: var(--green); }
    .toast.hiding { animation: toastSlideOut 0.3s ease forwards; }
    @keyframes toastSlideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes toastSlideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <img src="https://rogueff.github.io/rogue-origin-apps/assets/ro-logo.png" alt="RO" class="logo" onerror="this.style.display='none'">
        <div>
          <h1>Order Management</h1>
          <p>Wholesale Order Tracking</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" onclick="window.location.href='index.html'">
          <i class="ph ph-arrow-left"></i> Back to Hub
        </button>
        <button class="btn btn-secondary" onclick="toggleDarkMode()">
          <i class="ph ph-moon"></i>
        </button>
        <button class="btn btn-primary" onclick="openNewOrderModal()">
          <i class="ph ph-plus"></i> New Order
        </button>
      </div>
    </div>
  </header>

  <main class="main">
    <!-- Stats -->
    <div class="stats-bar">
      <div class="stat-card">
        <div class="label">Active Orders</div>
        <div class="value" id="statActiveOrders">-</div>
      </div>
      <div class="stat-card">
        <div class="label">Total Pending (kg)</div>
        <div class="value" id="statPendingKg">-</div>
      </div>
      <div class="stat-card">
        <div class="label">In Progress (kg)</div>
        <div class="value" id="statProgressKg">-</div>
      </div>
      <div class="stat-card">
        <div class="label">Ready to Ship (kg)</div>
        <div class="value" id="statReadyKg">-</div>
      </div>
    </div>

    <!-- Orders List -->
    <div class="orders-section" id="ordersSection">
      <div class="section-header">
        <h2>All Orders</h2>
        <div class="filters">
          <select class="filter-input" id="filterStatus" onchange="filterOrders()">
            <option value="">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="processing">Processing</option>
            <option value="ready">Ready to Ship</option>
            <option value="shipped">Shipped</option>
            <option value="completed">Completed</option>
          </select>
          <input type="text" class="filter-input" id="filterSearch" placeholder="Search customer..." onkeyup="filterOrders()">
        </div>
      </div>
      <div id="ordersTableContainer">
        <div class="loading">
          <div class="spinner"></div>
          Loading orders...
        </div>
      </div>
    </div>
  </main>

  <!-- New/Edit Order Modal -->
  <div class="modal-overlay" id="orderModal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="modalTitle">New Order</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="orderForm">
          <input type="hidden" id="orderId">

          <!-- Customer Selection -->
          <div class="customer-select-container">
            <div class="form-row">
              <div class="form-group">
                <label>Customer *</label>
                <select id="customerSelect" onchange="handleCustomerChange()">
                  <option value="">Select a customer...</option>
                </select>
                <a class="add-customer-link" onclick="openNewCustomerModal()">
                  <i class="ph ph-plus"></i> Add New Customer
                </a>
              </div>
              <div class="form-group">
                <label>Currency</label>
                <select id="currency">
                  <option value="USD">USD ($)</option>
                  <option value="EUR">EUR (€)</option>
                  <option value="GBP">GBP (£)</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Status</label>
              <select id="orderStatus">
                <option value="pending">Pending</option>
                <option value="processing">Processing</option>
                <option value="ready">Ready to Ship</option>
                <option value="shipped">Shipped</option>
                <option value="completed">Completed</option>
              </select>
            </div>
            <div class="form-group">
              <label>Due Date</label>
              <input type="date" id="dueDate">
            </div>
          </div>

          <div class="form-group">
            <label>Notes</label>
            <textarea id="orderNotes" placeholder="Special instructions, documentation requirements, etc."></textarea>
          </div>

          <!-- Pallets -->
          <div class="pallets-section">
            <div class="pallets-header">
              <h4><i class="ph ph-package"></i> Pallets</h4>
              <button type="button" class="btn btn-sm btn-secondary" onclick="addPallet()">
                <i class="ph ph-plus"></i> Add Pallet
              </button>
            </div>
            <div id="palletsContainer"></div>
            <p class="form-hint">Each pallet can contain multiple cultivars with individual weights and pricing.</p>
          </div>

          <!-- Order Totals -->
          <div class="order-totals">
            <h4><i class="ph ph-calculator"></i> Order Summary</h4>
            <div class="totals-grid">
              <div class="totals-row">
                <span class="totals-label">Total Weight:</span>
                <span class="totals-value" id="totalWeight">0 kg</span>
              </div>
              <div class="totals-row">
                <span class="totals-label">Total Pallets:</span>
                <span class="totals-value" id="totalPallets">0</span>
              </div>
              <div class="totals-row final">
                <span class="totals-label">Total Price:</span>
                <span class="totals-value currency" id="totalPrice">$0.00</span>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveOrder()">Save Order</button>
      </div>
    </div>
  </div>

  <!-- New Customer Modal -->
  <div class="modal-overlay" id="customerModal">
    <div class="modal">
      <div class="modal-header">
        <h3>New Customer</h3>
        <button class="modal-close" onclick="closeCustomerModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="customerForm">
          <div class="form-group">
            <label>Company Name *</label>
            <input type="text" id="customerCompanyName" required placeholder="e.g., Hamburg GmbH">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Contact Name</label>
              <input type="text" id="customerContactName" placeholder="e.g., John Smith">
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="customerEmail" placeholder="contact@company.com">
            </div>
          </div>
          <div class="form-group">
            <label>Street Address</label>
            <input type="text" id="customerStreet" placeholder="123 Main St">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input type="text" id="customerCity">
            </div>
            <div class="form-group">
              <label>State/Province</label>
              <input type="text" id="customerState">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Postal Code</label>
              <input type="text" id="customerZip">
            </div>
            <div class="form-group">
              <label>Country *</label>
              <input type="text" id="customerCountry" required placeholder="e.g., Germany">
            </div>
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" id="customerPhone">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeCustomerModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveCustomer()">Save Customer</button>
      </div>
    </div>
  </div>

  <!-- Order Detail Modal -->
  <div class="modal-overlay" id="detailModal">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h3>Order Details</h3>
        <button class="modal-close" onclick="closeDetailModal()">&times;</button>
      </div>
      <div class="modal-body" id="orderDetailContent">
        <!-- Populated dynamically -->
      </div>
    </div>
  </div>

<script>
(function() {
  // Configuration
  const API_URL = 'https://script.google.com/macros/s/AKfycbxDAHSFl9cedGS49L3Lf5ztqy-SSToYigyA30ZtsdpmWNAR9H61X_Mm48JOOTGqqr-Z/exec';

  // State
  let orders = [];
  let customers = [];
  let cultivars = [];
  let pricing = {};
  let palletCounter = 0;
  let strainCounter = 0;

  // Toast notification system
  function showToast(message, type, duration) {
    type = type || 'info';
    duration = duration || 4000;
    let container = document.getElementById('toastContainer');
    if (!container) {
      container = document.createElement('div');
      container.id = 'toastContainer';
      container.className = 'toast-container';
      document.body.appendChild(container);
    }
    const toast = document.createElement('div');
    toast.className = 'toast ' + type;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(function() {
      toast.classList.add('hiding');
      setTimeout(function() { toast.remove(); }, 300);
    }, duration);
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', async function() {
    initDarkMode();
    await loadInitialData();
  });

  // Dark mode
  function initDarkMode() {
    if (localStorage.getItem('ro_dark_mode') === 'true') {
      document.body.classList.add('dark-mode');
    }
  }

  window.toggleDarkMode = function() {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('ro_dark_mode', document.body.classList.contains('dark-mode'));
  };

  // Load all initial data
  async function loadInitialData() {
    try {
      // Load in parallel
      await Promise.all([
        loadOrders(),
        loadCustomers(),
        loadCultivars(),
        loadPricing()
      ]);
    } catch (error) {
      console.error('Failed to load initial data:', error);
      showToast('Failed to load data from server, using demo data', 'warning');
      loadDemoData();
    }
  }

  // Load customers from API
  async function loadCustomers() {
    try {
      const response = await fetch(`${API_URL}?action=getCustomers`);
      const data = await response.json();
      if (data.customers) {
        customers = data.customers;
      } else {
        console.log('No customers API yet, using demo');
        customers = getDemoCustomers();
      }
      populateCustomerDropdown();
    } catch (error) {
      console.log('Customer API not ready:', error);
      customers = getDemoCustomers();
      populateCustomerDropdown();
    }
  }

  // Load cultivars from API
  async function loadCultivars() {
    try {
      const response = await fetch(`${API_URL}?action=getCultivars`);
      const data = await response.json();
      if (data.cultivars) {
        cultivars = data.cultivars;
      } else {
        console.log('No cultivars API yet, using demo');
        cultivars = getDemoCultivars();
      }
    } catch (error) {
      console.log('Cultivar API not ready:', error);
      cultivars = getDemoCultivars();
    }
  }

  // Load pricing from API
  async function loadPricing() {
    try {
      const response = await fetch(`${API_URL}?action=getPricing`);
      const data = await response.json();
      if (data.pricing) {
        // Convert array to map for easy lookup
        pricing = {};
        data.pricing.forEach(p => {
          pricing[p.cultivar] = p.pricePerKg;
        });
      } else {
        console.log('No pricing API yet, using demo');
        pricing = getDemoPricing();
      }
    } catch (error) {
      console.log('Pricing API not ready:', error);
      pricing = getDemoPricing();
    }
  }

  // Load orders from API
  async function loadOrders() {
    try {
      const response = await fetch(`${API_URL}?action=getOrders`);
      const data = await response.json();

      if (data.orders) {
        orders = data.orders;
        renderOrders();
        updateStats();
      } else {
        console.log('No orders yet');
        orders = getDemoOrders();
        renderOrders();
        updateStats();
      }
    } catch (error) {
      console.error('Failed to load orders:', error);
      orders = getDemoOrders();
      renderOrders();
      updateStats();
    }
  }

  // Demo data functions
  function getDemoCustomers() {
    return [
      {
        id: 'CUST-001',
        companyName: 'Hamburg GmbH',
        contactName: 'Klaus Mueller',
        email: 'klaus@hamburg-hemp.de',
        address: {
          street: 'Hauptstrasse 123',
          city: 'Hamburg',
          state: 'HH',
          zip: '20095',
          country: 'Germany'
        },
        phone: '+49 40 1234567'
      },
      {
        id: 'CUST-002',
        companyName: 'Denver Distributors',
        contactName: 'Mike Johnson',
        email: 'mike@denverhemp.com',
        address: {
          street: '456 Broadway',
          city: 'Denver',
          state: 'CO',
          zip: '80202',
          country: 'USA'
        },
        phone: '+1 303-555-0123'
      }
    ];
  }

  function getDemoCultivars() {
    return [
      'Sour Lifter',
      'Lifter',
      'Cherry Wine',
      'Elektra',
      'Hawaiian Haze',
      'Special Sauce',
      'Suver Haze'
    ];
  }

  function getDemoPricing() {
    return {
      'Sour Lifter': 150,
      'Lifter': 140,
      'Cherry Wine': 160,
      'Elektra': 145,
      'Hawaiian Haze': 135,
      'Special Sauce': 130,
      'Suver Haze': 140
    };
  }

  function getDemoOrders() {
    return [
      {
        id: 'ORD-001',
        customerId: 'CUST-001',
        customer: 'Hamburg GmbH',
        address: {
          street: 'Hauptstrasse 123',
          city: 'Hamburg',
          state: 'HH',
          zip: '20095',
          country: 'Germany'
        },
        items: [
          { cultivar: 'Sour Lifter', quantityKg: 630, pricePerKg: 150, total: 94500 },
          { cultivar: 'Lifter', quantityKg: 300, pricePerKg: 140, total: 42000 },
          { cultivar: 'Cherry Wine', quantityKg: 320, pricePerKg: 160, total: 51200 },
          { cultivar: 'Hawaiian Haze', quantityKg: 250, pricePerKg: 135, total: 33750 }
        ],
        totalKg: 1500,
        completedKg: 630,
        totalPrice: 221450,
        currency: 'EUR',
        status: 'processing',
        pallets: [
          {
            id: 'P001',
            strains: [
              { cultivar: 'Sour Lifter', weightKg: 250, pricePerKg: 150 },
              { cultivar: 'Lifter', weightKg: 50, pricePerKg: 140 }
            ],
            totalKg: 300,
            status: 'completed'
          },
          {
            id: 'P002',
            strains: [
              { cultivar: 'Sour Lifter', weightKg: 280, pricePerKg: 150 }
            ],
            totalKg: 280,
            status: 'completed'
          },
          {
            id: 'P003',
            strains: [
              { cultivar: 'Cherry Wine', weightKg: 200, pricePerKg: 160 },
              { cultivar: 'Lifter', weightKg: 120, pricePerKg: 140 }
            ],
            totalKg: 320,
            status: 'processing'
          },
          {
            id: 'P004',
            strains: [
              { cultivar: 'Hawaiian Haze', weightKg: 250, pricePerKg: 135 }
            ],
            totalKg: 250,
            status: 'pending'
          },
          {
            id: 'P005',
            strains: [
              { cultivar: 'Sour Lifter', weightKg: 100, pricePerKg: 150 },
              { cultivar: 'Lifter', weightKg: 130, pricePerKg: 140 },
              { cultivar: 'Cherry Wine', weightKg: 120, pricePerKg: 160 }
            ],
            totalKg: 350,
            status: 'pending'
          }
        ],
        createdDate: '2025-12-15',
        dueDate: '2026-02-01',
        notes: 'International freight - EU documentation required'
      },
      {
        id: 'ORD-002',
        customerId: 'CUST-002',
        customer: 'Denver Distributors',
        address: {
          street: '456 Broadway',
          city: 'Denver',
          state: 'CO',
          zip: '80202',
          country: 'USA'
        },
        items: [
          { cultivar: 'Lifter', quantityKg: 100, pricePerKg: 140, total: 14000 },
          { cultivar: 'Suver Haze', quantityKg: 100, pricePerKg: 140, total: 14000 }
        ],
        totalKg: 200,
        completedKg: 200,
        totalPrice: 28000,
        currency: 'USD',
        status: 'ready',
        pallets: [
          {
            id: 'P006',
            strains: [
              { cultivar: 'Lifter', weightKg: 100, pricePerKg: 140 },
              { cultivar: 'Suver Haze', weightKg: 100, pricePerKg: 140 }
            ],
            totalKg: 200,
            status: 'completed'
          }
        ],
        createdDate: '2025-12-28',
        dueDate: '2026-01-10',
        notes: 'Domestic shipping'
      }
    ];
  }

  function loadDemoData() {
    customers = getDemoCustomers();
    cultivars = getDemoCultivars();
    pricing = getDemoPricing();
    orders = getDemoOrders();
    populateCustomerDropdown();
    renderOrders();
    updateStats();
  }

  // Populate customer dropdown
  function populateCustomerDropdown() {
    const select = document.getElementById('customerSelect');
    select.innerHTML = '<option value="">Select a customer...</option>';
    customers.forEach(customer => {
      const option = document.createElement('option');
      option.value = customer.id;
      option.textContent = customer.companyName;
      select.appendChild(option);
    });
  }

  // Handle customer selection change
  window.handleCustomerChange = function() {
    const customerId = document.getElementById('customerSelect').value;
    // Customer is selected, could auto-fill address if needed
  };

  // Customer Modal
  window.openNewCustomerModal = function() {
    document.getElementById('customerForm').reset();
    document.getElementById('customerModal').classList.add('open');
  };

  window.closeCustomerModal = function() {
    document.getElementById('customerModal').classList.remove('open');
  };

  window.saveCustomer = async function() {
    const companyName = document.getElementById('customerCompanyName').value.trim();
    const country = document.getElementById('customerCountry').value.trim();

    if (!companyName || !country) {
      showToast('Company name and country are required', 'error');
      return;
    }

    const customer = {
      id: 'CUST-' + String(customers.length + 1).padStart(3, '0'),
      companyName: companyName,
      contactName: document.getElementById('customerContactName').value.trim(),
      email: document.getElementById('customerEmail').value.trim(),
      address: {
        street: document.getElementById('customerStreet').value.trim(),
        city: document.getElementById('customerCity').value.trim(),
        state: document.getElementById('customerState').value.trim(),
        zip: document.getElementById('customerZip').value.trim(),
        country: country
      },
      phone: document.getElementById('customerPhone').value.trim()
    };

    try {
      // Try to save to API
      const response = await fetch(`${API_URL}?action=saveCustomer`, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify(customer)
      });
      const result = await response.json();

      if (result.success || result.customer) {
        customers.push(customer);
        populateCustomerDropdown();
        document.getElementById('customerSelect').value = customer.id;
        closeCustomerModal();
        showToast('Customer added successfully', 'success');
      }
    } catch (error) {
      console.log('Customer save API not ready, adding locally:', error);
      customers.push(customer);
      populateCustomerDropdown();
      document.getElementById('customerSelect').value = customer.id;
      closeCustomerModal();
      showToast('Customer added locally', 'warning');
    }
  };

  // Pallet management
  window.addPallet = function() {
    palletCounter++;
    const container = document.getElementById('palletsContainer');
    const palletDiv = document.createElement('div');
    palletDiv.className = 'pallet-card';
    palletDiv.id = `pallet-${palletCounter}`;
    palletDiv.innerHTML = `
      <div class="pallet-card-header">
        <h5>Pallet ${palletCounter}</h5>
        <button type="button" class="pallet-remove" onclick="removePallet(${palletCounter})">
          <i class="ph ph-trash"></i>
        </button>
      </div>
      <div id="pallet-${palletCounter}-strains"></div>
      <button type="button" class="btn btn-sm btn-secondary add-strain-btn" onclick="addStrain(${palletCounter})">
        <i class="ph ph-plus"></i> Add Cultivar
      </button>
      <div class="pallet-total">
        <span class="pallet-total-label">Pallet Total:</span>
        <span class="pallet-total-value" id="pallet-${palletCounter}-total">0 kg | $0.00</span>
      </div>
    `;
    container.appendChild(palletDiv);

    // Add first strain row
    addStrain(palletCounter);
  };

  window.removePallet = function(palletId) {
    const el = document.getElementById(`pallet-${palletId}`);
    if (el) {
      el.remove();
      recalculateOrderTotals();
    }
  };

  window.addStrain = function(palletId) {
    strainCounter++;
    const container = document.getElementById(`pallet-${palletId}-strains`);
    const strainDiv = document.createElement('div');
    strainDiv.className = 'strain-row';
    strainDiv.id = `strain-${strainCounter}`;
    strainDiv.innerHTML = `
      <select class="strain-cultivar" onchange="handleStrainChange(${strainCounter}, ${palletId})">
        <option value="">Select cultivar...</option>
        ${cultivars.map(c => `<option value="${c}">${c}</option>`).join('')}
      </select>
      <input type="number" class="strain-weight" placeholder="Weight (kg)" step="0.1" min="0" onchange="recalculatePalletTotal(${palletId})">
      <input type="number" class="strain-price" placeholder="Price/kg" step="0.01" min="0" onchange="recalculatePalletTotal(${palletId})">
      <button type="button" class="strain-remove" onclick="removeStrain(${strainCounter}, ${palletId})">
        <i class="ph ph-x"></i>
      </button>
    `;
    container.appendChild(strainDiv);
  };

  window.removeStrain = function(strainId, palletId) {
    const el = document.getElementById(`strain-${strainId}`);
    if (el) {
      el.remove();
      recalculatePalletTotal(palletId);
    }
  };

  window.handleStrainChange = function(strainId, palletId) {
    const strainEl = document.getElementById(`strain-${strainId}`);
    const cultivar = strainEl.querySelector('.strain-cultivar').value;
    const priceInput = strainEl.querySelector('.strain-price');

    // Auto-fill price if available
    if (cultivar && pricing[cultivar]) {
      priceInput.value = pricing[cultivar];
    }

    recalculatePalletTotal(palletId);
  };

  window.recalculatePalletTotal = function(palletId) {
    const palletEl = document.getElementById(`pallet-${palletId}`);
    if (!palletEl) return;

    const strainRows = palletEl.querySelectorAll('.strain-row');
    let totalKg = 0;
    let totalPrice = 0;

    strainRows.forEach(row => {
      const weight = parseFloat(row.querySelector('.strain-weight').value) || 0;
      const price = parseFloat(row.querySelector('.strain-price').value) || 0;
      totalKg += weight;
      totalPrice += weight * price;
    });

    const currency = getCurrencySymbol();
    document.getElementById(`pallet-${palletId}-total`).textContent =
      `${totalKg.toFixed(1)} kg | ${currency}${totalPrice.toFixed(2)}`;

    recalculateOrderTotals();
  };

  window.recalculateOrderTotals = function() {
    const pallets = document.querySelectorAll('.pallet-card');
    let totalKg = 0;
    let totalPrice = 0;
    let totalPallets = pallets.length;

    pallets.forEach(pallet => {
      const strainRows = pallet.querySelectorAll('.strain-row');
      strainRows.forEach(row => {
        const weight = parseFloat(row.querySelector('.strain-weight').value) || 0;
        const price = parseFloat(row.querySelector('.strain-price').value) || 0;
        totalKg += weight;
        totalPrice += weight * price;
      });
    });

    const currency = getCurrencySymbol();
    document.getElementById('totalWeight').textContent = `${totalKg.toFixed(1)} kg`;
    document.getElementById('totalPallets').textContent = totalPallets;
    document.getElementById('totalPrice').textContent = `${currency}${totalPrice.toFixed(2)}`;
  };

  function getCurrencySymbol() {
    const currency = document.getElementById('currency').value;
    return currency === 'EUR' ? '€' : currency === 'GBP' ? '£' : '$';
  }

  // Render orders table
  function renderOrders() {
    const container = document.getElementById('ordersTableContainer');

    if (orders.length === 0) {
      renderEmptyState();
      return;
    }

    const filteredOrders = getFilteredOrders();

    container.innerHTML = `
      <table>
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Total</th>
            <th>Progress</th>
            <th>Status</th>
            <th class="hide-mobile">Due Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${filteredOrders.map(order => `
            <tr>
              <td><strong>${order.id}</strong></td>
              <td>${order.customer}</td>
              <td>${order.totalKg} kg</td>
              <td>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: ${getProgress(order)}%"></div>
                </div>
                <span style="font-size: 11px; color: var(--text-muted)">${getProgress(order)}%</span>
              </td>
              <td><span class="status status-${order.status}">${formatStatus(order.status)}</span></td>
              <td class="hide-mobile">${formatDate(order.dueDate)}</td>
              <td>
                <button class="btn btn-sm btn-secondary" onclick="viewOrder('${order.id}')" title="View Details">
                  <i class="ph ph-eye"></i>
                </button>
                <button class="btn btn-sm btn-secondary" onclick="editOrder('${order.id}')" title="Edit">
                  <i class="ph ph-pencil"></i>
                </button>
                <button class="btn btn-sm btn-secondary" onclick="copyCustomerLink('${order.id}')" title="Copy Customer Link">
                  <i class="ph ph-link"></i>
                </button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }

  function renderEmptyState() {
    document.getElementById('ordersTableContainer').innerHTML = `
      <div class="empty-state">
        <i class="ph ph-package"></i>
        <h3>No Orders Yet</h3>
        <p>Create your first wholesale order to get started.</p>
        <button class="btn btn-primary" onclick="openNewOrderModal()">
          <i class="ph ph-plus"></i> Create Order
        </button>
      </div>
    `;
  }

  // Filter orders
  window.filterOrders = function() {
    renderOrders();
  };

  function getFilteredOrders() {
    const statusFilter = document.getElementById('filterStatus').value;
    const searchFilter = document.getElementById('filterSearch').value.toLowerCase();

    return orders.filter(order => {
      const matchesStatus = !statusFilter || order.status === statusFilter;
      const matchesSearch = !searchFilter || order.customer.toLowerCase().includes(searchFilter);
      return matchesStatus && matchesSearch;
    });
  }

  // Update stats
  function updateStats() {
    const active = orders.filter(o => !['completed', 'shipped'].includes(o.status));
    const pending = orders.filter(o => o.status === 'pending');
    const processing = orders.filter(o => o.status === 'processing');
    const ready = orders.filter(o => o.status === 'ready');

    document.getElementById('statActiveOrders').textContent = active.length;
    document.getElementById('statPendingKg').textContent = pending.reduce((sum, o) => sum + o.totalKg, 0);
    document.getElementById('statProgressKg').textContent = processing.reduce((sum, o) => sum + (o.totalKg - (o.completedKg || 0)), 0);
    document.getElementById('statReadyKg').textContent = ready.reduce((sum, o) => sum + o.totalKg, 0);
  }

  // Helpers
  function getProgress(order) {
    if (!order.completedKg) return 0;
    return Math.round((order.completedKg / order.totalKg) * 100);
  }

  function formatStatus(status) {
    const labels = {
      pending: 'Pending',
      processing: 'Processing',
      ready: 'Ready to Ship',
      shipped: 'Shipped',
      completed: 'Completed'
    };
    return labels[status] || status;
  }

  function formatDate(dateStr) {
    if (!dateStr) return '-';
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
  }

  // Modal functions
  window.openNewOrderModal = function() {
    document.getElementById('modalTitle').textContent = 'New Order';
    document.getElementById('orderForm').reset();
    document.getElementById('orderId').value = '';
    document.getElementById('palletsContainer').innerHTML = '';
    document.getElementById('currency').value = 'USD';
    palletCounter = 0;
    strainCounter = 0;

    // Add first pallet
    addPallet();

    document.getElementById('orderModal').classList.add('open');
  };

  window.editOrder = function(orderId) {
    const order = orders.find(o => o.id === orderId);
    if (!order) return;

    document.getElementById('modalTitle').textContent = 'Edit Order';
    document.getElementById('orderId').value = order.id;
    document.getElementById('customerSelect').value = order.customerId || '';
    document.getElementById('currency').value = order.currency || 'USD';
    document.getElementById('orderStatus').value = order.status;
    document.getElementById('dueDate').value = order.dueDate || '';
    document.getElementById('orderNotes').value = order.notes || '';

    // Load pallets
    document.getElementById('palletsContainer').innerHTML = '';
    palletCounter = 0;
    strainCounter = 0;

    if (order.pallets && order.pallets.length > 0) {
      order.pallets.forEach((pallet, index) => {
        addPallet();
        const currentPalletId = palletCounter;

        // Remove the auto-added first strain
        const strainsContainer = document.getElementById(`pallet-${currentPalletId}-strains`);
        strainsContainer.innerHTML = '';

        // Add strains from order
        pallet.strains.forEach(strain => {
          addStrain(currentPalletId);
          const currentStrainId = strainCounter;
          const strainEl = document.getElementById(`strain-${currentStrainId}`);
          strainEl.querySelector('.strain-cultivar').value = strain.cultivar;
          strainEl.querySelector('.strain-weight').value = strain.weightKg;
          strainEl.querySelector('.strain-price').value = strain.pricePerKg;
        });

        recalculatePalletTotal(currentPalletId);
      });
    } else {
      addPallet();
    }

    document.getElementById('orderModal').classList.add('open');
  };

  window.closeModal = function() {
    document.getElementById('orderModal').classList.remove('open');
  };

  // Save order
  window.saveOrder = async function() {
    const orderId = document.getElementById('orderId').value;
    const customerId = document.getElementById('customerSelect').value;
    const currency = document.getElementById('currency').value;
    const status = document.getElementById('orderStatus').value;
    const dueDate = document.getElementById('dueDate').value;
    const notes = document.getElementById('orderNotes').value.trim();

    if (!customerId) {
      showToast('Please select a customer', 'error');
      return;
    }

    const customer = customers.find(c => c.id === customerId);
    if (!customer) {
      showToast('Customer not found', 'error');
      return;
    }

    // Collect pallets and calculate totals
    const pallets = [];
    const itemsMap = {}; // Aggregate by cultivar
    let totalKg = 0;
    let totalPrice = 0;
    let completedKg = 0;

    document.querySelectorAll('.pallet-card').forEach((palletEl, index) => {
      const strains = [];
      let palletTotalKg = 0;

      palletEl.querySelectorAll('.strain-row').forEach(strainEl => {
        const cultivar = strainEl.querySelector('.strain-cultivar').value;
        const weightKg = parseFloat(strainEl.querySelector('.strain-weight').value) || 0;
        const pricePerKg = parseFloat(strainEl.querySelector('.strain-price').value) || 0;

        if (cultivar && weightKg > 0) {
          strains.push({ cultivar, weightKg, pricePerKg });
          palletTotalKg += weightKg;

          // Aggregate items by cultivar
          if (!itemsMap[cultivar]) {
            itemsMap[cultivar] = { cultivar, quantityKg: 0, pricePerKg, total: 0 };
          }
          itemsMap[cultivar].quantityKg += weightKg;
          itemsMap[cultivar].total += weightKg * pricePerKg;

          totalKg += weightKg;
          totalPrice += weightKg * pricePerKg;
        }
      });

      if (strains.length > 0) {
        const palletStatus = orderId ?
          (orders.find(o => o.id === orderId)?.pallets?.[index]?.status || 'pending') :
          'pending';

        pallets.push({
          id: `P${String(index + 1).padStart(3, '0')}`,
          strains,
          totalKg: palletTotalKg,
          status: palletStatus
        });

        if (palletStatus === 'completed') {
          completedKg += palletTotalKg;
        }
      }
    });

    if (pallets.length === 0) {
      showToast('Please add at least one pallet with cultivars', 'error');
      return;
    }

    const items = Object.values(itemsMap);

    const order = {
      id: orderId || `ORD-${String(orders.length + 1).padStart(3, '0')}`,
      customerId: customer.id,
      customer: customer.companyName,
      address: customer.address,
      items,
      totalKg,
      completedKg,
      totalPrice,
      currency,
      status,
      pallets,
      documents: orderId ? orders.find(o => o.id === orderId)?.documents || [] : [],
      createdDate: orderId ? orders.find(o => o.id === orderId)?.createdDate : new Date().toISOString().split('T')[0],
      dueDate,
      notes
    };

    try {
      // Try to save to API
      const response = await fetch(`${API_URL}?action=saveOrder`, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify(order)
      });
      const result = await response.json();

      if (result.success || result.order) {
        // Update local state
        if (orderId) {
          const index = orders.findIndex(o => o.id === orderId);
          if (index >= 0) orders[index] = order;
        } else {
          orders.push(order);
        }
        showToast('Order saved successfully', 'success');
      }
    } catch (error) {
      console.log('API save failed, updating locally:', error);
      // Update local state anyway for demo
      if (orderId) {
        const index = orders.findIndex(o => o.id === orderId);
        if (index >= 0) orders[index] = order;
      } else {
        orders.push(order);
      }
      showToast('Order saved locally (server unavailable)', 'warning');
    }

    closeModal();
    renderOrders();
    updateStats();
  };

  // View order detail
  window.viewOrder = function(orderId) {
    const order = orders.find(o => o.id === orderId);
    if (!order) return;

    const progress = getProgress(order);
    const customerLink = `${window.location.origin}/rogue-origin-apps/order.html?id=${btoa(order.id)}`;
    const currencySymbol = order.currency === 'EUR' ? '€' : order.currency === 'GBP' ? '£' : '$';

    document.getElementById('orderDetailContent').innerHTML = `
      <div class="order-detail">
        <div class="order-detail-header">
          <div>
            <div class="order-title">${order.customer}</div>
            <div class="order-meta">
              <span><i class="ph ph-hash"></i> ${order.id}</span>
              <span><i class="ph ph-calendar"></i> Created ${formatDate(order.createdDate)}</span>
              <span><i class="ph ph-clock"></i> Due ${formatDate(order.dueDate)}</span>
            </div>
          </div>
          <span class="status status-${order.status}">${formatStatus(order.status)}</span>
        </div>

        <div class="order-progress">
          <div style="display: flex; justify-content: space-between; align-items: baseline;">
            <strong style="font-size: 24px;">${progress}% Complete</strong>
            <span style="color: var(--text-muted);">${order.completedKg || 0} / ${order.totalKg} kg</span>
          </div>
          <div class="order-progress-bar">
            <div class="order-progress-fill" style="width: ${progress}%"></div>
          </div>
          <div class="order-progress-stats">
            <span>Remaining: ${order.totalKg - (order.completedKg || 0)} kg</span>
            <span>${order.pallets?.filter(p => p.status === 'completed').length || 0} / ${order.pallets?.length || 0} pallets done</span>
          </div>
        </div>

        ${order.notes ? `<div style="margin-bottom: 20px; padding: 12px; background: var(--gold-dim); border-radius: 8px; font-size: 13px;"><strong>Notes:</strong> ${order.notes}</div>` : ''}

        <h4 style="margin-bottom: 12px;">Order Items (by Cultivar)</h4>
        <table style="margin-bottom: 24px;">
          <thead>
            <tr>
              <th>Cultivar</th>
              <th>Quantity</th>
              <th>Price/kg</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            ${(order.items || []).map(item => `
              <tr>
                <td><strong>${item.cultivar}</strong></td>
                <td>${item.quantityKg} kg</td>
                <td>${currencySymbol}${item.pricePerKg}</td>
                <td>${currencySymbol}${item.total.toFixed(2)}</td>
              </tr>
            `).join('')}
            <tr style="background: var(--gold-dim); font-weight: 700;">
              <td colspan="2">Total</td>
              <td>${order.totalKg} kg</td>
              <td>${currencySymbol}${order.totalPrice.toFixed(2)}</td>
            </tr>
          </tbody>
        </table>

        <h4 style="margin-bottom: 12px;">Pallets</h4>
        <table>
          <thead>
            <tr>
              <th>Pallet ID</th>
              <th>Cultivars</th>
              <th>Weight</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            ${(order.pallets || []).map(pallet => `
              <tr>
                <td><strong>${pallet.id}</strong></td>
                <td>${pallet.strains.map(s => s.cultivar).join(', ')}</td>
                <td>${pallet.totalKg} kg</td>
                <td><span class="status status-${pallet.status}">${formatStatus(pallet.status)}</span></td>
              </tr>
            `).join('')}
          </tbody>
        </table>

        <div class="customer-link">
          <span><i class="ph ph-link"></i></span>
          <input type="text" value="${customerLink}" readonly id="customerLinkInput">
          <button class="btn btn-sm btn-primary" onclick="copyLink()">Copy Link</button>
        </div>
        <p style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">Share this link with the customer to let them track their order.</p>
      </div>
    `;

    document.getElementById('detailModal').classList.add('open');
  };

  window.closeDetailModal = function() {
    document.getElementById('detailModal').classList.remove('open');
  };

  window.copyLink = function() {
    const input = document.getElementById('customerLinkInput');
    input.select();
    document.execCommand('copy');
    showToast('Link copied to clipboard!', 'success');
  };

  window.copyCustomerLink = function(orderId) {
    const customerLink = `${window.location.origin}/rogue-origin-apps/order.html?id=${btoa(orderId)}`;
    navigator.clipboard.writeText(customerLink).then(() => {
      showToast('Customer link copied to clipboard!', 'success');
    });
  };

})();
</script>
</body>
</html>
