<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rogue Origin - Operations Hub</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    /* ========================================
       RESET & BASE
       ======================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* ========================================
       CSS VARIABLES - ORGANIC INDUSTRIAL THEME
       ======================================== */
    :root {
      /* Brand Colors - Hemp Green & Harvest Gold */
      --ro-green: #668971;
      --ro-green-dark: #3d5243;
      --ro-green-glow: rgba(102, 137, 113, 0.4);
      --gold: #e4aa4f;
      --gold-glow: #f0cb60;
      --gold-dim: rgba(228, 170, 79, 0.2);

      /* Organic Earth Tones */
      --soil: #2d2419;
      --clay: #4a3f35;
      --hemp-fiber: #b8a88a;
      --leaf-green: #8ba896;
      --sage: #9ca89a;
      --mist: rgba(102, 137, 113, 0.08);

      /* Backgrounds */
      --bg-dark: #0f110e;
      --bg-card: rgba(45, 58, 46, 0.3);
      --glass: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);

      /* Text */
      --text-primary: #f5f2ed;
      --text-secondary: #b8a88a;
      --text-muted: #7a7366;

      /* Shadows */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 24px var(--ro-green-glow);

      /* Typography */
      --font-display: 'DM Serif Display', serif;
      --font-mono: 'JetBrains Mono', monospace;
      --font-ui: 'Outfit', sans-serif;

      /* Spacing */
      --space-xs: 8px;
      --space-sm: 16px;
      --space-md: 24px;
      --space-lg: 40px;
      --space-xl: 64px;

      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 16px;
      --radius-lg: 24px;
      --radius-full: 9999px;

      /* Transitions */
      --transition-fast: 0.2s ease-out;
      --transition-normal: 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      --transition-slow: 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* ========================================
       LIGHT MODE (Optional)
       ======================================== */
    body.light-mode {
      --bg-dark: #f5f2ed;
      --bg-card: rgba(255, 255, 255, 0.6);
      --glass: rgba(45, 58, 46, 0.05);
      --glass-border: rgba(45, 58, 46, 0.1);
      --text-primary: #2d2419;
      --text-secondary: #4a3f35;
      --text-muted: #7a7366;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);
    }

    /* ========================================
       BASE STYLES
       ======================================== */
    body {
      font-family: var(--font-ui);
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Hemp Leaf Pattern Background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5C25 10 20 15 20 25C20 30 25 35 30 40C35 35 40 30 40 25C40 15 35 10 30 5Z' fill='%23668971' opacity='0.03'/%3E%3C/svg%3E");
      background-size: 120px;
      pointer-events: none;
      z-index: 0;
      animation: driftPattern 60s linear infinite;
    }

    @keyframes driftPattern {
      0% { background-position: 0 0; }
      100% { background-position: 120px 120px; }
    }

    /* Grain Texture Overlay */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.02;
      pointer-events: none;
      z-index: 1;
    }

    /* ========================================
       CONTAINER & LAYOUT
       ======================================== */
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: var(--space-md);
      position: relative;
      z-index: 2;
    }

    /* ========================================
       HEADER
       ======================================== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) 0;
      margin-bottom: var(--space-lg);
      animation: fadeInDown 0.6s ease-out;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .logo {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--ro-green), var(--gold));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: var(--shadow-md);
    }

    .brand {
      font-family: var(--font-display);
      font-size: 28px;
      font-weight: 400;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--ro-green), var(--gold-glow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-controls {
      display: flex;
      gap: var(--space-sm);
      align-items: center;
    }

    .header-btn {
      padding: 10px 20px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-full);
      color: var(--text-primary);
      font-family: var(--font-ui);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-normal);
      backdrop-filter: blur(10px);
    }

    .header-btn:hover {
      background: var(--ro-green);
      border-color: var(--ro-green);
      transform: translateY(-2px);
      box-shadow: var(--shadow-glow);
    }

    .refresh-btn {
      background: linear-gradient(135deg, var(--ro-green), var(--leaf-green));
      border: none;
      color: white;
      padding: 10px 24px;
    }

    .refresh-btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 24px rgba(102, 137, 113, 0.4);
    }

    /* ========================================
       HERO SECTION
       ======================================== */
    .hero {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
      position: relative;
      animation: fadeInUp 0.6s ease-out 0.2s both;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: -20%;
      right: -10%;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, var(--ro-green-glow) 0%, transparent 70%);
      border-radius: 50%;
      filter: blur(80px);
      pointer-events: none;
      opacity: 0.3;
      animation: pulseGlow 8s ease-in-out infinite;
    }

    @keyframes pulseGlow {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.1); }
    }

    .hero-main {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .hero-main::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--ro-green), var(--gold));
    }

    .hero-label {
      font-family: var(--font-ui);
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-secondary);
      margin-bottom: var(--space-sm);
    }

    .hero-value {
      font-family: var(--font-mono);
      font-size: 96px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: var(--space-sm);
      background: linear-gradient(135deg, var(--text-primary), var(--hemp-fiber));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: countUp 1s ease-out;
    }

    @keyframes countUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hero-unit {
      font-family: var(--font-ui);
      font-size: 24px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .hero-subtitle {
      font-family: var(--font-ui);
      font-size: 16px;
      color: var(--text-secondary);
      margin-top: var(--space-md);
    }

    .hero-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-sm);
    }

    .hero-stat {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-normal);
      animation: fadeInUp 0.6s ease-out both;
    }

    .hero-stat:nth-child(1) { animation-delay: 0.3s; }
    .hero-stat:nth-child(2) { animation-delay: 0.4s; }
    .hero-stat:nth-child(3) { animation-delay: 0.5s; }
    .hero-stat:nth-child(4) { animation-delay: 0.6s; }

    .hero-stat:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
      border-color: var(--ro-green);
    }

    .hero-stat-label {
      font-family: var(--font-ui);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .hero-stat-value {
      font-family: var(--font-mono);
      font-size: 32px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1;
    }

    .hero-stat-value.highlight {
      background: linear-gradient(135deg, var(--gold), var(--gold-glow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-stat-subtitle {
      font-family: var(--font-ui);
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 6px;
    }

    /* Progress Ring */
    .progress-ring-container {
      position: relative;
      width: 160px;
      height: 160px;
      margin: 0 auto;
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring-bg {
      fill: none;
      stroke: var(--glass);
      stroke-width: 10;
    }

    .progress-ring-fill {
      fill: none;
      stroke: url(#progressGradient);
      stroke-width: 10;
      stroke-linecap: round;
      stroke-dasharray: 440;
      stroke-dashoffset: 440;
      transition: stroke-dashoffset 1s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .progress-percent {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: var(--font-mono);
      font-size: 36px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .progress-percent-label {
      font-family: var(--font-ui);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* ========================================
       METRICS GRID
       ======================================== */
    .metrics-grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr 0.8fr;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
      animation: fadeInUp 0.6s ease-out 0.4s both;
    }

    .metric-card {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--ro-green);
    }

    .metric-card.gold::before { background: var(--gold); }
    .metric-card.green::before { background: var(--ro-green); }

    .metric-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
      border-color: var(--ro-green);
    }

    .metric-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--space-sm);
    }

    .metric-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      background: var(--gold-dim);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .metric-label {
      font-family: var(--font-ui);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .metric-value {
      font-family: var(--font-mono);
      font-size: 42px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.1;
    }

    .metric-unit {
      font-size: 18px;
      color: var(--text-secondary);
      margin-left: 4px;
    }

    .metric-subtitle {
      font-family: var(--font-ui);
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 8px;
    }

    .metric-split {
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-sm);
    }

    .metric-split-item {
      flex: 1;
      padding: 12px;
      background: var(--glass);
      border-radius: var(--radius-sm);
      text-align: center;
    }

    .metric-split-value {
      font-family: var(--font-mono);
      font-size: 24px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .metric-split-label {
      font-family: var(--font-ui);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* ========================================
       CHARTS SECTION
       ======================================== */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
      animation: fadeInUp 0.6s ease-out 0.6s both;
    }

    .chart-card {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-md);
    }

    .chart-card.full {
      grid-column: 1 / -1;
    }

    .chart-header {
      margin-bottom: var(--space-md);
    }

    .chart-title {
      font-family: var(--font-ui);
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .chart-subtitle {
      font-family: var(--font-ui);
      font-size: 12px;
      color: var(--text-muted);
    }

    .chart-container {
      position: relative;
      height: 250px;
    }

    .chart-container.tall {
      height: 350px;
    }

    /* ========================================
       STRAIN SECTION
       ======================================== */
    .strain-section {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
      animation: fadeInUp 0.6s ease-out 0.8s both;
    }

    .strain-current {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    .strain-current::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--leaf-green), var(--ro-green));
    }

    .strain-name {
      font-family: var(--font-display);
      font-size: 36px;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }

    .strain-type {
      font-family: var(--font-ui);
      font-size: 14px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .strain-list {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-md);
    }

    .strain-list-title {
      font-family: var(--font-ui);
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .strain-item {
      padding: 12px;
      background: var(--glass);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all var(--transition-fast);
    }

    .strain-item:hover {
      background: var(--ro-green-glow);
      transform: translateX(4px);
    }

    .strain-item-name {
      font-family: var(--font-ui);
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .strain-item-value {
      font-family: var(--font-mono);
      font-size: 13px;
      font-weight: 600;
      color: var(--gold);
    }

    /* ========================================
       INTEGRATIONS
       ======================================== */
    .integrations {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-md);
      animation: fadeInUp 0.6s ease-out 1s both;
    }

    .integration-card {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-normal);
      cursor: pointer;
    }

    .integration-card:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
      border-color: var(--ro-green);
    }

    .integration-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      background: var(--gold-dim);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: var(--space-sm);
    }

    .integration-title {
      font-family: var(--font-ui);
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .integration-subtitle {
      font-family: var(--font-ui);
      font-size: 11px;
      color: var(--text-muted);
    }

    .integration-value {
      font-family: var(--font-mono);
      font-size: 24px;
      font-weight: 700;
      color: var(--gold);
      margin-top: var(--space-sm);
    }

    /* ========================================
       LOADING STATES
       ======================================== */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      gap: var(--space-md);
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--glass);
      border-top-color: var(--ro-green);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      font-family: var(--font-ui);
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* ========================================
       KEYFRAME ANIMATIONS
       ======================================== */
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ========================================
       RESPONSIVE DESIGN
       ======================================== */
    @media (max-width: 1200px) {
      .hero {
        grid-template-columns: 1fr;
      }

      .metrics-grid {
        grid-template-columns: 1fr 1fr;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }

      .strain-section {
        grid-template-columns: 1fr;
      }

      .integrations {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: var(--space-sm);
      }

      .header {
        flex-direction: column;
        gap: var(--space-sm);
        align-items: stretch;
      }

      .header-controls {
        flex-wrap: wrap;
      }

      .hero-value {
        font-size: 64px;
      }

      .metrics-grid {
        grid-template-columns: 1fr;
      }

      .integrations {
        grid-template-columns: 1fr;
      }

      .metric-value {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo-section">
        <div class="logo">üåø</div>
        <h1 class="brand">Rogue Origin</h1>
      </div>
      <div class="header-controls">
        <button class="header-btn" onclick="toggleTheme()">
          <span id="themeIcon">‚òÄÔ∏è</span>
        </button>
        <button class="header-btn refresh-btn" onclick="refreshData()">
          <span>‚Üª Refresh</span>
        </button>
      </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-main">
        <div class="hero-label">Today's Production</div>
        <div class="hero-value" id="heroValue">0.0</div>
        <span class="hero-unit">lbs tops</span>
        <div class="hero-subtitle" id="heroSubtitle">Loading...</div>
      </div>

      <div class="hero-stats">
        <div class="hero-stat">
          <div class="hero-stat-label">Target Progress</div>
          <div class="progress-ring-container">
            <svg class="progress-ring" width="160" height="160">
              <defs>
                <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#668971" />
                  <stop offset="100%" style="stop-color:#e4aa4f" />
                </linearGradient>
              </defs>
              <circle class="progress-ring-bg" cx="80" cy="80" r="70"></circle>
              <circle class="progress-ring-fill" id="progressRing" cx="80" cy="80" r="70"></circle>
            </svg>
            <div class="progress-percent">
              <span id="progressPercent">0</span>%
              <div class="progress-percent-label">OF TARGET</div>
            </div>
          </div>
        </div>

        <div class="hero-stat">
          <div class="hero-stat-label">Current Rate</div>
          <div class="hero-stat-value highlight" id="currentRate">0.00</div>
          <div class="hero-stat-subtitle">lbs/trimmer/hour</div>
        </div>

        <div class="hero-stat">
          <div class="hero-stat-label">Crew Size</div>
          <div class="hero-stat-value" id="crewSize">0</div>
          <div class="hero-stat-subtitle" id="crewBreakdown">Loading...</div>
        </div>

        <div class="hero-stat">
          <div class="hero-stat-label">Current Strain</div>
          <div class="hero-stat-value" style="font-size: 18px; word-break: break-word;" id="currentStrain">‚Äî</div>
        </div>
      </div>
    </section>

    <!-- Core Metrics -->
    <section class="metrics-grid">
      <div class="metric-card green">
        <div class="metric-label">Total Output</div>
        <div class="metric-split">
          <div class="metric-split-item">
            <div class="metric-split-value" id="totalTops">0.0</div>
            <div class="metric-split-label">Tops</div>
          </div>
          <div class="metric-split-item">
            <div class="metric-split-value" id="totalSmalls">0.0</div>
            <div class="metric-split-label">Smalls</div>
          </div>
        </div>
        <div class="metric-subtitle">Total: <span id="totalLbs">0.0</span> lbs</div>
      </div>

      <div class="metric-card gold">
        <div class="metric-label">Efficiency</div>
        <div class="metric-value" id="avgRate">0.00</div>
        <div class="metric-subtitle">Average rate (lbs/trimmer/hour)</div>
      </div>

      <div class="metric-card">
        <div class="metric-label">Operating Cost</div>
        <div class="metric-value" id="costPerLb">$0.00</div>
        <div class="metric-subtitle">Cost per pound produced</div>
      </div>
    </section>

    <!-- Charts -->
    <section class="charts-grid">
      <div class="chart-card full">
        <div class="chart-header">
          <div class="chart-title">Hourly Production Flow</div>
          <div class="chart-subtitle">Tops vs Smalls throughout the day</div>
        </div>
        <div class="chart-container tall">
          <canvas id="hourlyChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">Efficiency Trend</div>
          <div class="chart-subtitle">Rate over time</div>
        </div>
        <div class="chart-container">
          <canvas id="rateChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">Daily Summary</div>
          <div class="chart-subtitle">Last 7 days performance</div>
        </div>
        <div class="chart-container">
          <canvas id="dailyChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Strain Performance -->
    <section class="strain-section">
      <div class="strain-current">
        <div class="strain-name" id="strainName">Loading...</div>
        <div class="strain-type" id="strainType">Current Production Strain</div>
      </div>

      <div class="strain-list">
        <div class="strain-list-title">Recent Strains</div>
        <div id="strainListContainer">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Integration Hub -->
    <section class="integrations">
      <div class="integration-card" onclick="window.open('kanban.html', '_blank')">
        <div class="integration-icon">üìã</div>
        <div class="integration-title">Supply Kanban</div>
        <div class="integration-subtitle">Inventory tracking</div>
        <div class="integration-value" id="kanbanTotal">‚Äî</div>
      </div>

      <div class="integration-card" onclick="window.open('scoreboard.html', '_blank')">
        <div class="integration-icon">üìä</div>
        <div class="integration-title">Live Scoreboard</div>
        <div class="integration-subtitle">Floor display</div>
        <div class="integration-value">LIVE</div>
      </div>

      <div class="integration-card" onclick="window.open('barcode.html', '_blank')">
        <div class="integration-icon">üì¶</div>
        <div class="integration-title">Bag Timer</div>
        <div class="integration-subtitle">Packaging tracker</div>
        <div class="integration-value" id="bagsToday">0</div>
      </div>

      <div class="integration-card" onclick="window.open('sop-manager.html', '_blank')">
        <div class="integration-icon">üìö</div>
        <div class="integration-title">SOP Manager</div>
        <div class="integration-subtitle">Procedures</div>
        <div class="integration-value">VIEW</div>
      </div>
    </section>
  </div>

  <script>
    // ========================================
    // CONFIGURATION
    // ========================================
    const API_URL = 'https://script.google.com/macros/s/AKfycbxDAHSFl9cedGS49L3Lf5ztqy-SSToYigyA30ZtsdpmWNAR9H61X_Mm48JOOTGqqr-Z/exec';
    const isAppsScript = typeof google !== 'undefined' && google.script && google.script.run;

    let data = null;
    let hourlyChart, rateChart, dailyChart;
    let lightMode = false;

    // ========================================
    // UTILITY FUNCTIONS
    // ========================================
    function animateNumber(element, target, duration = 1000, decimals = 1) {
      const start = parseFloat(element.textContent) || 0;
      const increment = (target - start) / (duration / 16);
      let current = start;

      const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
          element.textContent = target.toFixed(decimals);
          clearInterval(timer);
        } else {
          element.textContent = current.toFixed(decimals);
        }
      }, 16);
    }

    function setProgress(percent) {
      const ring = document.getElementById('progressRing');
      const circumference = 440; // 2 * PI * 70
      const offset = circumference - (percent / 100 * circumference);
      ring.style.strokeDashoffset = offset;

      const percentEl = document.getElementById('progressPercent');
      animateNumber(percentEl, Math.round(percent), 1000, 0);
    }

    // ========================================
    // DATA LOADING
    // ========================================
    async function loadData() {
      try {
        let result;

        if (isAppsScript) {
          result = await new Promise((resolve, reject) => {
            google.script.run
              .withSuccessHandler(resolve)
              .withFailureHandler(reject)
              .getProductionDashboardData();
          });
        } else {
          const response = await fetch(`${API_URL}?action=dashboard`);
          result = await response.json();
        }

        if (result.success && result.data) {
          data = result.data;
          renderDashboard();
        } else {
          console.error('API Error:', result.error || 'Unknown error');
        }
      } catch (error) {
        console.error('Load Error:', error);
      }
    }

    function refreshData() {
      const btn = event.target.closest('button');
      btn.textContent = '‚Üª Loading...';
      btn.disabled = true;

      loadData().then(() => {
        btn.textContent = '‚Üª Refresh';
        btn.disabled = false;
      });
    }

    // ========================================
    // RENDERING
    // ========================================
    function renderDashboard() {
      if (!data || !data.today) return;

      const t = data.today;

      // Hero section
      animateNumber(document.getElementById('heroValue'), t.totalTops || 0, 1200, 1);
      document.getElementById('heroSubtitle').textContent = `${t.totalLbs?.toFixed(1) || 0} lbs total (${t.hoursWorked || 0} hours)`;

      // Progress
      const percent = t.todayPercentage || 0;
      setProgress(percent);

      // Stats
      animateNumber(document.getElementById('currentRate'), t.currentRate || 0, 1000, 2);
      animateNumber(document.getElementById('crewSize'), (t.trimmers || 0) + (t.buckers || 0), 1000, 0);
      document.getElementById('crewBreakdown').textContent = `${t.trimmers || 0} trimmers, ${t.buckers || 0} buckers`;

      // Current strain
      const strain = data.current?.strain || data.lastCompleted?.strain || 'Unknown';
      document.getElementById('currentStrain').textContent = strain.split('/')[0].trim();
      document.getElementById('strainName').textContent = strain.split('/')[0].trim();
      document.getElementById('strainType').textContent = strain.split('/')[1]?.trim() || 'Sungrown';

      // Metrics
      animateNumber(document.getElementById('totalTops'), t.totalTops || 0, 1000, 1);
      animateNumber(document.getElementById('totalSmalls'), t.totalSmalls || 0, 1000, 1);
      animateNumber(document.getElementById('totalLbs'), t.totalLbs || 0, 1000, 1);
      animateNumber(document.getElementById('avgRate'), t.avgRate || 0, 1000, 2);
      document.getElementById('costPerLb').textContent = `$${(t.costPerLb || 0).toFixed(2)}`;

      // Integration values
      if (data.bagTimer) {
        document.getElementById('bagsToday').textContent = data.bagTimer.bagsToday || 0;
      }

      // Strain list
      renderStrainList();

      // Charts
      renderCharts();
    }

    function renderStrainList() {
      const container = document.getElementById('strainListContainer');

      if (!data.strains || data.strains.length === 0) {
        container.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-muted);">No strain data available</div>';
        return;
      }

      container.innerHTML = data.strains.slice(0, 5).map(s => `
        <div class="strain-item">
          <div class="strain-item-name">${s.name || 'Unknown'}</div>
          <div class="strain-item-value">${(s.tops || 0).toFixed(1)} lbs</div>
        </div>
      `).join('');
    }

    function renderCharts() {
      // Hourly Production Chart
      if (data.hourly && data.hourly.length > 0) {
        const ctx = document.getElementById('hourlyChart');
        if (hourlyChart) hourlyChart.destroy();

        hourlyChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.hourly.map(h => h.label || ''),
            datasets: [
              {
                label: 'Tops',
                data: data.hourly.map(h => h.tops || 0),
                backgroundColor: 'rgba(102, 137, 113, 0.8)',
                borderColor: '#668971',
                borderWidth: 0,
                borderRadius: 8
              },
              {
                label: 'Smalls',
                data: data.hourly.map(h => h.smalls || 0),
                backgroundColor: 'rgba(228, 170, 79, 0.6)',
                borderColor: '#e4aa4f',
                borderWidth: 0,
                borderRadius: 8
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: 'var(--text-primary)',
                  font: { family: 'Outfit', size: 12 }
                }
              }
            },
            scales: {
              x: {
                stacked: false,
                grid: { display: false },
                ticks: {
                  color: 'var(--text-muted)',
                  font: { family: 'Outfit', size: 11 }
                }
              },
              y: {
                stacked: false,
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: 'var(--text-muted)',
                  font: { family: 'JetBrains Mono', size: 11 }
                }
              }
            }
          }
        });
      }

      // Rate Trend Chart
      if (data.hourly && data.hourly.length > 0) {
        const ctx = document.getElementById('rateChart');
        if (rateChart) rateChart.destroy();

        rateChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.hourly.map(h => h.label || ''),
            datasets: [{
              label: 'Rate',
              data: data.hourly.map(h => h.rate || 0),
              borderColor: '#e4aa4f',
              backgroundColor: 'rgba(228, 170, 79, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointRadius: 4,
              pointBackgroundColor: '#e4aa4f',
              pointBorderColor: '#fff',
              pointBorderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false }
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: {
                  color: 'var(--text-muted)',
                  font: { family: 'Outfit', size: 10 }
                }
              },
              y: {
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: 'var(--text-muted)',
                  font: { family: 'JetBrains Mono', size: 11 }
                }
              }
            }
          }
        });
      }

      // Daily Summary Chart
      if (data.daily && data.daily.length > 0) {
        const ctx = document.getElementById('dailyChart');
        if (dailyChart) dailyChart.destroy();

        dailyChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.daily.map(d => d.label || ''),
            datasets: [{
              label: 'Total Production',
              data: data.daily.map(d => (d.totalTops || 0) + (d.totalSmalls || 0)),
              backgroundColor: 'rgba(102, 137, 113, 0.8)',
              borderColor: '#668971',
              borderWidth: 0,
              borderRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false }
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: {
                  color: 'var(--text-muted)',
                  font: { family: 'Outfit', size: 11 }
                }
              },
              y: {
                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                ticks: {
                  color: 'var(--text-muted)',
                  font: { family: 'JetBrains Mono', size: 11 }
                }
              }
            }
          }
        });
      }
    }

    // ========================================
    // THEME TOGGLE
    // ========================================
    function toggleTheme() {
      lightMode = !lightMode;
      document.body.classList.toggle('light-mode', lightMode);
      document.getElementById('themeIcon').textContent = lightMode ? 'üåô' : '‚òÄÔ∏è';
      localStorage.setItem('theme', lightMode ? 'light' : 'dark');

      // Update charts if they exist
      if (hourlyChart) renderCharts();
    }

    // ========================================
    // INITIALIZATION
    // ========================================
    document.addEventListener('DOMContentLoaded', () => {
      // Load saved theme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        toggleTheme();
      }

      // Initial data load
      loadData();

      // Auto-refresh every 60 seconds
      setInterval(loadData, 60000);
    });
  </script>
</body>
</html>
